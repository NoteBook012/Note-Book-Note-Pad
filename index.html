<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
    <title>Note P@d - Modern Online Notepad, Whiteboard & To-Do List</title>
    
    <meta name="description" content="Note P@d is a free, fast, and secure online application featuring a modern notepad, a digital whiteboard for drawing, and a to-do list manager. Your data is saved locally. Works offline. Discover productivity tips on our blog."/>
    
    <meta name="keywords" content="online notepad, notepad, text editor, whiteboard, online drawing tool, to-do list, checklist, pwa, secure notepad, offline notes, bishal mishra, productivity blog, organization tips, study tools, free productivity app"/>
    
    <meta name="author" content="Bishal Mishra">
    <meta name="robots" content="index, follow">

    <link rel="canonical" href="https://your-domain-here.com/">

    <meta property="og:title" content="Note P@d - Modern Online Notepad, Whiteboard & To-Do List" />
    <meta property="og:description" content="A free, secure online tool with a notepad, whiteboard, and to-do list. Works offline, no sign-up required for basic use. Read our productivity blog for tips." />
    <meta property="og:image" content="https://i.imgur.com/kR1k1jU.png" />
    <meta property="og:url" content="https://your-domain-here.com/" />
    <meta property="og:type" content="website" />

    <link rel="manifest" href="manifest.json">
   
    <link rel="icon" type="image/png" href="images/favicon.png"> 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- AdSense SCRIPT (typically in HEAD) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3010913100191778"
         crossorigin="anonymous"></script>
    <!-- End AdSense SCRIPT -->
   
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <script type="application/ld+json">
    [
      {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Note P@d",
        "applicationCategory": "ProductivityApplication",
        "operatingSystem": "All (Web-based)",
        "offers": {
          "@type": "Offer",
          "price": "0"
        },
        "description": "A free, fast, and secure online application featuring a modern notepad, a digital whiteboard for drawing, and a to-do list manager.",
        "author": {
          "@type": "Person",
          "name": "Bishal Mishra"
        },
        "url": "https://bishalmishra.com/" 
      },
      {
        "@context": "https://schema.org",
        "@type": "WebSite", 
        "name": "Note P@d",
        "url": "https://bishalmishra.com/", 
        "potentialAction": {
          "@type": "SearchAction",
          "target": "https://bishalmishra.com/?s={search_term_string}", 
          "query-input": "required name=search_term_string"
        }
      },
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "What is Note P@d?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Note P@d is a free, fast, and secure online application featuring a modern notepad, a digital whiteboard for drawing, and a to-do list manager. It works offline and saves your data locally in your browser."
            }
          },
          {
            "@type": "Question",
            "name": "Is my data safe and private with Note P@d?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes, absolutely. All your notes are stored locally in your browser's localStorage and are never transmitted to any external server by default. Your data remains 100% on your device for basic use. Optional cloud sync features may involve server storage if you opt-in."
            }
          },
          {
            "@type": "Question",
            "name": "Can I use Note P@d offline?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes, Note P@d is a Progressive Web App (PWA). Once you visit it for the first time, it can be used offline, making it reliable even without an internet connection."
            }
          },
          {
            "@type": "Question",
            "name": "Do I need to sign up or create an account for Note P@d?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "For basic local note-taking, no sign-up is required. You can start using it immediately. If you wish to manage multiple user profiles, use cloud sync (if available), or access certain premium features, then account creation or Google Sign-In is available."
            }
          },
          {
            "@type": "Question",
            "name": "How do I export my notes from Note P@d?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "You can export your notepad entries as PDF files using the \"PDF\" button available with each saved note. Whiteboard drawings can be downloaded as PNG images."
            }
          }
        ]
      }
    ]
    </script>

    <style>
        :root {
            --bg-light: linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);
            --text-light: #333;
            --card-light: #ffffff;
            --shadow-light: rgba(0, 0, 0, 0.08);

            --bg-dark: linear-gradient(120deg, #2b2b2b 0%, #1e1e1e 100%);
            --text-dark: #e0e0e0;
            --card-dark: #2c2c2c;
            --shadow-dark: rgba(0, 0, 0, 0.25);
           
            --primary: #8c53ff;
            --primary-dark: #7042cc;
            --radius: 12px;
        }

        html { height: 100%; scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg-light); color: var(--text-light); line-height: 1.6; transition: background 0.5s ease, color 0.5s ease; display: flex; flex-direction: column; min-height: 100vh; }
        body.dark { background: var(--bg-dark); color: var(--text-dark); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        main.container { width: 95%; max-width: 1200px; margin: 20px auto; flex-grow: 1; padding-bottom: 40px; } 
        header, footer { background: var(--primary); color: white; padding: 15px 20px; text-align: center; box-shadow: 0 4px 15px var(--shadow-light); z-index: 10; }
        header {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .header-content {
            text-align: center;
        }
        body.dark header, body.dark footer { box-shadow: 0 4px 15px var(--shadow-dark); }
        footer { margin-top: auto; padding: 20px;  }
        footer a { color: #fff; font-weight: 600; text-decoration: none; transition: opacity 0.2s; margin: 0 10px;  }
        footer a:hover { opacity: 0.8; text-decoration: underline; }
        footer p { margin-bottom: 10px; } 
        
        .sidenav {
            height: 100%;
            width: 0; 
            position: fixed;
            z-index: 1002; 
            top: 0;
            left: 0;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
        }

        body.dark .sidenav {
            background-color: rgba(30, 30, 30, 0.95);
        }

        .sidenav a {
            padding: 10px 15px 10px 32px;
            text-decoration: none;
            font-size: 20px; 
            font-weight: 600;
            color: var(--text-light);
            display: block;
            transition: 0.3s;
        }
        body.dark .sidenav a {
            color: var(--text-dark);
        }

        .sidenav a:hover {
            color: var(--primary);
        }

        .sidenav .closebtn {
            position: absolute;
            top: 10px;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }

        .open-nav-btn {
            font-size: 28px;
            cursor: pointer;
            position: absolute;
            left: 25px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            transition: transform 0.2s;
        }
        .open-nav-btn:hover {
            transform: translateY(-50%) scale(1.1);
        }

        #menu-bar { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; background: var(--card-light); padding: 15px; border-radius: var(--radius); margin: 20px 0; box-shadow: 0 4px 15px var(--shadow-light); }
        #menu-bar button, #menu-bar select { padding: 8px 15px; border-radius: var(--radius); border: none; cursor: pointer; background-color: #f0f0f0; color: #333; font-weight: 600; transition: all 0.2s ease-in-out; }
        #menu-bar button:hover, #menu-bar select:hover { background-color: #e0e0e0; transform: translateY(-2px); }
        body.dark #menu-bar { background: #252525; box-shadow: 0 4px 15px var(--shadow-dark); }
        body.dark #menu-bar button, body.dark #menu-bar select { background-color: var(--card-dark); color: var(--text-dark); }
        
        .mode-switcher { border-left: 2px solid #ddd; padding-left: 10px; margin-left: 10px; display:flex; gap: 10px; flex-wrap: wrap; }
        body.dark .mode-switcher { border-left-color: #555; }
        .mode-switcher button { transition: background-color 0.3s ease, color 0.3s ease; }
        .mode-switcher button.active-mode { background-color: var(--primary); color: white; }
        body.dark .mode-switcher button.active-mode { background-color: var(--primary-dark); }
        
        #editor, #notes, .info-section, #whiteboard-container, #calendar-container, #faq-section, #blogs-section, #privacy-policy-section, #terms-of-service-section 
        { 
            background: var(--card-light); 
            padding: 25px; 
            border-radius: var(--radius); 
            box-shadow: 0 4px 15px var(--shadow-light); 
            margin-bottom: 25px; 
            text-align: left; 
        }
        body.dark #editor, body.dark #notes, body.dark .info-section, body.dark #whiteboard-container, body.dark #calendar-container, body.dark #faq-section, body.dark #blogs-section, body.dark #privacy-policy-section, body.dark #terms-of-service-section { 
            background: var(--card-dark); 
            box-shadow: 0 4px 15px var(--shadow-dark); 
        }
       
        #editor textarea, #editor input[type="text"] { width: 100%; font-size: 16px; padding: 12px; border-radius: var(--radius); border: 1px solid #e0e0e0; background: var(--bg-light); color: var(--text-light); resize: vertical; transition: border-color 0.3s ease, box-shadow 0.3s ease, background 0.3s ease, color 0.3s ease; }
        #editor textarea:focus, #editor input[type="text"]:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(140, 83, 255, 0.2); }
        #editor input[type="text"] { margin-bottom: 15px; font-size: 20px; font-weight: 600; }
        body.dark #editor textarea, body.dark #editor input[type="text"] { border-color: #444; background: #333; color: var(--text-dark); }
        
        #editor-stats { display: flex; gap: 20px; margin-top: 10px; font-size: 14px; color: #888; }
        body.dark #editor-stats { color: #aaa; }

        #whiteboard-canvas { border: 2px solid #eee; border-radius: var(--radius); cursor: crosshair; touch-action: none; background-color: #fff;  }
        body.dark #whiteboard-canvas { border-color: #444; background-color: #383838; }
        #whiteboard-toolbar { display: flex; flex-wrap: wrap; align-items: center; gap: 15px; margin-top: 15px; }
        #whiteboard-toolbar label { font-weight: 600; }
        #whiteboard-toolbar input[type="color"] { width: 40px; height: 40px; border: none; padding: 0; cursor: pointer; background: none; border-radius: 50%; }
        #whiteboard-toolbar input[type="range"] { cursor: pointer; }
        #whiteboard-toolbar button { padding: 8px 15px; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; background: #f0f0f0; font-weight: 500; transition: all 0.2s ease-in-out; }
        #whiteboard-toolbar button.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        #todo-list-container { min-height: 200px; padding: 10px; border-radius: var(--radius); border: 1px solid #e0e0e0; }
        body.dark #todo-list-container { border-color: #444; }
        .todo-item { display: flex; align-items: center; gap: 12px; font-size: 16px; padding: 8px 4px; border-bottom: 1px solid #f0f0f0; }
        body.dark .todo-item { border-bottom-color: #3a3a3a; }
        .todo-item:last-child { border-bottom: none; }
        .todo-item input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--primary); }
        .todo-item .todo-text { flex-grow: 1; outline: none; }
        .todo-item.completed .todo-text { text-decoration: line-through; color: #999; }
        #add-todo-btn { margin-top: 15px; }

        .note { border-radius: var(--radius); padding: 20px; margin-bottom: 15px; border: 1px solid #e7e7e7; transition: box-shadow 0.3s ease, transform 0.3s ease, border-left 0.3s ease; }
        .note:hover { transform: translateY(-3px); box-shadow: 0 6px 20px var(--shadow-light); }
        body.dark .note { border-color: #444; }
        body.dark .note:hover { box-shadow: 0 6px 20px var(--shadow-dark); }
        .note.pinned { border-left: 5px solid gold; }
        .note h4 { margin-bottom: 5px; font-size: 18px; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .note p { margin: 10px 0; word-break: break-word; }
        .note small { color: #888; }
        body.dark .note small { color: #aaa; }
        .note-actions button { margin-right: 8px; margin-top: 10px; padding: 6px 12px; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; background: #f0f0f0; font-weight: 500; transition: all 0.2s ease-in-out; }
        body.dark .note-actions button { background: #3e3e3e; color: var(--text-dark); border-color: #555; }

        h2, h3 { font-size: 24px; margin-bottom: 20px; color: var(--primary); text-align: center; }
        .info-section h3, #blogs-section h3, #faq-section h3, #privacy-policy-section h3, #terms-of-service-section h3  { text-align: left;  }
        .info-section p, .info-section ul, #privacy-policy-section p, #privacy-policy-section ul, #terms-of-service-section p, #terms-of-service-section ul  { margin-bottom: 15px; }
        .info-section ul { list-style: none; padding-left: 0; }
        .info-section ul li { padding-left: 30px; position: relative; margin-bottom: 12px; }
        .info-section ul li::before { content: '\f058'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: var(--primary); position: absolute; left: 0; top: 2px; font-size: 18px; }
        #privacy-policy-section h4, #terms-of-service-section h4 { font-size: 1.2em; color: var(--primary-dark); margin-top: 20px; margin-bottom: 10px; }

        .blog-post {
            background: var(--card-light);
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: 0 4px 15px var(--shadow-light);
            margin-bottom: 25px;
            text-align: left; 
        }
        body.dark .blog-post {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }
        .blog-post h4 {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 22px;
            font-weight: 700;
        }
        .blog-post-meta {
            font-size: 13px;
            color: #888;
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        body.dark .blog-post-meta {
            color: #aaa;
        }
        .blog-post-meta i {
            margin-right: 5px;
            color: var(--primary); 
        }
        .blog-post-content {
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-light); 
        }
        body.dark .blog-post-content {
            color: var(--text-dark);
        }
        .blog-post-content p {
            margin-bottom: 15px;
        }
        .blog-post-content a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
        }
        .blog-post-content a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }
        .blog-post-image {
            max-width: 100%;
            height: auto;
            border-radius: var(--radius);
            margin-bottom: 15px;
            display: block; 
        }
        .blog-content-short {
            display: -webkit-box;
            -webkit-line-clamp: 3; 
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            max-height: calc(1.7em * 3); 
            margin-bottom: 15px; 
        }
        .blog-content-full {
            display: block; 
            max-height: none; 
            margin-bottom: 15px;
        }
        .read-more-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s ease-in-out;
            display: inline-block; 
            margin-top: 10px; 
        }
        .read-more-btn:hover {
            background: var(--primary-dark);
        }

        .premium-offerings {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }
        .premium-feature-card {
            background: var(--card-light); 
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: 0 4px 15px var(--shadow-light);
            text-align: center;
            flex: 1 1 280px; 
            max-width: 300px;
        }
        body.dark .premium-feature-card {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }
        .premium-feature-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        .premium-feature-card .price {
            font-weight: bold;
            color: var(--primary);
            margin-top: 15px;
            font-size: 1.1em;
        }
        .premium-buy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s ease;
            margin-top: 15px;
        }
        .premium-buy-btn:hover {
            background: var(--primary-dark);
        }

        .manual-payment-info {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee; 
            display: none; 
            flex-direction: column;
            align-items: center;
            font-size: 14px;
            color: var(--text-light); 
        }
        body.dark .manual-payment-info {
            border-top-color: #444; 
            color: var(--text-dark); 
        }
        .manual-payment-info p {
            margin-bottom: 5px;
        }
        .manual-payment-info small {
            margin-top: 10px;
            color: #888; 
            text-align: center;
        }
        body.dark .manual-payment-info small {
            color: #aaa; 
        }
        .manual-payment-info img {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            width: 150px; 
            height: 150px; 
            border-radius: var(--radius);
            margin-bottom: 10px; 
        }

        .hidden { display: none !important; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .profile-container {
            position: fixed;
            top: 20px;
            right: 20px; 
            z-index: 999;
        }
        #profile-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--primary);
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.2s ease-in-out;
            object-fit: cover;
        }
        #profile-icon:hover, #profile-icon:focus {
            transform: scale(1.1);
        }
        .profile-dropdown {
            position: absolute;
            top: 55px; 
            right: 0; 
            width: 260px;
            background: var(--card-light);
            border-radius: var(--radius);
            box-shadow: 0 8px 25px var(--shadow-light);
            border: 1px solid #eee;
            overflow: hidden;
            animation: fadeIn 0.3s ease;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        body.dark .profile-dropdown {
            background: var(--card-dark);
            box-shadow: 0 8px 25px var(--shadow-dark);
            border-color: #444;
        }
        .dropdown-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        body.dark .dropdown-header {
            border-bottom-color: #444;
        }
        .dropdown-header img {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }
        .dropdown-header span {
            font-weight: 600;
            font-size: 16px;
            word-break: break-all;
        }
        body.dark .dropdown-header small { color: #bbb !important; }

        .dropdown-menu {
            list-style: none;
            padding: 10px 0;
            margin: 0;
        }
        .dropdown-menu li a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            text-decoration: none;
            color: var(--text-light);
            font-size: 14px;
            transition: background-color 0.2s ease;
        }
        body.dark .dropdown-menu li a {
            color: var(--text-dark);
        }
        .dropdown-menu li a:hover {
            background-color: #f5f5f5;
        }
        body.dark .dropdown-menu li a:hover {
            background-color: #3e3e3e;
        }
        .dropdown-menu li.divider {
            height: 1px;
            margin: 8px 0;
            background: #e0e0e0;
        }
        body.dark .dropdown-menu li.divider {
            background: #444;
        }
        #emailVerifiedStatus .fa-check-circle { color: #28a745; } 
        #emailVerifiedStatus .fa-times-circle { color: #dc3545; } 
        
        .about-dev { display: flex; align-items: center; gap: 25px; margin-top: 15px;  } 
        .about-dev img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary); box-shadow: 0 4px 15px var(--shadow-light); } 
        body.dark .about-dev img { box-shadow: 0 4px 15px var(--shadow-dark); } 
        .about-dev-text { flex: 1; } 
        .about-dev a { color: var(--primary); font-weight: 600; text-decoration: none; } 
        .about-dev a:hover { text-decoration: underline; } 
        
        .modal, .welcome-popup { position: fixed; inset: 0; display: flex; justify-content: center; align-items: center; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(8px); z-index: 1001; } 
        .modal-content, .welcome-content { font-family: 'Inter', sans-serif; background: var(--card-light); color: var(--text-light); padding: 32px; border-radius: var(--radius); text-align: center; max-width: 380px; width: 90%; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); animation: fadeIn 0.5s ease; border: 1px solid rgba(255, 255, 255, 0.1); } 
        body.dark .modal-content, body.dark .welcome-content { background: var(--card-dark); color: var(--text-dark); } 
        .modal-content h2, .welcome-content h2 { margin-bottom: 20px; } 
        .modal-content input { width: 100%; padding: 12px 14px; margin: 8px 0; border: 1px solid #d1d5db; border-radius: var(--radius); font-size: 16px; background: var(--bg-light); color: var(--text-light); } 
        body.dark .modal-content input { border-color: #555; background: #333; } 
        .modal-content button, .welcome-content button { background: var(--primary); color: white; padding: 12px 24px; border: none; border-radius: var(--radius); font-size: 16px; margin-top: 16px; cursor: pointer; transition: background 0.3s ease; width: 100%; } 
        .modal-content button:hover, .welcome-content button:hover { background: var(--primary-dark); } 
        .modal-content a { color: var(--primary); text-decoration: none; font-size: 13px; display: block; margin-top: 12px; }

        #goToTopBtn { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            width: 50px; 
            height: 50px; 
            background-color: var(--primary); 
            color: white; 
            border: none; 
            border-radius: 50%; 
            font-size: 24px; 
            cursor: pointer; 
            display: none; 
            z-index: 1000; 
            box-shadow: 0 4px 12px var(--shadow-light); 
            transition: all 0.3s ease-in-out; 
            display: flex; 
            align-items: center;
            justify-content: center;
        } 
        #goToTopBtn:hover { 
            background-color: var(--primary-dark); 
            transform: scale(1.1); 
        } 
        body.dark #goToTopBtn { box-shadow: 0 4px 12px var(--shadow-dark); } 
        
        #find-replace-dialog { position: fixed; top: 150px; left: 50%; transform: translateX(-50%); background: var(--card-light); padding: 20px; border-radius: var(--radius); box-shadow: 0 8px 25px var(--shadow-light); z-index: 1002; display: flex; gap: 10px; align-items: center; } 
        body.dark #find-replace-dialog { background: var(--card-dark); box-shadow: 0 8px 25px var(--shadow-dark); } 
        #find-replace-dialog input { padding: 8px; border-radius: 8px; border: 1px solid #ccc; } 
        body.dark #find-replace-dialog input { background: #333; border-color: #555; color: var(--text-dark); } 
        #find-replace-dialog button { padding: 8px 12px; } 
        #find-replace-dialog .close-btn { position: absolute; top: 5px; right: 10px; background: transparent; border: none; font-size: 20px; cursor: pointer; } 
        .confetti { font-size: 48px; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); animation: pop 1s ease-out; pointer-events: none; z-index: 2000; } 
        @keyframes pop { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 60% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 0; } }

        .faq-item {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        body.dark .faq-item {
            border-bottom-color: #3a3a3a;
        }

        .faq-item:last-child {
            border-bottom: none; 
        }

        .faq-question {
            font-size: 18px;
            color: var(--primary);
            margin-bottom: 8px;
            cursor: pointer; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600; 
        }

        .faq-question::after {
            content: '\f078'; 
            font-family: 'Font Awesome 6 Free'; 
            font-weight: 900; 
            font-size: 16px;
            margin-left: 10px;
            transition: transform 0.2s ease;
        }

        .faq-question.active::after {
            transform: rotate(180deg); 
        }

        .faq-answer {
            font-size: 15px;
            color: var(--text-light);
            max-height: 0; 
            overflow: hidden; 
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out, padding-top 0.3s ease-out; 
            padding-top: 0; 
            line-height: 1.6; 
            opacity: 0; 
        }
        .faq-answer.show {
            opacity: 1;
            padding-top: 10px; 
        }

        body.dark .faq-answer {
            color: var(--text-dark);
        }

        #calendar-container {
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: 0 4px 15px var(--shadow-light);
            margin-bottom: 25px;
            text-align: center;
        }
        body.dark #calendar-container {
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 18px;
            transition: background 0.2s ease-in-out;
        }

        .calendar-header button:hover {
            background: var(--primary-dark);
        }

        .calendar-header h4 { 
            font-size: 24px;
            color: var(--primary);
            margin: 0 10px;
            flex-grow: 1;
            text-align: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            width: 100%;
            max-width: 600px; 
            margin: 0 auto;
        }

        .calendar-day-header {
            font-weight: 600;
            color: #777;
            padding: 8px 0;
            text-align: center;
            font-size: 14px;
        }
        body.dark .calendar-day-header {
            color: #bbb;
        }

        .calendar-date {
            padding: 10px 5px;
            text-align: center;
            border-radius: 8px;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            font-size: 15px;
            font-weight: 500;
            min-height: 40px; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        body.dark .calendar-date {
            background-color: #3e3e3e;
        }

        .calendar-date:hover:not(.empty):not(.selected) {
            background-color: #e0e0e0;
            transform: translateY(-2px);
        }
        body.dark .calendar-date:hover:not(.empty):not(.selected) {
            background-color: #4a4a4a;
        }

        .calendar-date.empty {
            background-color: transparent;
            cursor: default;
            pointer-events: none;
            opacity: 0.5;
        }

        .calendar-date.current-day {
            background-color: var(--primary);
            color: white;
            font-weight: 700;
        }

        .calendar-date.selected {
            background-color: var(--primary-dark);
            color: white;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transform: scale(1.05);
        }

        #exitCalendarBtn {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #dc3545; 
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        #exitCalendarBtn:hover {
            background-color: #c82333; 
            transform: translateY(-2px);
        }

        #contact-us-section {
            background: var(--card-light);
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: 0 4px 15px var(--shadow-light);
            margin-bottom: 25px;
        }
        body.dark #contact-us-section {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }
        #contact-us-section h2 { 
            text-align: left;
            margin-bottom: 20px; 
        }
        #contact-us-section ul {
            list-style: none;
            padding: 0;
            margin-top: 15px; 
        }
        #contact-us-section li {
            display: flex;
            align-items: center;
            margin-bottom: 15px; 
            font-size: 16px; 
        }
        #contact-us-section li svg {
            width: 24px;
            height: 24px;
            margin-right: 12px; 
            fill: var(--primary); 
        }
        #contact-us-section li a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500; 
        }
        #contact-us-section li a:hover {
            text-decoration: underline;
            color: var(--primary-dark);
        }
        #contact-us-section li span { 
             color: var(--text-light);
        }
        body.dark #contact-us-section li span {
             color: var(--text-dark);
        }

        /* AdSense Container Style */
        .adsense-ad-container {
            margin: 25px auto; /* Centered with top/bottom margin */
            padding: 10px 0; /* Some padding around the ad */
            text-align: center; /* Centers the ad unit if it's narrower than container */
            min-height: 50px; /* Minimum height to prevent collapse before ad loads */
            background-color: var(--card-light); /* Match card background */
            border-radius: var(--radius);
            box-shadow: 0 2px 8px var(--shadow-light); /* Subtle shadow */
        }
        body.dark .adsense-ad-container {
            background-color: var(--card-dark);
            box-shadow: 0 2px 8px var(--shadow-dark);
        }


        @media (max-width: 768px) { 
            .about-dev { flex-direction: column; text-align: center; } 
            .profile-container { top: 10px; right: 10px; } 
            #find-replace-dialog { flex-direction: column; width: 90%; top: 100px; } 
            .mode-switcher { 
                border-left: none; 
                padding-left: 0; 
                margin-left: 0; 
                border-top: 1px solid #ddd; 
                padding-top: 10px; 
                width: 100%; 
                justify-content: center;
            } 
            body.dark .mode-switcher { border-top-color: #555;}
            .calendar-day-header, .calendar-date {
                font-size: 12px; 
                padding: 5px 2px;
                min-height: 30px;
            }
            .open-nav-btn {
                left: 15px;
            }
            .sidenav a { font-size: 18px; }
            h2, h3 { font-size: 20px; }
            .blog-post h4 { font-size: 18px; }
        }
        @media (max-width: 480px) {
            #menu-bar button, #menu-bar select { padding: 8px 10px; font-size: 13px; }
            .mode-switcher button { padding: 8px 10px; font-size: 13px;}
        }

    </style>
</head>
<body>

<div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">√ó</a>
  <a href="#" onclick="closeAndScrollToTop()">Home</a>
  <a href="#overview" onclick="closeNavAndScroll('#overview')">Overview</a>
  <a href="#about" onclick="closeNavAndScroll('#about')">About</a>
  <a href="#blogs-section" onclick="closeNavAndScroll('#blogs-section')">Blog</a>
  <a href="#faq-section" onclick="closeNavAndScroll('#faq-section')">FAQ</a>
  <a href="#privacy-policy-section" onclick="closeNavAndScroll('#privacy-policy-section')">Privacy Policy</a>
  <a href="#terms-of-service-section" onclick="closeNavAndScroll('#terms-of-service-section')">Terms of Service</a>
  <a href="#contact-us-section" onclick="closeNavAndScroll('#contact-us-section')">Contact</a>
</div>

<div id="profile-container" class="profile-container">
    <img id="profile-icon" src="https://ui-avatars.com/api/?name=U" alt="Profile" tabindex="0">
    <div id="profile-dropdown" class="profile-dropdown hidden">
        <div class="dropdown-header">
            <img id="userPic" src="https://ui-avatars.com/api/?name=U&background=random&color=fff" alt="Profile"> 
            <div>
                <span id="userNameDisplay">User Name</span>
                <small id="userEmailDisplay" style="color: #888; display: block; font-weight: 400;"></small>
            </div>
        </div>
        <ul class="dropdown-menu">
            <li><a href="#" id="editProfilePhotoBtn"><i class="fas fa-camera fa-fw"></i> Edit Profile Photo</a></li>
            <li><a href="#" id="verifyEmailBtn"><i class="fas fa-envelope fa-fw"></i> Verify Email <span id="emailVerifiedStatus"></span></a></li>
            <li><a href="#" id="resetPasswordBtn"><i class="fas fa-key fa-fw"></i> Reset Password</a></li>
            <li class="divider"></li>
            <li><a href="#" id="manageAccountBtn"><i class="fas fa-user-cog fa-fw"></i> Manage Account</a></li> 
            <li class="divider"></li>
            <li><a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt fa-fw"></i> Logout</a></li>
        </ul>
    </div>
</div>
<input type="file" id="photoUpload" class="hidden" accept="image/*">

<header>
    <span class="open-nav-btn" onclick="openNav()">‚ò∞</span>
    <div class="header-content">
        <h1>
            <a href="#" onclick="event.preventDefault(); refreshPage();" style="text-decoration: none; color: inherit;">
                üìù NOTE_<span style="color:#ffc107">P@D</span>
            </a>
        </h1>
        <p style="margin-top: 5px; font-weight: 300; opacity: 0.9;">Notepad, Whiteboard, and To-Do List</p>
    </div>
</header>

<main class="container">
    <div id="menu-bar">
        <button onclick="newDoc()">üìù New</button>
        <button onclick="saveNote()">üíæ Save</button>
        <button onclick="undo()" title="Undo (Ctrl+Z)">‚Ü©Ô∏è Undo</button>
        <button onclick="redo()" title="Redo (Ctrl+Y)">‚Ü™Ô∏è Redo</button>
        <button onclick="cutText()">‚úÇÔ∏è Cut</button>
        <button onclick="showFindReplace()">üîç Find/Replace</button>
        <button id="installBtn" class="hidden">üíª Install App</button>
        <select id="font-family" onchange="changeFont()" title="Change Font Family">
            <option value="Poppins">Poppins</option>
            <option value="Arial">Arial</option>
            <option value="Courier New">Courier New</option>
            <option value="Georgia">Georgia</option>
        </select>
        <select id="font-size" onchange="changeFontSize()" title="Change Font Size">
            <option value="16px" selected>16px</option>
            <option value="18px">18px</option>
            <option value="20px">20px</option>
        </select>
        <button onclick="toggleDark()" title="Toggle Dark/Light Mode">üåó</button>

        <div class="mode-switcher">
            <button id="mode-notepad" onclick="switchMode('notepad')" class="active-mode">Notepad</button>
            <button id="mode-whiteboard" onclick="switchMode('whiteboard')">Whiteboard</button>
            <button id="mode-todo" onclick="switchMode('todo')">To-Do List</button>
            <button id="mode-calendar" onclick="switchMode('calendar')">üóìÔ∏è Calendar</button>
            <button id="mode-blog" onclick="switchMode('blog')">Blog</button>
        </div>
    </div>

    <div id="editor">
        <input type="text" id="note-title" placeholder="Your Note Title..." />
        <textarea id="note-text" placeholder="Start typing... your work is saved automatically." rows="10"></textarea>
        <div id="todo-list-container" class="hidden"></div>
        <button id="add-todo-btn" class="hidden" onclick="addTodoItem()">+ Add Item</button>
        <div id="editor-stats">
            <div id="char-count">Character Count: 0</div>
            <div id="word-count">Word Count: 0</div>
        </div>
    </div>

    <div id="whiteboard-container" class="hidden">
        <input type="text" id="whiteboard-title" placeholder="Your Whiteboard Title..." style="width: 100%; font-size: 20px; font-weight: 600; padding: 12px; border-radius: var(--radius); border: 1px solid #e0e0e0; margin-bottom: 15px;" />
        <canvas id="whiteboard-canvas"></canvas>
        <div id="whiteboard-toolbar">
            <label for="wb-color">Color:</label>
            <input type="color" id="wb-color" value="#000000">
            <label for="wb-size">Size:</label>
            <input type="range" id="wb-size" min="1" max="50" value="5">
            <button id="wb-eraser">Eraser</button>
            <button id="wb-clear">Clear</button>
            <button id="wb-download">Download PNG</button>
        </div>
    </div>

    <div id="calendar-container" class="hidden">
        <h3>üóìÔ∏è Calendar</h3>
        <div class="calendar-header">
            <button id="prevMonthBtn"><i class="fas fa-chevron-left"></i></button>
            <h4 id="currentMonthYear"></h4>
            <button id="nextMonthBtn"><i class="fas fa-chevron-right"></i></button>
        </div>
        <div class="calendar-grid">
            <div class="calendar-day-header">Sun</div>
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>
            </div>
        <button id="exitCalendarBtn">Exit Calendar</button>
    </div>

    <div id="blogs-section" class="info-section hidden"> 
        <h3><i class="fas fa-blog" style="color: #6610f2; margin-right: 8px;"></i>Productivity Insights & Blog</h3>
        <div id="blog-list">
        </div>
    </div>

    <!-- AdSense Ad Unit Start -->
    <div class="adsense-ad-container">
        <!-- Note Pad -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-3010913100191778"
             data-ad-slot="1810825365"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
    <!-- AdSense Ad Unit End -->

    <div id="notes"> 
        <h3 style="text-align: center;"><i class="fas fa-star" style="color: gold; margin-right: 8px;"></i>Your Saved Notes</h3>
        <div id="note-list"></div>
    </div>
   
    <div id="premium-features-section" class="info-section hidden"> 
        <h3 style="text-align: center;">Unlock Premium Features</h3>
        <div class="premium-offerings">
            <div class="premium-feature-card">
                <h4>Advanced Cloud Sync</h4>
                <p>Sync your notes across all your devices seamlessly.</p>
                <p class="price">Price: Rs. 100/month</p>
                <button class="premium-buy-btn" data-feature="cloud-sync" data-price="100">Upgrade to Premium</button>
                <div class="manual-payment-info">
                    <p>Pay manually via Esewa:</p>
                    <img src="https://i.ibb.co/L8nCNtjv/IMG-0120.jpg" alt="Esewa QR Code for B.T Mobile Care">
                    <p><strong>Esewa ID:</strong> B.T Mobile Care</p>
                    <p><strong>Esewa Number:</strong> 9827801575</p>
                    <small>After payment, please contact us with your transaction ID to activate your feature.</small>
                </div>
            </div>
            <div class="premium-feature-card">
                <h4>Priority Support</h4>
                <p>Get faster responses to your queries.</p>
                <p class="price">Price: Rs. 50/month</p>
                <button class="premium-buy-btn" data-feature="priority-support" data-price="50">Upgrade to Premium</button>
                <div class="manual-payment-info">
                    <p>Pay manually via Esewa:</p>
                    <img src="https://i.ibb.co/L8nCNtjv/IMG-0120.jpg" alt="Esewa QR Code for B.T Mobile Care">
                    <p><strong>Esewa ID:</strong> B.T Mobile Care</p>
                    <p><strong>Esewa Number:</strong> 9827801575</p>
                    <small>After payment, please contact us with your transaction ID to activate your feature.</small>
                </div>
            </div>
        </div>
    </div>

    <div class="info-section" id="overview">
        <h3>Welcome to Note P@d: Your All-in-One Digital Workspace</h3>
        <p>Note P@d is more than just an online notepad; it's your versatile, browser-based companion designed for modern productivity. Whether you're capturing fleeting ideas, journaling your thoughts, brainstorming new projects, drafting important content, sketching diagrams, or managing your daily tasks, Note P@d offers a fast, secure, and efficient experience. Forget bulky software installations ‚Äì open Note P@d in your browser, and you're ready to create, organize, and achieve. It's lightweight, incredibly fast, and meticulously focused on providing a seamless, distraction-free environment for all your needs.</p>
        <p>Our platform integrates a powerful text editor, a dynamic digital whiteboard, a simple to-do list manager, and a handy calendar, all designed to work harmoniously. With offline capabilities and local data storage, your work is always accessible and private. Explore our <a href="#blogs-section" onclick="switchModeAndScroll('blog', '#blogs-section')">Productivity Insights blog</a> for tips and tricks to maximize your efficiency with Note P@d and beyond.</p>
    </div>

    <div class="info-section" id="how-it-works">
        <h3>How Note P@d Works: Secure, Offline, and In Your Browser</h3>
        <p>Note P@d leverages cutting-edge web technologies like HTML5, CSS3, and JavaScript to deliver a smooth, responsive, and private user experience. Here‚Äôs a breakdown of its core principles:</p>
        <ul>
            <li><strong>Local Storage First:</strong> For basic usage without an account, all notes, drawings, and to-do lists you create are stored directly in your browser‚Äôs <code>localStorage</code>. This means your data never leaves your computer by default and isn't transmitted to any external server, ensuring 100% privacy on your device.</li>
            <li><strong>Offline Functionality (PWA):</strong> Note P@d is a Progressive Web App (PWA). After your first visit, it caches essential resources, allowing you to use most features even without an active internet connection. This makes it a reliable tool wherever you are.</li>
            <li><strong>Client-Side Processing:</strong> Features like PDF export for notes and PNG downloads for whiteboards are handled by powerful JavaScript libraries (like jsPDF) directly within your browser. This maintains speed and privacy.</li>
            <li><strong>Optional User Accounts:</strong> While basic use requires no sign-up, creating an account (via email or Google Sign-In) unlocks features like multi-device synchronization (premium), profile management, and potentially other collaborative tools in the future. Account data is handled securely.</li>
            <li><strong>Intuitive Interface:</strong> We believe in simplicity. The interface is designed to be clean and intuitive, allowing you to focus on your tasks without a steep learning curve.</li>
        </ul>
        <p>Remember, if you are not using an account with cloud sync, clearing your browser's site data will permanently delete your locally stored notes. Always use the export features or consider an account for important data backup.</p>
    </div>

    <div class="info-section" id="about">
        <h3>About the Developer: Bishal Mishra</h3>
        <div class="about-dev">
            <img src="https://i.ibb.co/Y4ygWpC2/Untitled-design.png" alt="Bishal Mishra, Developer of Note P@d" border="0">
            <div class="about-dev-text">
                <p>Note P@d is meticulously crafted and passionately maintained by <strong><a href="https://www.facebook.com/share/166miohhL6/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer">Bishal Mishra</a></strong>, a web developer dedicated to building digital tools that are simple, powerful, and prioritize user privacy and experience. With a keen interest in productivity and web technologies, Bishal envisioned Note P@d as a go-to solution for individuals seeking a versatile and reliable online workspace.</p>
                <p>The philosophy behind Note P@d is to provide a comprehensive suite of tools that aid in daily organization and creativity, without unnecessary complexities. This project is a testament to the power of modern web capabilities to create applications that are accessible, efficient, and user-centric. Bishal believes in continuous improvement and values user feedback to make Note P@d even better.</p>
                <p>Connect with Bishal on <a href="https://www.facebook.com/share/166miohhL6/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer">Facebook</a> or visit his <a href="https://bishalmishra.com" target="_blank" rel="noopener noreferrer">personal website</a> to learn more about his work and other projects.</p>
            </div>
        </div>
    </div>

    <div class="info-section" id="privacy"> 
        <h3>Your Privacy & Security: Our Commitment</h3>
        <p>At Note P@d, your data privacy and security are paramount. We believe in absolute transparency and user control over information. Here's our commitment:</p>
        <ul>
            <li><strong>Local Data by Default:</strong> For users not signed into an account, all created content (notes, drawings, to-dos) is stored exclusively in your browser's local storage. It is *never* sent to our servers.</li>
            <li><strong>No Tracking (Anonymous Use):</strong> We do not track your activity or content when you use the app anonymously.</li>
            <li><strong>Secure Account Data:</strong> If you choose to create an account for features like cloud sync, your account information (like email and hashed password) is stored securely. We use industry-standard practices for data protection.</li>
            <li><strong>User Control:</strong> You have control over your data. You can export your notes and drawings, and delete your account and associated data if you choose (subject to our full Privacy Policy).</li>
        </ul>
        <p>We encourage you to read our full <a href="#privacy-policy-section" onclick="scrollToSection('#privacy-policy-section')">Privacy Policy</a> for detailed information on how we collect, use, and protect your information. Your trust is important to us, and we strive to create a secure environment for your thoughts and ideas.</p>
    </div>

    <div class="info-section" id="faq-section">
        <h3>Frequently Asked Questions (FAQ)</h3>
        <div class="faq-item">
            <h4 class="faq-question">What is Note P@d?</h4>
            <p class="faq-answer">Note P@d is a free, versatile online application offering a modern notepad, a digital whiteboard for drawing, a to-do list manager, and a calendar. It's designed to be fast, secure, work offline (as a PWA), and save your data locally in your browser for basic use. Optional account features provide extended capabilities like cloud sync.</p>
        </div>
        <div class="faq-item">
            <h4 class="faq-question">Is my data safe and private with Note P@d?</h4>
            <p class="faq-answer">Yes, data privacy is a top priority. For users without an account, all notes and data are stored locally in your browser's localStorage and are never transmitted to any external server. This means your data remains 100% on your device. If you use account features, we employ security measures to protect your data as outlined in our Privacy Policy.</p>
        </div>
        <div class="faq-item">
            <h4 class="faq-question">Can I use Note P@d offline?</h4>
            <p class="faq-answer">Absolutely! Note P@d is a Progressive Web App (PWA). After your first visit with an internet connection, it caches the necessary files, allowing you to use it offline. This makes it a reliable tool even when you don't have internet access.</p>
        </div>
        <div class="faq-item">
            <h4 class="faq-question">Do I need to sign up or create an account?</h4>
            <p class="faq-answer">No sign-up is required for basic local note-taking, whiteboard use, or to-do list management. You can start using these features immediately. An account is optional and provides benefits like multi-user profile management, potential cloud synchronization for premium users, and access to other advanced features.</p>
        </div>
        <div class="faq-item">
            <h4 class="faq-question">How do I export my notes or drawings?</h4>
            <p class="faq-answer">You can easily export your content. Notepad entries can be exported as PDF files using the "PDF" button available with each saved note. Whiteboard drawings can be downloaded as PNG image files directly from the whiteboard interface.</p>
        </div>
        <div class="faq-item">
            <h4 class="faq-question">What are the premium features?</h4>
            <p class="faq-answer">Premium features, such as Advanced Cloud Sync and Priority Support, are available for users who wish to enhance their Note P@d experience. These are typically offered via a subscription and require an account. You can find more details in the "Unlock Premium Features" section if you are logged in.</p>
        </div>
        <div class="faq-item">
            <h4 class="faq-question">How can I provide feedback or get support?</h4>
            <p class="faq-answer">We welcome your feedback! You can contact us through the details provided in the <a href="#contact-us-section" onclick="scrollToSection('#contact-us-section')">Contact Us</a> section. For users with premium accounts, priority support options are available.</p>
        </div>
    </div>

    <div id="privacy-policy-section" class="info-section">
        <h3>Privacy Policy for Note P@d</h3>
        <p><strong>Last Updated:</strong> July 28, 2024</p>
        
        <p>Welcome to Note P@d ("us", "we", or "our"). We are committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you visit our website [your-domain-here.com] (the "Site") and use our services (the "Services"). Please read this privacy policy carefully. If you do not agree with the terms of this privacy policy, please do not access the site.</p>

        <h4>1. Information We Collect</h4>
        <p>We may collect information about you in a variety of ways:</p>
        <ul>
            <li><strong>Personal Data (for Account Holders):</strong> If you register for an account, we may collect personally identifiable information, such as your name, email address, and profile picture if you provide one or sign in via Google. For premium services, payment information may be processed by third-party payment processors (e.g., Esewa), and we may receive transaction confirmation details but not your full financial details.</li>
            <li><strong>Locally Stored Data (Anonymous Use):</strong> For users not signed in, all notes, titles, whiteboard content, and to-do lists are stored directly in your browser's localStorage. This data is not transmitted to our servers.</li>
            <li><strong>Derivative Data:</strong> Information our servers automatically collect when you access the Site (if applicable, e.g., IP address, browser type, access times), primarily for security and operational purposes. This is typically anonymized or aggregated.</li>
            <li><strong>Cookies and Web Beacons:</strong> We may use cookies, web beacons, tracking pixels, and other tracking technologies on the Site to help customize the Site and improve your experience. Basic cookies are used for session management (e.g., dark mode preference, login status). You can remove or reject cookies through your browser settings.</li>
        </ul>

        <h4>2. Use of Your Information</h4>
        <p>Having accurate information permits us to provide you with a smooth, efficient, and customized experience. Specifically, we may use information collected about you via the Site or our Services to:</p>
        <ul>
            <li>Create and manage your account.</li>
            <li>Provide the core functionalities of Note P@d (notepad, whiteboard, to-do list, calendar).</li>
            <li>Process payments and refunds (for premium features).</li>
            <li>Email you regarding your account or order.</li>
            <li>Enable user-to-user communications (if such features are implemented).</li>
            <li>Improve our website and services.</li>
            <li>Monitor and analyze usage and trends to improve your experience with the Site.</li>
            <li>Notify you of updates to the Site or Services.</li>
            <li>Offer new products, services, and/or recommendations to you (with your consent where required).</li>
            <li>Prevent fraudulent transactions, monitor against theft, and protect against criminal activity.</li>
            <li>Resolve disputes and troubleshoot problems.</li>
            <li>Respond to product and customer service requests.</li>
        </ul>

        <h4>3. Disclosure of Your Information</h4>
        <p>We do not share, sell, rent, or trade your personally identifiable information with third parties for their marketing purposes without your explicit consent. We may share information we have collected about you in certain situations:</p>
        <ul>
            <li><strong>By Law or to Protect Rights:</strong> If we believe the release of information about you is necessary to respond to legal process, to investigate or remedy potential violations of our policies, or to protect the rights, property, and safety of others, we may share your information as permitted or required by any applicable law, rule, or regulation.</li>
            <li><strong>Third-Party Service Providers:</strong> We may share your information with third parties that perform services for us or on our behalf, including payment processing (Esewa for manual payments, Google for Google Sign-In), data analysis, email delivery, hosting services, and customer service.</li>
            <li><strong>Business Transfers:</strong> We may share or transfer your information in connection with, or during negotiations of, any merger, sale of company assets, financing, or acquisition of all or a portion of our business to another company.</li>
            <li><strong>With Your Consent:</strong> We may disclose your personal information for any other purpose with your consent.</li>
        </ul>
        <p><strong>Note on Google Sign-In:</strong> If you sign in using Google, we receive profile information from Google as per their policies and your privacy settings with them. We use this information solely for account creation and display within your profile on Note P@d.</p>


        <h4>4. Security of Your Information</h4>
        <p>We use administrative, technical, and physical security measures to help protect your personal information. While we have taken reasonable steps to secure the personal information you provide to us, please be aware that despite our efforts, no security measures are perfect or impenetrable, and no method of data transmission can be guaranteed against any interception or other type of misuse. For data stored locally in your browser, the security is dependent on the security of your own device and browser.</p>

        <h4>5. Policy for Children</h4>
        <p>We do not knowingly solicit information from or market to children under the age of 13 (or higher age as required by applicable law). If you become aware of any data we have collected from children under age 13, please contact us using the contact information provided below.</p>

        <h4>6. Your Data Rights (e.g., GDPR, CCPA if applicable)</h4>
        <p>Depending on your location, you may have certain rights regarding your personal data, such as the right to access, correct, delete, or restrict the processing of your data. To exercise these rights, please contact us. We will respond to your request within a reasonable timeframe as required by law.</p>
        
        <h4>7. Changes to This Privacy Policy</h4>
        <p>We may update this Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page and updating the "Last Updated" date. You are advised to review this Privacy Policy periodically for any changes.</p>

        <h4>8. Contact Us</h4>
        <p>If you have questions or comments about this Privacy Policy, please contact us using the details in the <a href="#contact-us-section" onclick="scrollToSection('#contact-us-section')">Contact Us</a> section of this website.</p>
        
    </div>

    <div id="terms-of-service-section" class="info-section">
        <h3>Terms of Service for Note P@d</h3>
        <p><strong>Last Updated:</strong> July 26, 2025</p>

        <p>Please read these Terms of Service ("Terms", "Terms of Service") carefully before using the [www.bishalmishra.com] website (the "Service") operated by Note P@d ("us", "we", or "our").</p>
        <p>Your access to and use of the Service is conditioned upon your acceptance of and compliance with these Terms. These Terms apply to all visitors, users, and others who wish to access or use the Service.</p>
        <p>By accessing or using the Service you agree to be bound by these Terms. If you disagree with any part of the terms then you do not have permission to access the Service.</p>

        <h4>1. Accounts</h4>
        <p>When you create an account with us, you guarantee that you are above the age of 13 (or the applicable age of majority in your jurisdiction) and that the information you provide us is accurate, complete, and current at all times. Inaccurate, incomplete, or obsolete information may result in the immediate termination of your account on the Service.</p>
        <p>You are responsible for maintaining the confidentiality of your account and password, including but not limited to the restriction of access to your computer and/or account. You agree to accept responsibility for any and all activities or actions that occur under your account and/or password.</p>

        <h4>2. Use of the Service</h4>
        <p>Note P@d provides a platform for note-taking, whiteboard drawing, to-do list management, and calendaring. You agree not to use the Service:</p>
        <ul>
            <li>For any unlawful purpose or in any way that interrupts, damages, impairs or renders the Service less efficient.</li>
            <li>To transmit, upload, or post any material which is defamatory, offensive, obscene, or otherwise illegal, or which may cause annoyance, inconvenience, or needless anxiety.</li>
            <li>To attempt to gain unauthorized access to any part of the Service, or any systems or networks connected to the Service.</li>
            <li>To store or share content that infringes on the intellectual property rights of others.</li>
        </ul>
        <p>We reserve the right to terminate or restrict your access to the Service if you violate these Terms, without notice.</p>
        
        <h4>3. Content Ownership and Responsibility</h4>
        <p><strong>Your Content:</strong> You retain all ownership rights to the content you create, upload, or store using the Service ("User Content"). For content stored locally in your browser, it remains solely on your device. If you use cloud sync features (if available), you grant us a limited license to store, process, and display your User Content solely for the purpose of providing the Service to you.</p>
        <p><strong>Our Content:</strong> The Service and its original content (excluding User Content), features, and functionality are and will remain the exclusive property of Note P@d and its licensors. Our trademarks and trade dress may not be used in connection with any product or service without our prior written consent.</p>

        <h4>4. Premium Features and Payments</h4>
        <p>Coming Soon</p>
        <p>Certain features of the Service may be offered on a subscription basis ("Premium Features"). If you choose to purchase Premium Features, you agree to pay the fees specified. Payments are typically processed through third-party payment processors (e.g., Esewa). All payment terms will be disclosed to you prior to purchase.</p>
        <p>We reserve the right to change our subscription plans or adjust pricing for our services in any manner and at any time as we may determine in our sole and absolute discretion. Any price changes or changes to your subscription plan will take effect following notice to you.</p>

        <h4>5. Intellectual Property</h4>
        <p>The Service and its original content, features, and functionality are owned by Bishal Mishra and are protected by copyright, trademark, and other intellectual property laws.</p>

        <h4>6. Disclaimer of Warranties; Limitation of Liability</h4>
        <p>The Service is provided on an "AS IS" and "AS AVAILABLE" basis. We make no warranties, expressed or implied, regarding the operation or availability of the Service, or the information, content, materials, or products included thereon. To the fullest extent permissible by applicable law, we disclaim all warranties, express or implied, including, but not limited to, implied warranties of merchantability and fitness for a particular purpose.</p>
        <p>We will not be liable for any damages of any kind arising from the use of this Service, including, but not limited to direct, indirect, incidental, punitive, and consequential damages. You are responsible for backing up data stored locally. We are not responsible for any loss of data.</p>

        <h4>7. Termination</h4>
        <p>We may terminate or suspend your account and bar access to the Service immediately, without prior notice or liability, under our sole discretion, for any reason whatsoever and without limitation, including but not limited to a breach of the Terms.</p>
        <p>If you wish to terminate your account, you may simply discontinue using the Service or contact us to request account deletion.</p>

        <h4>8. Governing Law</h4>
        <p>These Terms shall be governed and construed in accordance with the laws of Nepal, without regard to its conflict of law provisions.</p>

        <h4>9. Changes to Terms</h4>
        <p>We reserve the right, at our sole discretion, to modify or replace these Terms at any time. If a revision is material we will provide at least 30 days' notice prior to any new terms taking effect. What constitutes a material change will be determined at our sole discretion.</p>
        <p>By continuing to access or use our Service after any revisions become effective, you agree to be bound by the revised terms. If you do not agree to the new terms, you are no longer authorized to use the Service.</p>

        <h4>10. Contact Us</h4>
        <p>If you have any questions about these Terms, please contact us using the details in the <a href="#contact-us-section" onclick="scrollToSection('#contact-us-section')">Contact Us</a> section of this website.</p>
    </div>
 
    <div id="contact-us-section"> 
        <h2>Contact Us</h2>
        <ul>
            <li>
                <svg viewBox="0 0 24 24"><path d="M20,15.5C18.83,15.5 17.67,15.33 16.56,15C16.3,14.92 16,15 15.82,15.21L13.21,17.83C10.38,16.39 7.61,13.62 6.17,10.79L8.79,8.17C9,8 9.08,7.7 9,7.44C8.67,6.33 8.5,5.17 8.5,4A1.5,1.5 0 0,0 7,2.5H4A1.5,1.5 0 0,0 2.5,4C2.5,13.39 10.61,21.5 20,21.5A1.5,1.5 0 0,0 21.5,20V17A1.5,1.5 0 0,0 20,15.5Z" /></svg>
                <span>+977 9827801575, +977 9828138995</span>
            </li>
            <li>
                <svg viewBox="0 0 32 32"><path d="M16.001 2.667c-7.364 0-13.334 5.969-13.334 13.333 0 2.354.622 4.655 1.802 6.667l-1.864 5.401 5.569-1.813c1.937 1.061 4.119 1.619 6.463 1.619h.002c7.365 0 13.334-5.97 13.334-13.334 0-3.555-1.383-6.899-3.896-9.413s-5.858-3.46-9.276-3.46zM16 26.667c-1.984 0-3.938-.519-5.657-1.5l-.404-.231-3.292 1.073 1.096-3.176-.256-.417c-1.063-1.732-1.624-3.729-1.624-5.719 0-6.065 4.935-11 11-11 2.938 0 5.7 1.146 7.775 3.221 2.073 2.073 3.225 4.835 3.225 7.779 0 6.066-4.935 11-11 11zm6.219-7.865c-.338-.169-2.004-.988-2.316-1.102s-.537-.169-.763.17- .876 1.102-1.075 1.33c-.198.225-.394.254-.732.085-.339-.17-1.431-.528-2.723-1.684-1.007-.9-1.687-2.008-1.885-2.347-.198-.34-.021-.522.149-.69.152-.151.34-.394.509-.592.169-.199.225-.339.339-.564.113-.226.056-.423-.028-.593-.084-.17-.763-1.84-1.046-2.516-.276-.661-.558-.572-.763-.582l-.65-.012c-.198 0-.52.074-.791.339s-1.04 1.016-1.04 2.48 1.065 2.875 1.213 3.075c.149.198 2.097 3.2 5.083 4.487.711.306 1.264.489 1.696.626.713.227 1.36.195 1.871.119.571-.085 1.744-.712 1.99-1.4.247-.688.247-1.28.172-1.4-.07-.113-.308-.18-.646-.34z"/></svg>
                <a href="https://wa.me/9779827801575" target="_blank" rel="noopener noreferrer">WhatsApp (+977 9827801575)</a>
            </li>
            <li>
                <svg viewBox="0 0 24 24"><path d="M12 13.065L1.5 6.75V18a1.5 1.5 0 001.5 1.5h18a1.5 1.5 0 001.5-1.5V6.75l-10.5 6.315zM21 4.5H3a1.5 1.5 0 00-1.2.6l10.2 6.135L22.2 5.1A1.5 1.5 0 0021 4.5z"/></svg>
                <a href="mailto:bishalmishra9000@gmail.com">bishalmishra9000@gmail.com</a>
            </li>
            <li>
                <svg viewBox="0 0 24 24"><path d="M22.675 0H1.325C.593 0 0 .593 0 1.326V22.67c0 .733.593 1.326 1.325 1.326h11.495V14.7h-3.13v-3.622h3.13V8.41c0-3.1 1.893-4.788 4.66-4.788 1.325 0 2.464.099 2.796.143v3.24h-1.918c-1.504 0-1.796.716-1.796 1.766v2.316h3.59l-.467 3.622h-3.123V24h6.116c.73 0 1.323-.593 1.323-1.326V1.326C24 .593 23.406 0 22.675 0z"/></svg>
                <a href="https://www.facebook.com/share/19LTBhKXuy/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer">Facebook Page</a>
            </li>
            <li>
                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12c0 4.67 3.26 8.56 7.6 9.74.56.1.77-.24.77-.53v-1.87c-3.1.67-3.75-1.49-3.75-1.49-.5-1.29-1.21-1.63-1.21-1.63-.99-.68.07-.67.07-.67 1.1.08 1.68 1.12 1.68 1.12.97 1.66 2.54 1.18 3.16.9.1-.7.38-1.18.69-1.45-2.47-.28-5.06-1.23-5.06-5.5 0-1.22.43-2.21 1.14-3-.12-.28-.49-1.41.11-2.94 0 0 .93-.3 3.05 1.15.88-.24 1.83-.36 2.77-.36.94 0 1.89.12 2.77.36 2.12-1.45 3.05-1.15 3.05-1.15.6 1.53.23 2.66.11 2.94.71.79 1.14 1.78 1.14 3 0 4.28-2.6 5.22-5.07 5.5.39.34.73 1.01.73 2.03v3c0 .29.21.63.78.52A10.004 10.004 0 0022 12c0-5.52-4.48-10-10-10z"/></svg>
                <a href="https://bishalmishra.com" target="_blank" rel="noopener noreferrer">www.bishalmishra.com</a> 
            </li>
        </ul>
    </div>
</main>

<div id="welcomePopup" class="welcome-popup hidden"> <div class="welcome-content"> <h2>Welcome to Note P@d!</h2> <p>Capture your ideas. Organize your thoughts. Let‚Äôs get started!</p> <button id="getStartedBtn">Get Started</button> </div> </div>
<div id="authModal" class="modal hidden"> <div class="modal-content"> <h2 id="authTitle">Sign In to Note P@d</h2> <input type="text" id="authUsername" placeholder="Username (Email)" autocomplete="username"/> <input type="password" id="authPassword" placeholder="Password" autocomplete="current-password"/> <button id="authSubmit">Sign In</button> <div id="googleSignInDiv" style="margin: 20px auto 0; display: flex; justify-content: center;"></div> <a href="#" id="forgotPassword">Forgot Password?</a> <p id="switchMode">Don't have an account? <a href="#">Sign Up</a></p> </div> </div>
<div id="find-replace-dialog" class="hidden"> <input type="text" id="find-input" placeholder="Find..."> <input type="text" id="replace-input" placeholder="Replace with..."> <button id="replace-btn">Replace</button> <button id="replace-all-btn">Replace All</button> <button id="close-find-replace" class="close-btn" title="Close">√ó</button> </div>
<button id="goToTopBtn" title="Go to top" aria-label="Go to top">‚Üë</button>
<div id="confetti" class="confetti hidden">üéâ</div>
<audio id="loginSound" src="https://www.fesliyanstudios.com/play-mp3/387" preload="auto"></audio>

<footer>
   <p>Copyright ¬© <span id="currentYear"></span> <a href="https://www.facebook.com/share/166miohhL6/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer">Bishal Mishra</a> | All Rights Reserved.</p>
   <div>
        <a href="#privacy-policy-section" onclick="scrollToSection('#privacy-policy-section')">Privacy Policy</a> |
        <a href="#terms-of-service-section" onclick="scrollToSection('#terms-of-service-section')">Terms of Service</a> |
        <a href="#contact-us-section" onclick="scrollToSection('#contact-us-section')">Contact Us</a>
   </div>
</footer>


<script>
// --- GLOBAL VARIABLES ---
let editModeId = null;
let isSignUp = false;
let deferredInstallPrompt = null;
let undoStack = [];
let redoStack = [];
let lastChangeTimeout = null;
let currentMode = 'notepad';
let whiteboardState = { canvas: null, ctx: null, isDrawing: false, isErasing: false, lastX: 0, lastY: 0, brushColor: '#000000', brushSize: 5, imageData: null };

let currentCalendarDate = new Date(); 

const titleInput = document.getElementById('note-title');
const textInput = document.getElementById('note-text');
const noteList = document.getElementById('note-list');
const charCount = document.getElementById('char-count');
const wordCount = document.getElementById('word-count');
const installBtn = document.getElementById('installBtn');
const editorSection = document.getElementById('editor');
const whiteboardSection = document.getElementById('whiteboard-container');
const todoListContainer = document.getElementById('todo-list-container');
const addTodoBtn = document.getElementById('add-todo-btn');
const whiteboardCanvas = document.getElementById('whiteboard-canvas');
const whiteboardTitleInput = document.getElementById('whiteboard-title');
const findReplaceDialog = document.getElementById('find-replace-dialog');
const goToTopBtn = document.getElementById('goToTopBtn');
const welcomePopup = document.getElementById('welcomePopup');
const authModal = document.getElementById('authModal');
const authTitle = document.getElementById('authTitle');
const authUsername = document.getElementById('authUsername');
const authPassword = document.getElementById('authPassword');
const authSubmit = document.getElementById('authSubmit');
const switchAuthModeLink = document.getElementById('switchMode');
const confetti = document.getElementById('confetti');
const loginSound = document.getElementById('loginSound');

const profileContainer = document.getElementById('profile-container');
const profileIcon = document.getElementById('profile-icon');
const profileDropdown = document.getElementById('profile-dropdown');
const userPic = document.getElementById('userPic');
const userNameDisplay = document.getElementById('userNameDisplay');
const userEmailDisplay = document.getElementById('userEmailDisplay');
const emailVerifiedStatus = document.getElementById('emailVerifiedStatus');
const logoutBtn = document.getElementById('logoutBtn');
const verifyEmailBtn = document.getElementById('verifyEmailBtn');
const resetPasswordBtn = document.getElementById('resetPasswordBtn');
const editProfilePhotoBtn = document.getElementById('editProfilePhotoBtn');
const photoUploadInput = document.getElementById('photoUpload');
const manageAccountBtn = document.getElementById('manageAccountBtn'); 

const blogsSection = document.getElementById('blogs-section');
const blogList = document.getElementById('blog-list'); 

const calendarContainer = document.getElementById('calendar-container');
const currentMonthYearDisplay = document.getElementById('currentMonthYear');
const calendarGrid = document.querySelector('#calendar-container .calendar-grid'); 
const prevMonthBtn = document.getElementById('prevMonthBtn');
const nextMonthBtn = document.getElementById('nextMonthBtn');
const exitCalendarBtn = document.getElementById('exitCalendarBtn'); 

const premiumFeaturesSection = document.getElementById('premium-features-section'); 
const QR_CODE_IMAGE_URL = "https://i.ibb.co/L8nCNtjv/IMG-0120.jpg"; 

// --- SIDENAV & SCROLL FUNCTIONS ---
function openNav() {
    document.getElementById("mySidenav").style.width = "280px"; // Slightly wider for more links
}

function closeNav() {
    document.getElementById("mySidenav").style.width = "0";
}

function scrollToSection(selector) {
    const element = document.querySelector(selector);
    if (element) {
        element.scrollIntoView({ behavior: 'smooth' });
    }
}

function closeNavAndScroll(selector) {
    closeNav();
    // Use a timeout to ensure nav is closed before scrolling, avoids jitter
    setTimeout(() => {
        scrollToSection(selector);
    }, 300); 
}
function closeAndScrollToTop() {
    closeNav();
    setTimeout(() => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }, 300);
}


function refreshPage() {
    window.location.reload();
}

document.addEventListener("DOMContentLoaded", () => {
    loadDarkMode();
    checkAuthStatus(); 
    attachEventListeners();
    initWhiteboard(); 
    if(currentMonthYearDisplay) renderCalendar(currentCalendarDate); 
    switchMode('notepad'); 
    loadBlogPosts(); 
    updateUIForPremiumFeatures();
    document.getElementById('currentYear').textContent = new Date().getFullYear(); // Set current year in footer
});

window.onload = function() {
    // This check is important because gsi might not be loaded yet
    if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
        initGoogleSignIn();
    } else {
        // Poll for Google Sign-In readiness if not immediately available
        let attempts = 0;
        const intervalId = setInterval(() => {
            attempts++;
            if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
                initGoogleSignIn();
                clearInterval(intervalId);
            } else if (attempts > 20) { // Stop after 10 seconds
                console.error("Google Sign-In did not initialize in time.");
                if(document.getElementById('googleSignInDiv')) {
                     document.getElementById('googleSignInDiv').innerHTML = "Google Sign-In failed to load. Please try refreshing.";
                }
                clearInterval(intervalId);
            }
        }, 500);
    }
};


function attachEventListeners() {
    if (textInput) textInput.addEventListener('input', () => { updateAll(); recordState(); });
    if (titleInput) titleInput.addEventListener('input', saveDraft);
    
    window.onscroll = () => { 
        if (goToTopBtn) goToTopBtn.style.display = (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) ? "flex" : "none"; 
    };
    if (goToTopBtn) goToTopBtn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
    
    const getStartedBtn = document.getElementById('getStartedBtn');
    if (getStartedBtn) getStartedBtn.onclick = () => { 
        if(welcomePopup) welcomePopup.classList.add("hidden"); 
        if(authModal) authModal.classList.remove("hidden"); 
        localStorage.setItem("visited", "true"); 
    }; 
    
    if (switchAuthModeLink) switchAuthModeLink.onclick = (e) => { 
        e.preventDefault(); 
        isSignUp = !isSignUp; 
        if(authTitle) authTitle.textContent = isSignUp ? "Create your Account" : "Welcome Back"; 
        if(authSubmit) authSubmit.textContent = isSignUp ? "Sign Up" : "Sign In"; 
        switchAuthModeLink.innerHTML = isSignUp ? 'Already have an account? <a href="#">Sign In</a>' : 'Don‚Äôt have an account? <a href="#">Sign Up</a>'; 
    };
    
    if (authSubmit) authSubmit.onclick = handleAuthSubmit;
    
    const closeFindReplaceBtn = document.getElementById('close-find-replace');
    if (closeFindReplaceBtn) closeFindReplaceBtn.onclick = closeFindReplace;
    
    const replaceBtn = document.getElementById('replace-btn');
    if (replaceBtn) replaceBtn.onclick = () => findAndReplace(false);
    
    const replaceAllBtn = document.getElementById('replace-all-btn');
    if (replaceAllBtn) replaceAllBtn.onclick = () => findAndReplace(true);

    if (profileIcon) profileIcon.addEventListener('click', toggleProfileDropdown);
    document.addEventListener('click', closeDropdownOnClickOutside);
    if (logoutBtn) logoutBtn.addEventListener('click', handleLogout);
    if (verifyEmailBtn) verifyEmailBtn.addEventListener('click', handleVerifyEmail);
    if (resetPasswordBtn) resetPasswordBtn.addEventListener('click', handleResetPassword);
    if (manageAccountBtn) manageAccountBtn.addEventListener('click', handleManageAccount); 
    
    if (editProfilePhotoBtn) editProfilePhotoBtn.addEventListener('click', (e) => { 
        e.preventDefault(); 
        if(photoUploadInput) photoUploadInput.click();
    });
    if (photoUploadInput) photoUploadInput.addEventListener('change', handlePhotoUpload);

    document.querySelectorAll('.faq-question').forEach(question => {
        question.addEventListener('click', () => {
            const answer = question.nextElementSibling;
            if (!answer || !answer.classList.contains('faq-answer')) return; // Ensure answer element exists

            const isActive = question.classList.contains('active');

            document.querySelectorAll('.faq-question.active').forEach(q => {
                if (q !== question) {
                    q.classList.remove('active');
                    const otherAnswer = q.nextElementSibling;
                    if (otherAnswer && otherAnswer.classList.contains('faq-answer')) {
                         otherAnswer.classList.remove('show');
                         otherAnswer.style.maxHeight = '0';
                    }
                }
            });

            if (isActive) {
                question.classList.remove('active');
                answer.classList.remove('show');
                answer.style.maxHeight = '0'; 
            } else {
                question.classList.add('active');
                answer.classList.add('show');
                answer.style.maxHeight = answer.scrollHeight + "px"; 
            }
        });
    });

    if (prevMonthBtn) prevMonthBtn.addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
        renderCalendar(currentCalendarDate);
    });

    if (nextMonthBtn) nextMonthBtn.addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
        renderCalendar(currentCalendarDate);
    });

    if (calendarGrid) calendarGrid.addEventListener('click', (e) => {
        if (e.target.classList.contains('calendar-date') && !e.target.classList.contains('empty')) {
            document.querySelectorAll('.calendar-date.selected').forEach(date => {
                date.classList.remove('selected');
            });
            e.target.classList.add('selected');
        }
    });

    if (exitCalendarBtn) exitCalendarBtn.addEventListener('click', () => {
        switchMode('notepad'); 
    });
    
    document.querySelectorAll('.premium-buy-btn').forEach(button => {
        button.addEventListener('click', () => {
            const feature = button.getAttribute('data-feature');
            // const price = button.getAttribute('data-price'); // Not used in current logic

            if (!getCurrentUserId()) {
                alert("Please sign in to purchase premium features.");
                if(authModal) authModal.classList.remove("hidden"); 
                return;
            }

            const card = button.closest('.premium-feature-card');
            if (card) {
                const paymentInfo = card.querySelector('.manual-payment-info');
                if (paymentInfo) {
                    paymentInfo.style.display = 'flex'; 
                    paymentInfo.scrollIntoView({ behavior: 'smooth' });
                }
            }
        });
    });
}

function toggleProfileDropdown() {
    if(profileDropdown) profileDropdown.classList.toggle('hidden');
}

function closeDropdownOnClickOutside(event) {
    if (profileContainer && !profileContainer.contains(event.target) && profileDropdown && !profileDropdown.classList.contains('hidden')) {
        profileDropdown.classList.add('hidden');
    }
}

function checkAuthStatus() {
    const currentUserId = getCurrentUserId();
    if (currentUserId) {
        showUserInfo();
        loadDraft();
        displayNotes();
        if(textInput) { // Ensure textInput exists before calling updateAll and resetHistory
            updateAll();
            resetHistory(textInput.value);
        }
    } else if (!localStorage.getItem("visited")) {
        if(welcomePopup) welcomePopup.classList.remove("hidden");
    } else {
        if(authModal) authModal.classList.remove("hidden");
    }
    updateUIForPremiumFeatures();
}

function showUserInfo() {
    const username = localStorage.getItem('currentUser');
    const picUrl = localStorage.getItem('userPic');
    const email = localStorage.getItem('userEmail');
    const isVerified = localStorage.getItem('emailVerified') === 'true';

    if (!username || !profileContainer || !profileIcon || !userPic || !userNameDisplay || !userEmailDisplay || !emailVerifiedStatus || !verifyEmailBtn || !resetPasswordBtn) return;


    profileContainer.classList.remove('hidden');
    
    const avatarUrl = picUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(username.substring(0,2))}&background=random&color=fff&size=48`; // Use initials if no pic
    profileIcon.src = avatarUrl;
    userPic.src = avatarUrl;
    
    userNameDisplay.textContent = username;
    userEmailDisplay.textContent = email || '';

    if (isVerified) {
        emailVerifiedStatus.innerHTML = '<i class="fas fa-check-circle" title="Email is verified"></i>';
        verifyEmailBtn.style.opacity = '0.6';
        verifyEmailBtn.style.cursor = 'default';
    } else {
        emailVerifiedStatus.innerHTML = '<i class="fas fa-times-circle" title="Email not verified"></i>';
        verifyEmailBtn.style.opacity = '1';
        verifyEmailBtn.style.cursor = 'pointer';
    }
    // Ensure parent <li> is visible if button itself is
    verifyEmailBtn.parentElement.style.display = 'block';


    const provider = localStorage.getItem('authProvider');
    if (provider === 'google') {
        resetPasswordBtn.parentElement.style.display = 'none'; // Hide reset password for Google users
        // Google emails are often pre-verified
        if (localStorage.getItem('emailVerified') === 'true') {
             verifyEmailBtn.parentElement.style.display = 'none'; // Hide verify if already verified (common for Google)
        }
    } else {
        resetPasswordBtn.parentElement.style.display = 'block';
    }
}

function handleAuthSubmit() {
    if(!authUsername || !authPassword) return;
    const username = authUsername.value.trim();
    const password = authPassword.value.trim();
    if (!username || !password) { alert("Please fill in all fields"); return; }

    const users = JSON.parse(localStorage.getItem("users") || "{}");
    if (isSignUp) {
        if (users[username]) { alert("Username (email) already exists."); return; }
        users[username] = password; 
        localStorage.setItem("users", JSON.stringify(users));
        localStorage.setItem('authProvider', 'email');
        localStorage.setItem('userEmail', username);
        localStorage.setItem('emailVerified', 'false');
        localStorage.setItem("currentUser", username);
        loginSuccess(username, "", username); // userId is username for email auth
    } else {
        if (!users[username] || users[username] !== password) { alert("Invalid credentials"); return; }
        // Ensure email related flags are set if missing from older registrations
        if (localStorage.getItem('userEmail') !== username) localStorage.setItem('userEmail', username);
        if (localStorage.getItem('authProvider') !== 'email') localStorage.setItem('authProvider', 'email');
        if (localStorage.getItem('emailVerified') === null) localStorage.setItem('emailVerified', 'false');

        localStorage.setItem("currentUser", username);
        loginSuccess(username, "", username); // userId is username for email auth
    }
}

function handleLogout(e) {
    if(e) e.preventDefault();
    localStorage.removeItem("currentUser");
    localStorage.removeItem("userPic");
    localStorage.removeItem("currentUserId");
    localStorage.removeItem("emailVerified");
    localStorage.removeItem("userEmail");
    localStorage.removeItem("authProvider");
    
    if (typeof google !== 'undefined' && google.accounts && google.accounts.id) google.accounts.id.disableAutoSelect();
    
    if(profileContainer) profileContainer.classList.add('hidden');
    if(profileDropdown && !profileDropdown.classList.contains('hidden')) {
        profileDropdown.classList.add('hidden');
    }
    
    if(authModal) authModal.classList.remove("hidden");
    if(noteList) noteList.innerHTML = '';
    newDoc();
    updateUIForPremiumFeatures(); 
}


function handlePhotoUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
        const base64Image = e.target.result;
        localStorage.setItem('userPic', base64Image);
        showUserInfo(); 
        alert("Profile photo updated!");
    };
    reader.readAsDataURL(file);
}

function handleVerifyEmail(e) {
    e.preventDefault();
    if (localStorage.getItem('emailVerified') === 'true') {
        alert('Your email is already verified.');
        return;
    }
    if (localStorage.getItem('authProvider') === 'google') {
        alert('Google accounts are typically pre-verified or managed via Google.');
        return;
    }
    
    const verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
    // In a real app, this code would be sent to the user's email.
    // For this demo, we alert it.
    alert(`A verification code has been "sent" to your email (for demo purposes, it's shown here).\n\nYour code is: ${verificationCode}\n\nPlease enter this code in the prompt.`);

    const userCode = prompt("Please enter the 6-digit verification code:");

    if (userCode === verificationCode) {
        localStorage.setItem('emailVerified', 'true');
        alert("Email verified successfully!");
        showUserInfo(); 
    } else if (userCode) { // if user entered something but it was wrong
        alert("Incorrect code. Please try again.");
    } else { // if user cancelled prompt
        alert("Verification cancelled.");
    }
}

function handleResetPassword(e) {
    e.preventDefault();
    if (localStorage.getItem('authProvider') === 'google') {
        alert("Password reset is managed through your Google account.");
        return;
    }
    if (!localStorage.getItem('currentUser')) {
        alert("Please sign in to reset your password.");
        return;
    }

    const newPassword = prompt("Enter your new password (min 4 characters):");
    if (!newPassword || newPassword.length < 4) {
        if (newPassword !== null) alert("Password is too short."); // Only alert if not cancelled
        return;
    }

    const confirmPassword = prompt("Confirm your new password:");
    if (newPassword !== confirmPassword) {
        alert("Passwords do not match.");
        return;
    }

    const username = localStorage.getItem('userEmail'); // Use stored email
    if(!username) { alert("User email not found. Cannot reset password."); return;}

    const users = JSON.parse(localStorage.getItem("users") || "{}");
    if (users[username]) {
        users[username] = newPassword; 
        localStorage.setItem("users", JSON.stringify(users));
        alert("Your password has been reset successfully!");
    } else {
        alert("An error occurred. Could not find user to update password.");
    }
}

function handleManageAccount(e) {
    e.preventDefault();
    alert("You can manage your profile photo and email verification from the dropdown. For other account settings, please contact support if needed.");
}

function loginSuccess(username, picUrl, userId) {
    localStorage.setItem("currentUserId", userId);
    if(picUrl) localStorage.setItem("userPic", picUrl);

    showUserInfo();
    if(authModal) authModal.classList.add("hidden");
    if(confetti) confetti.classList.remove("hidden");
    if(loginSound) loginSound.play().catch(e => console.warn("Audio play failed:", e)); // Use warn for non-critical errors
    setTimeout(() => { if(confetti) confetti.classList.add("hidden"); }, 1200);
    
    loadDraft();
    displayNotes();
    if(textInput) { // Ensure textInput exists
        updateAll();
        resetHistory(textInput.value);
    }
    updateUIForPremiumFeatures(); 
}

function initGoogleSignIn() {
    try {
        if (!google || !google.accounts || !google.accounts.id) {
            console.error("Google Sign-In library not fully loaded.");
             if(document.getElementById('googleSignInDiv')) {
                 document.getElementById('googleSignInDiv').innerHTML = "Google Sign-In failed to load. Please try refreshing.";
            }
            return;
        }
        google.accounts.id.initialize({
            client_id: "107788525119-7mkm9t2pqe53q85ltenn4lr3av7itdfh.apps.googleusercontent.com", 
            callback: handleGoogleSignIn
        });
        const googleSignInButtonContainer = document.getElementById("googleSignInDiv");
        if (googleSignInButtonContainer) {
            google.accounts.id.renderButton(
                googleSignInButtonContainer,
                { theme: "outline", size: "large", shape: "pill", width: "300" }
            );
        } else {
            console.warn("Google Sign-In button container not found.");
        }
    } catch (error) {
        console.error("Google GSI could not be initialized.", error);
        const googleSignInButtonContainer = document.getElementById('googleSignInDiv');
        if (googleSignInButtonContainer) {
            googleSignInButtonContainer.innerHTML = "Google Sign-In failed to load.";
        }
    }
}

function jwtDecode(token) {
    try { return JSON.parse(atob(token.split('.')[1])); }
    catch (e) { console.error("Failed to decode JWT", e); return null; }
}

function handleGoogleSignIn(response) {
    const data = jwtDecode(response.credential);
    if (!data) { alert("Failed to process Google Sign-In. Please try again."); return;}

    const name = data.name || data.email; // Fallback to email if name is not present
    const picture = data.picture || "";
    const userId = data.sub; // Google's unique subject identifier
    const email = data.email;
    const emailVerified = data.email_verified === true || data.email_verified === 'true'; // Ensure boolean

    localStorage.setItem("currentUser", name);
    // localStorage.setItem("userPic", picture); // Set by loginSuccess
    localStorage.setItem('authProvider', 'google');
    localStorage.setItem('userEmail', email);
    localStorage.setItem('emailVerified', emailVerified.toString()); // Store as string 'true'/'false'
    
    loginSuccess(name, picture, userId);
}

function switchModeAndScroll(mode, selector) {
    switchMode(mode);
    // Timeout to allow DOM updates from switchMode before scrolling
    setTimeout(() => {
        scrollToSection(selector);
    }, 100); 
}


function switchMode(mode) {
    currentMode = mode;

    const sections = [editorSection, whiteboardSection, todoListContainer, addTodoBtn, calendarContainer, blogsSection, titleInput, whiteboardTitleInput];
    sections.forEach(sec => { if (sec) sec.classList.add('hidden'); });
    
    document.querySelectorAll('.mode-switcher button').forEach(b => b.classList.remove('active-mode'));
    const modeButton = document.getElementById(`mode-${mode}`);
    if (modeButton) modeButton.classList.add('active-mode');

    if (mode === 'notepad') {
        if(editorSection) editorSection.classList.remove('hidden');
        if(textInput) textInput.classList.remove('hidden');
        if(titleInput) titleInput.classList.remove('hidden');
    } else if (mode === 'whiteboard') {
        if(whiteboardSection) whiteboardSection.classList.remove('hidden');
        if(whiteboardTitleInput) whiteboardTitleInput.classList.remove('hidden');
        resizeWhiteboard();
    } else if (mode === 'todo') {
        if(editorSection) editorSection.classList.remove('hidden'); // Title input part of editor section
        if(todoListContainer) todoListContainer.classList.remove('hidden');
        if(addTodoBtn) addTodoBtn.classList.remove('hidden');
        if(titleInput) titleInput.classList.remove('hidden');
        if(textInput) textInput.classList.add('hidden'); 
    } else if (mode === 'calendar') {
        if(calendarContainer) calendarContainer.classList.remove('hidden');
        if(currentMonthYearDisplay) renderCalendar(currentCalendarDate); 
    } else if (mode === 'blog') { 
        if(blogsSection) blogsSection.classList.remove('hidden');
    }
    
    updateUIForPremiumFeatures(); 
}

function newDoc() {
    editModeId = null;
    if(titleInput) titleInput.value = '';
    if(textInput) textInput.value = '';
    if(whiteboardTitleInput) whiteboardTitleInput.value = '';
    if(todoListContainer) todoListContainer.innerHTML = '';
    clearCanvas();
    updateAll();
    clearDraft();
    resetHistory();
    if(currentMonthYearDisplay) renderCalendar(currentCalendarDate); 
    switchMode('notepad'); 
    if(titleInput) titleInput.focus();
}

function saveNote() {
    const key = getUserNotesKey();
    if (!key) { alert("Please sign in to save notes."); return; }

    let title, content, type;
    if (currentMode === 'notepad') {
        if (!textInput || !textInput.value.trim()) { alert("Cannot save an empty note."); return; }
        title = titleInput ? titleInput.value || 'Untitled Note' : 'Untitled Note';
        content = textInput.value;
        type = 'notepad';
    } else if (currentMode === 'whiteboard') {
        title = whiteboardTitleInput ? whiteboardTitleInput.value || 'Untitled Whiteboard' : 'Untitled Whiteboard';
        if (!whiteboardState.canvas) { alert("Whiteboard not initialized."); return; }
        content = whiteboardState.canvas.toDataURL(); // Default to PNG
        type = 'whiteboard';
    } else if (currentMode === 'todo') {
        if (!todoListContainer || todoListContainer.children.length === 0) { alert("Cannot save an empty to-do list."); return; }
        title = titleInput ? titleInput.value || 'Untitled To-Do List' : 'Untitled To-Do List';
        content = serializeTodoList();
        type = 'todo';
    } else if (currentMode === 'calendar') {
        alert("Calendar view does not support direct saving as a note. Manage events within the calendar interface if applicable.");
        return; 
    } else {
        alert("Cannot save in current mode.");
        return;
    }


    const notes = JSON.parse(localStorage.getItem(key)) || [];
    const timestamp = new Date().toLocaleString();
    if (editModeId) {
        const idx = notes.findIndex(n => n.id === editModeId);
        if (idx > -1) {
            notes[idx] = { ...notes[idx], title, text: content, type, date: timestamp }; 
        } else { // If editModeId was set but note not found, save as new
             notes.unshift({ id: Date.now(), title, text: content, type, date: timestamp, pinned: false, isLocked: false, passwordHash: null });
        }
    } else {
        notes.unshift({ id: Date.now(), title, text: content, type, date: timestamp, pinned: false, isLocked: false, passwordHash: null });
    }
    localStorage.setItem(key, JSON.stringify(notes));
    displayNotes();
    newDoc(); // Clears editor for next note
}

function displayNotes() {
    if(!noteList) return;
    const key = getUserNotesKey();
    const notes = key ? JSON.parse(localStorage.getItem(key)) || [] : [];
    notes.sort((a, b) => (b.pinned ? 1 : 0) - (a.pinned ? 1 : 0) || b.id - a.id); // Pinned first, then by ID
    
    noteList.innerHTML = notes.map(n => {
        let contentPreview = '';
        const noteType = n.type || 'notepad'; // Default to notepad if type is missing

        if (n.isLocked && n.passwordHash) { // Check for passwordHash to confirm it's truly locked
            contentPreview = `<i><i class="fas fa-lock" style="margin-right: 5px;"></i>This note is locked. Click 'Unlock' to view.</i>`;
        } else if (noteType === 'whiteboard') {
            contentPreview = `<img src="${n.text}" alt="Whiteboard Preview for ${n.title}" style="width:100%; max-height: 150px; object-fit: contain; border-radius: 8px; margin-top: 10px; border: 1px solid #eee;">`;
        } else if (noteType === 'todo') {
            try { 
                const todoItems = JSON.parse(n.text);
                const completedItems = todoItems.filter(item => item.checked).length;
                contentPreview = `<i>To-Do List: ${completedItems} of ${todoItems.length} items completed.</i>`; 
            }
            catch { contentPreview = `<i>Corrupted To-Do List.</i>`}
        } else { // Notepad
            contentPreview = `${n.text.substring(0, 150)}${n.text.length > 150 ? '...' : ''}`; // Shorter preview
        }

        const lockIcon = (n.isLocked && n.passwordHash) ? '<i class="fas fa-lock" style="color: #ffc107; margin-left: 5px;"></i>' : '';
        const pinIconClass = n.pinned ? 'fas fa-thumbtack' : 'far fa-thumbtack'; // Use far for unpinned for visual cue
        const noteTypeIcon = noteType === 'whiteboard' ? 'üé®' : (noteType === 'todo' ? '‚òëÔ∏è' : 'üìù');

        return `
        <div class="note ${n.pinned ? 'pinned' : ''}" id="note-${n.id}">
            <h4>
                ${noteTypeIcon} 
                <span class="note-title-text">${n.title}</span>
                ${lockIcon}
            </h4>
            <p class="note-content-preview">${contentPreview}</p>
            <small>Last updated: ${n.date}</small>
            <div class="note-actions">
                <button onclick="editNote(${n.id})" aria-label="Edit note ${n.title}"><i class="fas fa-edit"></i> Edit</button>
                <button onclick="toggleLock(${n.id})" aria-label="${(n.isLocked && n.passwordHash) ? 'Unlock' : 'Lock'} note ${n.title}"><i class="fas fa-key"></i> ${(n.isLocked && n.passwordHash) ? 'Unlock' : 'Lock'}</button>
                <button onclick="pinNote(${n.id})" aria-label="${n.pinned ? 'Unpin' : 'Pin'} note ${n.title}"><i class="${pinIconClass}"></i> ${n.pinned ? 'Unpin' : 'Pin'}</button>
                ${noteType !== 'whiteboard' ? `<button onclick="exportPDF(${n.id})" aria-label="Export note ${n.title} as PDF"><i class="fas fa-file-pdf"></i> PDF</button>` : ''}
                <button onclick="deleteNote(${n.id})" aria-label="Delete note ${n.title}"><i class="fas fa-trash"></i> Delete</button>
            </div>
        </div>
    `;
    }).join('');
    if (notes.length === 0 && key) {
        noteList.innerHTML = "<p style='text-align:center; color: #888;'>No notes saved yet. Create one above!</p>";
    } else if (!key) {
         noteList.innerHTML = "<p style='text-align:center; color: #888;'>Please sign in to see your saved notes.</p>";
    }
}

async function editNote(id) {
    const key = getUserNotesKey(); if (!key) return;
    const notes = JSON.parse(localStorage.getItem(key)) || [];
    const note = notes.find(n => n.id === id);
    if (!note) { alert("Note not found."); return;}

    if (note.isLocked && note.passwordHash) {
        const password = prompt("Enter password to unlock this note:");
        if (password === null) return; // User cancelled
        if (!password) {alert("Password cannot be empty."); return;}
        const hashed = await hashPassword(password);
        if (hashed !== note.passwordHash) { alert("Incorrect password."); return; }
    }

    newDoc(); 
    const noteType = note.type || 'notepad';
    switchMode(noteType); 
    editModeId = id;

    if (noteType === 'notepad') {
        if(titleInput) titleInput.value = note.title;
        if(textInput) {
            textInput.value = note.text;
            resetHistory(note.text);
        }
    } else if (noteType === 'whiteboard') {
        if(whiteboardTitleInput) whiteboardTitleInput.value = note.title;
        if (whiteboardState.canvas && whiteboardState.ctx) {
            const img = new Image();
            img.onload = () => {
                clearCanvas(); // Clear before drawing
                // Scale image to fit canvas while maintaining aspect ratio
                const canvasWidth = whiteboardState.canvas.width;
                const canvasHeight = whiteboardState.canvas.height;
                const hRatio = canvasWidth / img.width;
                const vRatio = canvasHeight / img.height;
                const ratio = Math.min(hRatio, vRatio);
                const centerShift_x = (canvasWidth - img.width * ratio) / 2;
                const centerShift_y = (canvasHeight - img.height * ratio) / 2;

                whiteboardState.ctx.drawImage(img, 0, 0, img.width, img.height,
                                          centerShift_x, centerShift_y, img.width * ratio, img.height * ratio);
                // Store image data after drawing
                whiteboardState.imageData = whiteboardState.ctx.getImageData(0, 0, canvasWidth, canvasHeight);
            };
            img.onerror = () => { alert("Failed to load whiteboard image for editing.");};
            img.src = note.text; // This is a data URL
        } else {
            alert("Whiteboard component not ready for editing.");
        }
    } else if (noteType === 'todo') {
        if(titleInput) titleInput.value = note.title;
        parseAndRenderTodoList(note.text);
    }
    
    updateAll();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function getCurrentUserId() { return localStorage.getItem('currentUserId'); }
function getUserNotesKey() { const userId = getCurrentUserId(); return userId ? `notes_${userId}` : null; }
function getDraftKey() { const userId = getCurrentUserId(); return userId ? `draft_${userId}` : null; }
function updateAll() { saveDraft(); updateCharCount(); updateWordCount(); }
function updateCharCount() { if(charCount && textInput) charCount.textContent = `Character Count: ${textInput.value.length}`; }
function updateWordCount() { if(wordCount && textInput) {const words = textInput.value.trim().split(/\s+/).filter(word => word.length > 0); wordCount.textContent = `Word Count: ${words.length === 1 && words[0] === '' ? 0 : words.length}`; }}
function saveDraft() { const key = getDraftKey(); if (!key || !titleInput || !textInput) return; if (currentMode === 'notepad') localStorage.setItem(key, JSON.stringify({ title: titleInput.value, text: textInput.value })); }
function loadDraft() { const key = getDraftKey(); if (!key || !titleInput || !textInput) return; const d = localStorage.getItem(key); if (d) { try {const { title, text } = JSON.parse(d); titleInput.value = title; textInput.value = text;} catch(e){console.error("Error parsing draft", e); localStorage.removeItem(key);}} }
function clearDraft() { const key = getDraftKey(); if (key) localStorage.removeItem(key); }
function toggleDark() { document.body.classList.toggle('dark'); localStorage.setItem('darkMode', document.body.classList.contains('dark')); }
function loadDarkMode() { if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark'); }
function changeFont() { const fontFamilySelect = document.getElementById('font-family'); if(textInput && fontFamilySelect) textInput.style.fontFamily = fontFamilySelect.value; }
function changeFontSize() { const fontSizeSelect = document.getElementById('font-size'); if(textInput && fontSizeSelect) textInput.style.fontSize = fontSizeSelect.value; }
async function hashPassword(password) { if (!password) return ''; try {const encoder = new TextEncoder(); const data = encoder.encode(password); const hashBuffer = await crypto.subtle.digest('SHA-256', data); const hashArray = Array.from(new Uint8Array(hashBuffer)); return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');} catch(e) { console.error("Password hashing failed", e); return 'error_hashing_password'; /* or throw e */}}

function initWhiteboard() { 
    if (!whiteboardCanvas) return;
    whiteboardState.canvas = whiteboardCanvas; 
    whiteboardState.ctx = whiteboardCanvas.getContext('2d', { willReadFrequently: true }); // Important for getImageData performance
    
    // Set initial canvas background for consistent PNG export
    whiteboardState.ctx.fillStyle = document.body.classList.contains('dark') ? '#383838' : '#fff';
    whiteboardState.ctx.fillRect(0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height);

    resizeWhiteboard(); // Initial resize
    
    whiteboardState.canvas.addEventListener('mousedown', startDrawing); 
    whiteboardState.canvas.addEventListener('mouseup', stopDrawing); 
    whiteboardState.canvas.addEventListener('mouseout', stopDrawing); 
    whiteboardState.canvas.addEventListener('mousemove', draw); 
    whiteboardState.canvas.addEventListener('touchstart', startDrawing, { passive: false }); 
    whiteboardState.canvas.addEventListener('touchend', stopDrawing, { passive: false }); 
    whiteboardState.canvas.addEventListener('touchmove', draw, { passive: false }); 
    
    const wbColorInput = document.getElementById('wb-color');
    if (wbColorInput) wbColorInput.onchange = (e) => { whiteboardState.brushColor = e.target.value; whiteboardState.isErasing = false; const wbEraserBtn = document.getElementById('wb-eraser'); if(wbEraserBtn) wbEraserBtn.classList.remove('active'); }; 
    
    const wbSizeInput = document.getElementById('wb-size');
    if (wbSizeInput) wbSizeInput.onchange = (e) => whiteboardState.brushSize = e.target.value; 
    
    const wbEraserBtn = document.getElementById('wb-eraser');
    if (wbEraserBtn) wbEraserBtn.onclick = toggleEraser; 
    
    const wbClearBtn = document.getElementById('wb-clear');
    if (wbClearBtn) wbClearBtn.onclick = clearCanvas; 
    
    const wbDownloadBtn = document.getElementById('wb-download');
    if (wbDownloadBtn) wbDownloadBtn.onclick = downloadCanvas; 
    
    window.addEventListener('resize', resizeWhiteboard); 
}
function resizeWhiteboard() { 
    if (!whiteboardState.canvas || !whiteboardState.ctx || !whiteboardSection) return;

    // Save current content before resizing only if canvas has dimensions
    if (whiteboardState.canvas.width > 0 && whiteboardState.canvas.height > 0) {
        try { // Add try-catch for getImageData
          whiteboardState.imageData = whiteboardState.ctx.getImageData(0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height);
        } catch (e) {
          console.error("Error getting image data during resize: ", e);
          whiteboardState.imageData = null; // Reset if error occurs
        }
    }


    const containerWidth = whiteboardSection.clientWidth - 50;  // Subtract padding
    whiteboardState.canvas.width = Math.max(containerWidth, 300); // Minimum width
    whiteboardState.canvas.height = Math.min(Math.max(containerWidth * 0.6, 200), window.innerHeight * 0.5); // Min/Max height and aspect ratio based

    // Set canvas background color (important for consistent PNGs)
    whiteboardState.ctx.fillStyle = document.body.classList.contains('dark') ? '#383838' : '#fff';
    whiteboardState.ctx.fillRect(0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height);


    // Restore content after resizing if available
    if (whiteboardState.imageData) {
        try { // Add try-catch for putImageData
            whiteboardState.ctx.putImageData(whiteboardState.imageData, 0, 0);
        } catch(e) {
            console.error("Error putting image data during resize: ", e);
            // If putImageData fails, it might be due to size mismatch. Clear and log.
            clearCanvas(); // Fallback to a clear canvas
        }
    }
}
function getMousePos(e) { 
    if(!whiteboardState.canvas) return { x: 0, y: 0 };
    const rect = whiteboardState.canvas.getBoundingClientRect(); 
    const scaleX = whiteboardState.canvas.width / rect.width; 
    const scaleY = whiteboardState.canvas.height / rect.height; 
    const clientX = e.touches ? e.touches[0].clientX : e.clientX; 
    const clientY = e.touches ? e.touches[0].clientY : e.clientY; 
    return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY }; 
}
function startDrawing(e) { e.preventDefault(); whiteboardState.isDrawing = true; const { x, y } = getMousePos(e); [whiteboardState.lastX, whiteboardState.lastY] = [x, y]; }
function stopDrawing() { if (!whiteboardState.isDrawing) return; whiteboardState.isDrawing = false; whiteboardState.ctx.beginPath(); /* End current path */ if (whiteboardState.canvas.width > 0 && whiteboardState.canvas.height > 0) whiteboardState.imageData = whiteboardState.ctx.getImageData(0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height); /* Save state after drawing */ }
function draw(e) { 
    e.preventDefault(); 
    if (!whiteboardState.isDrawing || !whiteboardState.ctx) return; 
    const { ctx, lastX, lastY, brushColor, brushSize, isErasing } = whiteboardState; 
    const { x, y } = getMousePos(e); 
    ctx.globalCompositeOperation = isErasing ? 'destination-out' : 'source-over'; 
    ctx.strokeStyle = isErasing ? 'rgba(0,0,0,1)' : brushColor; // Eraser always uses opaque color for destination-out
    ctx.lineWidth = brushSize; 
    ctx.lineCap = 'round'; 
    ctx.lineJoin = 'round'; 
    ctx.beginPath(); 
    ctx.moveTo(lastX, lastY); 
    ctx.lineTo(x, y); 
    ctx.stroke(); 
    [whiteboardState.lastX, whiteboardState.lastY] = [x, y]; 
}
function toggleEraser() { whiteboardState.isErasing = !whiteboardState.isErasing; const wbEraserBtn = document.getElementById('wb-eraser'); if(wbEraserBtn) wbEraserBtn.classList.toggle('active', whiteboardState.isErasing); }
function clearCanvas() { 
    if (!whiteboardState.ctx || !whiteboardState.canvas) return;
    whiteboardState.ctx.clearRect(0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height); 
    // Re-apply background after clearing for consistent PNG
    whiteboardState.ctx.fillStyle = document.body.classList.contains('dark') ? '#383838' : '#fff';
    whiteboardState.ctx.fillRect(0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height);
    if (whiteboardState.canvas.width > 0 && whiteboardState.canvas.height > 0) whiteboardState.imageData = whiteboardState.ctx.getImageData(0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height); // Save cleared state
}
function downloadCanvas() { 
    if(!whiteboardState.canvas || !whiteboardTitleInput) return;
    const link = document.createElement('a'); 
    link.download = `${whiteboardTitleInput.value.trim() || 'whiteboard_drawing'}.png`; // Ensure filename is valid
    link.href = whiteboardState.canvas.toDataURL('image/png'); 
    link.click(); 
}

function addTodoItem(text = '', checked = false) { 
    if(!todoListContainer) return;
    const itemDiv = document.createElement('div'); 
    itemDiv.className = 'todo-item'; 
    if (checked) itemDiv.classList.add('completed'); 
    const checkbox = document.createElement('input'); 
    checkbox.type = 'checkbox'; 
    checkbox.checked = checked; 
    checkbox.onchange = () => { itemDiv.classList.toggle('completed', checkbox.checked); saveDraft(); /* Save ToDo draft on change */ }; 
    const textSpan = document.createElement('span'); 
    textSpan.className = 'todo-text'; 
    textSpan.contentEditable = true; 
    textSpan.textContent = text || 'New to-do...'; 
    textSpan.onblur = () => saveDraft(); /* Save ToDo draft on change */
    itemDiv.appendChild(checkbox); 
    itemDiv.appendChild(textSpan); 
    todoListContainer.appendChild(itemDiv); 
}
function serializeTodoList() { 
    if(!todoListContainer) return JSON.stringify([]);
    const items = []; 
    todoListContainer.querySelectorAll('.todo-item').forEach(item => { 
        const textElement = item.querySelector('.todo-text');
        const checkboxElement = item.querySelector('input[type="checkbox"]');
        if (textElement && checkboxElement) { // Ensure elements exist
            items.push({ text: textElement.textContent, checked: checkboxElement.checked }); 
        }
    }); 
    return JSON.stringify(items); 
}
function parseAndRenderTodoList(jsonString) { 
    if(!todoListContainer) return;
    todoListContainer.innerHTML = ''; 
    try { 
        const items = JSON.parse(jsonString);
        if (Array.isArray(items)) {
            items.forEach(item => addTodoItem(item.text, item.checked)); 
        } else {
            console.error("Parsed To-Do list is not an array:", items);
        }
    } catch (e) { 
        console.error("Failed to parse To-Do list", e); 
        // Optionally, provide a default or error state in the UI
        // todoListContainer.innerHTML = "<p>Error loading to-do list.</p>";
    } 
}

function renderCalendar(dateToRender) {
    if(!currentMonthYearDisplay || !calendarGrid) return;

    const year = dateToRender.getFullYear();
    const month = dateToRender.getMonth(); 
    
    currentMonthYearDisplay.textContent = dateToRender.toLocaleString('default', { month: 'long', year: 'numeric' });
    
    // Clear previous days, keeping headers (first 7 children: Sun-Sat)
    while (calendarGrid.children.length > 7) {
        calendarGrid.removeChild(calendarGrid.lastChild);
    }

    const firstDayOfMonthIndex = new Date(year, month, 1).getDay(); 
    const daysInMonth = new Date(year, month + 1, 0).getDate(); 

    const today = new Date();
    const isCurrentDisplayingTodayMonth = today.getFullYear() === year && today.getMonth() === month;

    for (let i = 0; i < firstDayOfMonthIndex; i++) {
        const emptyDiv = document.createElement('div');
        emptyDiv.classList.add('calendar-date', 'empty');
        calendarGrid.appendChild(emptyDiv);
    }

    for (let day = 1; day <= daysInMonth; day++) {
        const dateDiv = document.createElement('div');
        dateDiv.classList.add('calendar-date');
        dateDiv.textContent = day;
        dateDiv.dataset.date = new Date(year, month, day).toISOString().split('T')[0]; // Store full date

        if (isCurrentDisplayingTodayMonth && day === today.getDate()) {
            dateDiv.classList.add('current-day');
        }
        calendarGrid.appendChild(dateDiv);
    }
}


function recordState() { 
    if(!textInput) return;
    clearTimeout(lastChangeTimeout); 
    lastChangeTimeout = setTimeout(() => { 
        if (currentMode !== 'notepad') return; 
        const currentState = textInput.value; 
        if (undoStack.length === 0 || undoStack[undoStack.length - 1] !== currentState) { 
            undoStack.push(currentState); 
            redoStack = []; 
            if (undoStack.length > 50) undoStack.shift(); 
        } 
    }, 500); 
}
function undo() { 
    if(!textInput) return;
    if (currentMode !== 'notepad' || undoStack.length < 2) return; 
    redoStack.push(undoStack.pop()); 
    textInput.value = undoStack[undoStack.length - 1] || ''; 
    updateAll(); 
}
function redo() { 
    if(!textInput) return;
    if (currentMode !== 'notepad' || redoStack.length === 0) return; 
    const nextState = redoStack.pop(); 
    undoStack.push(nextState); 
    textInput.value = nextState; 
    updateAll(); 
}
function resetHistory(initialText = '') { undoStack = [initialText]; redoStack = []; }
function cutText() { 
    if(!textInput || currentMode !== 'notepad' || textInput.selectionStart === textInput.selectionEnd) return; 
    try {
        navigator.clipboard.writeText(textInput.value.substring(textInput.selectionStart, textInput.selectionEnd)); 
        // execCommand is deprecated, but common fallback.
        // For modern browsers, manipulating selection directly is better.
        const start = textInput.selectionStart;
        const end = textInput.selectionEnd;
        textInput.value = textInput.value.substring(0, start) + textInput.value.substring(end);
        textInput.selectionStart = textInput.selectionEnd = start; // Move cursor
    } catch (e) {
        console.warn("Clipboard API or text manipulation failed:", e);
        // Fallback or just log
        try { document.execCommand('delete', false, null); } catch (ex) { /* ignore fallback error */ }
    }
    updateAll(); 
    recordState(); 
}
function showFindReplace() { if (currentMode !== 'notepad' || !findReplaceDialog) return; findReplaceDialog.classList.remove('hidden'); const findInputEl = findReplaceDialog.querySelector('#find-input'); if(findInputEl) findInputEl.focus(); }
function closeFindReplace() { if(findReplaceDialog) findReplaceDialog.classList.add('hidden'); }
function findAndReplace(replaceAll = false) { 
    if(!textInput) return;
    const findInputEl = document.getElementById('find-input');
    const replaceInputEl = document.getElementById('replace-input');

    if(!findInputEl || !replaceInputEl) return;

    const findValue = findInputEl.value; 
    const replaceValue = replaceInputEl.value; 
    if (!findValue) return; 
    
    // Using try-catch for RegExp in case of invalid patterns
    try {
        const regex = new RegExp(findValue.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), replaceAll ? 'g' : ''); // Escape special regex chars
        textInput.value = textInput.value.replace(regex, replaceValue); 
    } catch(e) {
        alert("Invalid find pattern. Please check your input.");
        console.error("Regex error in findAndReplace: ", e);
        return;
    }
    updateAll(); 
    recordState(); 
}

function deleteNote(id) { 
    const key = getUserNotesKey(); 
    if (!key || !confirm("Are you sure you want to delete this note permanently? This action cannot be undone.")) return; 
    let notes = JSON.parse(localStorage.getItem(key)) || []; 
    localStorage.setItem(key, JSON.stringify(notes.filter(n => n.id !== id))); 
    displayNotes(); 
    if (editModeId === id) newDoc(); 
}
function pinNote(id) { 
    const key = getUserNotesKey(); if (!key) return; 
    const notes = JSON.parse(localStorage.getItem(key)) || []; 
    const note = notes.find(n => n.id === id); 
    if (note) note.pinned = !note.pinned; 
    localStorage.setItem(key, JSON.stringify(notes)); 
    displayNotes(); 
}
async function toggleLock(id) { 
    const key = getUserNotesKey(); if (!key) return; 
    let notes = JSON.parse(localStorage.getItem(key)) || []; 
    const noteIndex = notes.findIndex(n => n.id === id); 
    if (noteIndex === -1) return; 
    const note = notes[noteIndex]; 

    if (note.isLocked && note.passwordHash) { // Unlocking
        const password = prompt("Enter password to unlock this note:"); 
        if (password === null) return; // User cancelled prompt
        if (!password) { alert("Password cannot be empty."); return; }
        const hashed = await hashPassword(password); 
        if (hashed !== note.passwordHash) { alert("Incorrect password."); return; }
        note.isLocked = false;
        note.passwordHash = null; // Clear hash on unlock
        alert("Note unlocked successfully!");
    } else { // Locking
        const password = prompt("Enter a new password to lock this note (min 4 chars):"); 
        if (password === null) return;
        if (!password || password.length < 4) { alert("Password is too short or empty."); return; } 
        const confirmPassword = prompt("Confirm password:"); 
        if (password !== confirmPassword) { alert("Passwords do not match."); return; } 
        note.isLocked = true; 
        note.passwordHash = await hashPassword(password); 
        alert("Note locked successfully!"); 
    } 
    notes[noteIndex] = note; 
    localStorage.setItem(key, JSON.stringify(notes)); 
    displayNotes(); 
}
async function exportPDF(id) { 
    const key = getUserNotesKey(); if (!key) return; 
    const notes = JSON.parse(localStorage.getItem(key)) || []; 
    const note = notes.find(n => n.id === id); 
    if (!note) { alert("Note not found for PDF export."); return; }

    if (note.isLocked && note.passwordHash) { 
        const password = prompt("This note is locked. Enter password to export:"); 
        if (password === null) return;
        if (!password) { alert("Password cannot be empty."); return;}
        const hashed = await hashPassword(password); 
        if (hashed !== note.passwordHash) { alert("Incorrect password. Cannot export."); return; } 
    } 
    
    // Ensure jsPDF is loaded
    if (typeof window.jspdf === 'undefined' || typeof window.jspdf.jsPDF === 'undefined') {
        alert("PDF library (jsPDF) is not loaded. Cannot export PDF.");
        console.error("jsPDF not loaded.");
        return;
    }
    const { jsPDF } = window.jspdf; 

    try {
        const doc = new jsPDF(); 
        doc.setFont("Helvetica", "bold"); 
        doc.setFontSize(20); 
        doc.text(note.title, 15, 20); 
        doc.setFont("Helvetica", "normal"); 
        doc.setFontSize(12); 
        let contentToExport = note.text; 
        if (note.type === 'todo') { 
            try { contentToExport = JSON.parse(note.text).map(item => `${item.checked ? '[x]' : '[ ]'} ${item.text}`).join('\n'); } 
            catch { contentToExport = "Error: Could not parse to-do list for PDF export."} 
        } 
        // Handle long text wrapping
        const lines = doc.splitTextToSize(contentToExport, 180); // 180 is approx width in mm for A4 page with margins
        doc.text(lines, 15, 30); 
        doc.save(`${note.title.replace(/[^\w\s]/gi, '').replace(/\s+/g, '_') || 'NoteP@d_Export'}.pdf`); // Sanitize filename
    } catch (e) {
        alert("An error occurred while generating the PDF. Please try again.");
        console.error("PDF Export Error:", e);
    }
}

window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredInstallPrompt = e; if(installBtn) installBtn.classList.remove('hidden'); });
if(installBtn) installBtn.addEventListener('click', async () => { if (deferredInstallPrompt) { deferredInstallPrompt.prompt(); const { outcome } = await deferredInstallPrompt.userChoice; console.log(`User response to install prompt: ${outcome}`); deferredInstallPrompt = null; installBtn.classList.add('hidden'); } });
document.addEventListener('keydown', (e) => { if (e.ctrlKey || e.metaKey) { switch (e.key.toLowerCase()) { case 's': e.preventDefault(); saveNote(); break; case 'n': e.preventDefault(); newDoc(); break; case 'z': e.preventDefault(); undo(); break; case 'y': e.preventDefault(); redo(); break; case 'f': e.preventDefault(); showFindReplace(); break; } } });

const blogPostsData = [
    {
        id: 1,
        title: "Unlock Your Productivity: The Power of a Digital Notepad",
        date: "2024-07-25",
        views: 1580,
        author: "Bishal Mishra",
        image: "https://www.seekink.com/wp-content/uploads/2024/01/%E5%9B%BE%E7%89%874-3.png", 
        content: "In today's fast-paced world, staying organized is key to productivity. A digital notepad like Note P@d can be your secret weapon. This blog post explores how using a simple yet powerful tool can help you capture fleeting ideas, organize your thoughts, and manage your daily tasks effectively.",
        fullContent: "In today's fast-paced world, staying organized is key to productivity. A digital notepad like Note P@d can be your secret weapon. This blog post explores how using a simple yet powerful tool can help you capture fleeting ideas, organize your thoughts, and manage your daily tasks effectively. We'll cover strategies for leveraging notepads for everything from meeting minutes to personal journaling, ensuring no great idea slips away. Discover how to optimize your Note P@d for maximum efficiency. Learn about using different note types, the benefits of the markdown editor (if implemented), and how to integrate Note P@d into your daily routine for peak performance. We'll delve into creating structured notes, using tags for better organization, and even some advanced tips for power users. Embrace the simplicity and power of digital note-taking with Note P@d! The ability to quickly jot down thoughts, create outlines, or draft longer pieces of text without worrying about saving (thanks to auto-save and local storage) frees up mental bandwidth. Furthermore, features like font and size customization allow for a personalized writing environment, reducing eye strain and improving focus during long writing sessions. With Note P@d, your digital workspace adapts to you, not the other way around."
    },
    {
        id: 2,
        title: "Beyond Text: Harnessing the Whiteboard Feature in Note P@d",
        date: "2024-07-20",
        views: 1120,
        author: "Bishal Mishra",
        image: "https://nextdayanimations.com/wp-content/uploads/2022/12/why_whiteboard_videos_blog_post-fb.png", 
        content: "Sometimes, words aren't enough. Visual thinking is crucial for brainstorming, mind-mapping, and problem-solving. Discover how Note P@d's integrated whiteboard feature can transform your workflow. Learn tips for sketching out ideas and creating visual outlines.",
        fullContent: "Sometimes, words aren't enough. Visual thinking is crucial for brainstorming, mind-mapping, and problem-solving. Discover how Note P@d's integrated whiteboard feature can transform your workflow. Learn tips for sketching out ideas, creating visual outlines, and collaborating more effectively (if collaboration is a feature). We‚Äôll show you how to make the most of the drawing tools ‚Äì varying colors and brush sizes ‚Äì to bring your concepts to life, making complex ideas instantly understandable. Explore the use of the eraser tool for quick corrections and the clear canvas option for a fresh start. Consider how to save and export your whiteboard creations as PNG images for sharing, presentations, or later reference, enhancing your ability to communicate visually and preserve your creative bursts."
    },
    {
        id: 3,
        title: "Conquer Your To-Do List: Effective Task Management with Note P@d",
        date: "2024-07-15",
        views: 1750,
        author: "Bishal Mishra",
        image: "https://images.ctfassets.net/lzny33ho1g45/4dBmz2qbCdUEQ8Z5Zr2jQH/86ea25e7ba44580d252b092f8a68dbd4/kanban", 
        content: "A messy to-do list can feel overwhelming. This post dives into practical strategies for managing your tasks using Note P@d's dedicated To-Do List feature. Learn about prioritizing tasks, breaking down large projects, and the satisfaction of checking items off.",
        fullContent: "A messy to-do list can feel overwhelming. This post dives into practical strategies for managing your tasks using Note P@d's dedicated To-Do List feature. Learn about prioritizing tasks, breaking down large projects, and the psychological benefits of checking items off your list. We‚Äôll explore how to use Note P@d to create a system that reduces stress and boosts your accomplishment levels throughout the day. Discover techniques like creating actionable items, setting clear titles for your lists, and regularly reviewing your progress. The simple act of marking a task as complete provides a sense of achievement and momentum, encouraging further productivity. Note P@d's to-do list is designed for clarity and ease of use, helping you stay on top of your commitments."
    },
    {
        id: 4,
        title: "The Seamless Offline Experience: Why Note P@d is Always Available",
        date: "2024-07-10",
        views: 950,
        author: "Bishal Mishra",
        image: "https://images.unsplash.com/photo-1519389950473-47ba0277781c?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80", 
        content: "In an era where connectivity is paramount, what happens when you're offline? Note P@d is designed to work seamlessly even without an internet connection, thanks to its Progressive Web App (PWA) nature. This article explains how this ensures your notes are always accessible.",
        fullContent: "In an era where connectivity is paramount, what happens when you're offline? Note P@d is designed to work seamlessly even without an internet connection, thanks to its Progressive Web App (PWA) nature. This article explains the technology behind offline access ‚Äì primarily service workers and browser caching ‚Äì and how it ensures your notes, whiteboard sketches, and to-do lists are always accessible, wherever you are. Bishal Mishra emphasizes the reliability this provides for users on the go or in areas with spotty internet. Once the app is loaded for the first time, its core components are stored locally, allowing you to launch and use it directly from your device, even if you can't reach our servers. This feature makes Note P@d a truly dependable tool for capturing thoughts anytime, anywhere."
    },
    {
        id: 5,
        title: "Your Privacy Matters: How Note P@d Protects Your Data Locally",
        date: "2024-07-05",
        views: 2100,
        author: "Bishal Mishra",
        image: "https://media.licdn.com/dms/image/v2/D4E12AQHg_nJFQiivgg/article-cover_image-shrink_720_1280/article-cover_image-shrink_720_1280/0/1682504783369?e=2147483647&v=beta&t=V6mZOMfpK7IKPasLUGnZBRacpl6_9KF3G3K5jgPmqxI", 
        content: "Your notes are your thoughts, and they should remain private. Note P@d is built with a strong focus on user privacy. This post details how your data is stored locally in your browser's storage, never transmitted to any server by default, and remains on your device.",
        fullContent: "Your notes are your thoughts, and they should remain private. Note P@d is built with a strong focus on user privacy. This post details how your data is stored locally in your browser's localStorage for anonymous users, meaning it's never transmitted to any external server by default and remains completely on your device. Learn about the security implications of this local-first approach and why it's essential for a trustworthy note-taking application. Bishal Mishra shares his commitment to data security and user control. Understand that this also means responsibility rests with you to back up important data (e.g., via PDF export) if you're not using account-based sync features, as clearing browser data will erase local notes. For account holders, data is handled as per our comprehensive Privacy Policy."
    },
    // IMPORTANT FOR ADSENSE: Add MANY MORE (15-20+) unique, high-quality blog posts here.
    // They should be substantial (500-1000+ words each) and offer real value.
];

function loadBlogPosts() {
    if(!blogList) return;
    blogList.innerHTML = ''; 
    if(blogPostsData.length === 0) {
        blogList.innerHTML = "<p>No blog posts available at the moment. Check back soon!</p>";
        return;
    }
    blogPostsData.forEach(post => {
        const blogPostDiv = document.createElement('div');
        blogPostDiv.id = `blog-${post.id}`; 
        blogPostDiv.classList.add('blog-post');

        // Sanitize content for display to prevent XSS if content were user-generated or from less trusted source
        // For this controlled data, direct HTML is fine, but good practice to be aware.
        const shortContentHTML = `<div class="blog-content-short">${post.content}</div>`;
        const fullContentHTML = `<div class="blog-content-full hidden">${post.fullContent}</div>`;

        blogPostDiv.innerHTML = `
            <h4><a href="#blog-${post.id}" onclick="event.preventDefault(); toggleBlogContent(${post.id}); scrollToSection('#blog-${post.id}');" style="text-decoration:none; color:inherit;">${post.title}</a></h4>
            <div class="blog-post-meta">
                <span><i class="fas fa-calendar-alt"></i> ${post.date}</span>
                <span><i class="fas fa-user"></i> By: ${post.author}</span>
                <span><i class="fas fa-eye"></i> ${post.views} views</span>
            </div>
            ${post.image ? `<img src="${post.image}" alt="${post.title}" class="blog-post-image">` : ''}
            <div class="blog-post-content">
                ${shortContentHTML}
                ${fullContentHTML}
                <button class="read-more-btn" onclick="toggleBlogContent(${post.id}); scrollToSection('#blog-${post.id}');">Read More ‚Üí</button>
            </div>
        `;
        blogList.appendChild(blogPostDiv);
    });
}

function toggleBlogContent(postId) {
    const blogPostElement = document.getElementById(`blog-${postId}`); 
    if (!blogPostElement) return;

    const contentShort = blogPostElement.querySelector('.blog-content-short');
    const contentFull = blogPostElement.querySelector('.blog-content-full');
    const readMoreBtn = blogPostElement.querySelector('.read-more-btn');

    if (!contentShort || !contentFull || !readMoreBtn) return;

    const isExpanded = !contentFull.classList.contains('hidden');

    if (isExpanded) {
        contentFull.classList.add('hidden');
        contentShort.classList.remove('hidden');
        readMoreBtn.textContent = 'Read More ‚Üí';
    } else {
        contentFull.classList.remove('hidden');
        contentShort.classList.add('hidden');
        readMoreBtn.textContent = 'Show Less ‚Üê';
    }
}

function checkPremiumStatus(feature) {
    // This is a placeholder. Real logic would involve checking server-side or secure local flags.
    // return localStorage.getItem(`premium_${feature}_activated`) === 'true';
    return false; // For now, assume no premium features are active by default
}

function updateUIForPremiumFeatures() {
    if (!premiumFeaturesSection) return; 

    // Only show premium section if user is logged in, for example
    const isLoggedIn = !!getCurrentUserId(); 
    if (!isLoggedIn && !premiumFeaturesSection.classList.contains('hidden')) {
         premiumFeaturesSection.classList.add('hidden'); // Hide if not logged in
    } else if (isLoggedIn && premiumFeaturesSection.classList.contains('hidden')) {
        // premiumFeaturesSection.classList.remove('hidden'); // Decide if it should be shown by default when logged in
        // For AdSense, better to keep it less prominent initially. Let's keep it hidden unless a specific action shows it.
    }


    document.querySelectorAll('.premium-feature-card').forEach(card => {
        const buyButton = card.querySelector('.premium-buy-btn');
        const manualPaymentInfo = card.querySelector('.manual-payment-info');
        
        if (!buyButton || !manualPaymentInfo) {
            console.warn("Missing elements in a premium card.");
            return;
        }

        const feature = buyButton.getAttribute('data-feature');

        if (checkPremiumStatus(feature)) {
            buyButton.style.display = 'none'; 
            manualPaymentInfo.style.display = 'flex'; 
            manualPaymentInfo.innerHTML = `<p style="color: var(--primary); font-weight: bold;">Premium Feature Activated!</p>`;
        } else {
            buyButton.style.display = 'block'; 
            
            // Check if QR code and text are already there to avoid duplication
            if (!manualPaymentInfo.querySelector('img[alt*="Esewa QR Code"]')) {
                 manualPaymentInfo.innerHTML = `
                    <p>Pay manually via Esewa:</p>
                    <img src="${QR_CODE_IMAGE_URL}" alt="Esewa QR Code for B.T Mobile Care">
                    <p><strong>Esewa ID:</strong> B.T Mobile Care</p>
                    <p><strong>Esewa Number:</strong> 9827801575</p>
                    <small>After payment, please contact us with your transaction ID to activate your feature.</small>
                `;
            }
            // By default, keep payment info hidden until "Upgrade" is clicked.
            // The click handler for .premium-buy-btn will set display to 'flex'.
            // If you want it always visible (once "Upgrade" button is shown), set it here:
            // manualPaymentInfo.style.display = 'flex'; 
             manualPaymentInfo.style.display = 'none'; // Keep hidden until button click
        }
    });
}
</script>
<!-- 
    IMPORTANT NOTES FOR ADSENSE APPROVAL:

    1.  UNIQUE, HIGH-QUALITY CONTENT:
        *   Blog Posts: The 5 sample blog posts are placeholders. You need to write AT LEAST 15-20+ UNIQUE, well-written, and informative articles (500-1000+ words each) related to productivity, note-taking, organization, using digital tools, etc. This is THE MOST CRITICAL factor.
        *   Expand "Overview", "How It Works", "About" sections with more detailed, unique text.
        *   Ensure all content on your site is original and not copied from elsewhere.

    2.  ESSENTIAL PAGES (FILL THEM COMPLETELY):
        *   Privacy Policy: The template provided (`#privacy-policy-section`) MUST be filled with your actual, comprehensive Privacy Policy. Update placeholders like "[IMPORTANT: Enter Current Date]".
        *   Terms of Service: Similarly, fill the `#terms-of-service-section` with your actual Terms of Service.
        *   About Us/Developer: Make this engaging and establish trust.
        *   Contact Us: Ensure clear and easy ways for users to contact you. Your current contact section is good.

    3.  USER EXPERIENCE & NAVIGATION:
        *   Ensure your site is easy to navigate on both desktop and mobile. The Sidenav is good.
        *   Site Speed: Optimize images and ensure fast loading times.
        *   Mobile-Friendliness: Test thoroughly on different devices. Your CSS has responsive queries, which is good.
        *   No Broken Links: Check all internal and external links.

    4.  TECHNICAL REQUIREMENTS:
        *   Domain Name: Use a custom top-level domain (e.g., yourdomain.com), not a subdomain from a free service if possible.
        *   Update Placeholders: Search for "IMPORTANT:" in this code and update all placeholders, especially domain names in `<link rel="canonical">`, `og:url`, and Schema JSON-LD.
        *   `robots.txt`: Create a `robots.txt` file in your root directory to allow Google crawlers. A simple one could be:
            User-agent: *
            Allow: /
            Sitemap: https://your-domain-here.com/sitemap.xml  (Replace with your domain and sitemap location)
        *   `sitemap.xml`: Create a sitemap listing all your important pages (Home, Blog posts, About, Contact, Privacy, Terms) and submit it to Google Search Console.

    5.  ADSENSE POLICIES:
        *   Avoid "thin content" (pages with very little useful text). Each page should offer value.
        *   Do not have excessive ads (once approved) or intrusive pop-ups.
        *   Ensure your site doesn't promote prohibited content. (Your site type is fine in this regard).

    6.  USER-GENERATED CONTENT (Your Notes Section):
        *   AdSense generally doesn't consider user-generated content that is private (like the notes a user saves for themselves) as part of the site's primary content for review. The publicly accessible blog and informational pages are what they will primarily assess.

    7.  PREMIUM FEATURES:
        *   While having premium features is fine, ensure your site offers substantial free value first. Don't make the site feel like it's solely for selling premium upgrades, especially before AdSense approval. The focus should be on the free content and tools.

    It often takes time and multiple attempts to get AdSense approval. Focus on creating a valuable, content-rich resource for users. Good luck!
-->
</body>
</html>
