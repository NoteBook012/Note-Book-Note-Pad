<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
    <title>Note P@d - Modern Online Notepad, Whiteboard & To-Do List</title>
    <meta name="description" content="Note P@d is a free, fast, and secure online application featuring a modern notepad, a digital whiteboard for drawing, and a to-do list manager. Your data is saved locally. Works offline."/>
    <meta name="keywords" content="online notepad, notepad, text editor, whiteboard, online drawing tool, to-do list, checklist, pwa, secure notepad, offline notes, bishal mishra, productivity blog, organization tips"/>
    <meta name="author" content="Bishal Mishra">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://your-domain-here.com/">

    <meta property="og:title" content="Note P@d - Modern Online Notepad, Whiteboard & To-Do List" />
    <meta property="og:description" content="A free, secure online tool with a notepad, whiteboard, and to-do list. Works offline, no sign-up required for basic use." />
    <meta property="og:image" content="https://i.imgur.com/kR1k1jU.png" />
    <meta property="og:url" content="https://your-domain-here.com/" />
    <meta property="og:type" content="website" />

    <link rel="manifest" href="manifest.json">
   
       <link rel="icon" type="image/png" href="images/favicon.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
   
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <script type="application/ld+json">
    [
      {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "Note P@d",
        "applicationCategory": "ProductivityApplication",
        "operatingSystem": "All (Web-based)",
        "offers": {
          "@type": "Offer",
          "price": "0"
        },
        "description": "A free, fast, and secure online application featuring a modern notepad, a digital whiteboard for drawing, and a to-do list manager.",
        "author": {
          "@type": "Person",
          "name": "Bishal Mishra"
        }
      },
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "What is Note P@d?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Note P@d is a free, fast, and secure online application featuring a modern notepad, a digital whiteboard for drawing, and a to-do list manager. It works offline and saves your data locally in your browser."
            }
          },
          {
            "@type": "Question",
            "name": "Is my data safe and private?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes, absolutely. All your notes are stored locally in your browser's localStorage and are never transmitted to any external server. Your data remains 100% on your device."
            }
          },
          {
            "@type": "Question",
            "name": "Can I use Note P@d offline?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes, Note P@d is a Progressive Web App (PWA). Once you visit it for the first time, it can be used offline, making it reliable even without an internet connection."
            }
          },
          {
            "@type": "Question",
            "name": "Do I need to sign up or create an account? (Note P@d)",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "For basic local note-taking, no sign-up is required. You can start using it immediately. If you wish to manage multiple user profiles or use Google Sign-In, then account features are available."
            }
          },
          {
            "@type": "Question",
            "name": "How do I export my notes from Note P@d?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "You can export your notepad entries as PDF files using the \"PDF\" button available with each saved note. Whiteboard drawings can be downloaded as PNG images."
            }
          }
        ]
      }
    ]
    </script>

    <style>
        :root {
            --bg-light: linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%);
            --text-light: #333;
            --card-light: #ffffff;
            --shadow-light: rgba(0, 0, 0, 0.08);

            --bg-dark: linear-gradient(120deg, #2b2b2b 0%, #1e1e1e 100%);
            --text-dark: #e0e0e0;
            --card-dark: #2c2c2c;
            --shadow-dark: rgba(0, 0, 0, 0.25);
           
            --primary: #8c53ff;
            --primary-dark: #7042cc;
            --radius: 12px;
        }

        html { height: 100%; scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg-light); color: var(--text-light); line-height: 1.6; transition: background 0.5s ease, color 0.5s ease; display: flex; flex-direction: column; min-height: 100vh; }
        body.dark { background: var(--bg-dark); color: var(--text-dark); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        main.container { width: 95%; max-width: 1200px; margin: 20px auto; flex-grow: 1; }
        header, footer { background: var(--primary); color: white; padding: 15px 20px; text-align: center; box-shadow: 0 4px 15px var(--shadow-light); z-index: 10; }
        /* --- NEW: Header Flexbox for Menu Button --- */
        header {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .header-content {
            text-align: center;
        }
        body.dark header, body.dark footer { box-shadow: 0 4px 15px var(--shadow-dark); }
        footer { margin-top: auto; }
        footer a { color: #fff; font-weight: 600; text-decoration: none; transition: opacity 0.2s; }
        footer a:hover { opacity: 0.8; }
        
        /* --- NEW: Sidenav Styles --- */
        .sidenav {
            height: 100%;
            width: 0; /* Initially hidden */
            position: fixed;
            z-index: 1002; /* Higher than other content */
            top: 0;
            left: 0;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
        }

        body.dark .sidenav {
            background-color: rgba(30, 30, 30, 0.95);
        }

        .sidenav a {
            padding: 10px 15px 10px 32px;
            text-decoration: none;
            font-size: 22px;
            font-weight: 600;
            color: var(--text-light);
            display: block;
            transition: 0.3s;
        }
        body.dark .sidenav a {
            color: var(--text-dark);
        }

        .sidenav a:hover {
            color: var(--primary);
        }

        .sidenav .closebtn {
            position: absolute;
            top: 10px;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }

        .open-nav-btn {
            font-size: 28px;
            cursor: pointer;
            position: absolute;
            left: 25px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            transition: transform 0.2s;
        }
        .open-nav-btn:hover {
            transform: translateY(-50%) scale(1.1);
        }
        /* --- End Sidenav Styles --- */

        /* Get in Touch Section Styles (now within the main content area) */
        .get-in-touch-section {
            background: var(--card-light);
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: 0 4px 15px var(--shadow-light);
            margin-bottom: 25px;
            text-align: center;
        }

        body.dark .get-in-touch-section {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }

        .get-in-touch-section h3 {
            margin-bottom: 20px;
        }

        .get-in-touch-content {
            display: flex;
            flex-wrap: wrap; /* Allows items to wrap to the next line */
            justify-content: center;
            align-items: center;
            gap: 20px; /* Space between each contact item */
            margin-top: 15px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 8px; /* Space between icon and text within a contact item */
            color: var(--text-light);
            font-size: 16px;
            font-weight: 500;
        }

        body.dark .contact-item {
            color: var(--text-dark);
        }

        .contact-item a {
            color: var(--primary); /* Use primary color for links */
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
        }

        .contact-item a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        .contact-item i {
            color: var(--primary); /* Icon color */
            font-size: 20px; /* Icon size */
        }
        /* End Get in Touch Section Styles */


        #menu-bar { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; background: var(--card-light); padding: 15px; border-radius: var(--radius); margin: 20px 0; box-shadow: 0 4px 15px var(--shadow-light); }
        #menu-bar button, #menu-bar select { padding: 8px 15px; border-radius: var(--radius); border: none; cursor: pointer; background-color: #f0f0f0; color: #333; font-weight: 600; transition: all 0.2s ease-in-out; }
        #menu-bar button:hover, #menu-bar select:hover { background-color: #e0e0e0; transform: translateY(-2px); }
        body.dark #menu-bar { background: #252525; box-shadow: 0 4px 15px var(--shadow-dark); }
        body.dark #menu-bar button, body.dark #menu-bar select { background-color: var(--card-dark); color: var(--text-dark); }
        
        .mode-switcher { border-left: 2px solid #ddd; padding-left: 10px; margin-left: 10px; display:flex; gap: 10px; }
        body.dark .mode-switcher { border-left-color: #555; }
        .mode-switcher button { transition: background-color 0.3s ease, color 0.3s ease; }
        .mode-switcher button.active-mode { background-color: var(--primary); color: white; }
        body.dark .mode-switcher button.active-mode { background-color: var(--primary-dark); }
        
        #editor, #notes, .info-section, #whiteboard-container, #calendar-container, #faq-section, #blogs-section { background: var(--card-light); padding: 25px; border-radius: var(--radius); box-shadow: 0 4px 15px var(--shadow-light); margin-bottom: 25px; }
        body.dark #editor, body.dark #notes, body.dark .info-section, body.dark #whiteboard-container, body.dark #calendar-container, body.dark #faq-section, body.dark #blogs-section { background: var(--card-dark); box-shadow: 0 4px 15px var(--shadow-dark); }
       
        #editor textarea, #editor input[type="text"] { width: 100%; font-size: 16px; padding: 12px; border-radius: var(--radius); border: 1px solid #e0e0e0; background: var(--bg-light); color: var(--text-light); resize: vertical; transition: border-color 0.3s ease, box-shadow 0.3s ease, background 0.3s ease, color 0.3s ease; }
        #editor textarea:focus, #editor input[type="text"]:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(140, 83, 255, 0.2); }
        #editor input[type="text"] { margin-bottom: 15px; font-size: 20px; font-weight: 600; }
        /* --- DARK MODE TEXT FIX --- */
        body.dark #editor textarea, body.dark #editor input[type="text"] { border-color: #444; background: #333; color: var(--text-dark); }
        
        #editor-stats { display: flex; gap: 20px; margin-top: 10px; font-size: 14px; color: #888; }
        body.dark #editor-stats { color: #aaa; }

        #whiteboard-canvas { border: 2px solid #eee; border-radius: var(--radius); cursor: crosshair; touch-action: none; }
        body.dark #whiteboard-canvas { border-color: #444; }
        #whiteboard-toolbar { display: flex; flex-wrap: wrap; align-items: center; gap: 15px; margin-top: 15px; }
        #whiteboard-toolbar label { font-weight: 600; }
        #whiteboard-toolbar input[type="color"] { width: 40px; height: 40px; border: none; padding: 0; cursor: pointer; background: none; border-radius: 50%; }
        #whiteboard-toolbar input[type="range"] { cursor: pointer; }
        #whiteboard-toolbar button { padding: 8px 15px; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; background: #f0f0f0; font-weight: 500; transition: all 0.2s ease-in-out; }
        #whiteboard-toolbar button.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        #todo-list-container { min-height: 200px; padding: 10px; border-radius: var(--radius); border: 1px solid #e0e0e0; }
        body.dark #todo-list-container { border-color: #444; }
        .todo-item { display: flex; align-items: center; gap: 12px; font-size: 16px; padding: 8px 4px; border-bottom: 1px solid #f0f0f0; }
        body.dark .todo-item { border-bottom-color: #3a3a3a; }
        .todo-item:last-child { border-bottom: none; }
        .todo-item input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--primary); }
        .todo-item .todo-text { flex-grow: 1; outline: none; }
        .todo-item.completed .todo-text { text-decoration: line-through; color: #999; }
        #add-todo-btn { margin-top: 15px; }

        .note { border-radius: var(--radius); padding: 20px; margin-bottom: 15px; border: 1px solid #e7e7e7; transition: box-shadow 0.3s ease, transform 0.3s ease, border-left 0.3s ease; }
        .note:hover { transform: translateY(-3px); box-shadow: 0 6px 20px var(--shadow-light); }
        body.dark .note { border-color: #444; }
        body.dark .note:hover { box-shadow: 0 6px 20px var(--shadow-dark); }
        .note.pinned { border-left: 5px solid gold; }
        .note h4 { margin-bottom: 5px; font-size: 18px; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .note p { margin: 10px 0; word-break: break-word; }
        .note small { color: #888; }
        body.dark .note small { color: #aaa; }
        .note-actions button { margin-right: 8px; margin-top: 10px; padding: 6px 12px; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; background: #f0f0f0; font-weight: 500; transition: all 0.2s ease-in-out; }
        body.dark .note-actions button { background: #3e3e3e; color: var(--text-dark); border-color: #555; }

        h3 { font-size: 24px; margin-bottom: 20px; color: var(--primary); text-align: center; }
        .info-section ul { list-style: none; padding-left: 0; }
        .info-section ul li { padding-left: 30px; position: relative; margin-bottom: 12px; }
        .info-section ul li::before { content: '\f058'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: var(--primary); position: absolute; left: 0; top: 2px; font-size: 18px; }
        
        /* Blog Post Styles */
        .blog-post {
            background: var(--card-light);
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: 0 4px 15px var(--shadow-light);
            margin-bottom: 25px;
            text-align: left; /* Align blog content to the left */
        }
        body.dark .blog-post {
            background: var(--card-dark);
            box-shadow: 0 4px 15px var(--shadow-dark);
        }
        .blog-post h4 {
            color: var(--primary);
            margin-bottom: 5px;
            font-size: 22px;
            font-weight: 700;
        }
        .blog-post-meta {
            font-size: 13px;
            color: #888;
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        body.dark .blog-post-meta {
            color: #aaa;
        }
        .blog-post-meta i {
            margin-right: 5px;
            color: var(--primary); /* Color for icons in meta */
        }
        .blog-post-content {
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-light); 
        }
        body.dark .blog-post-content {
            color: var(--text-dark);
        }
        .blog-post-content p {
            margin-bottom: 15px;
        }
        .blog-post-content a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
        }
        .blog-post-content a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }
        .blog-post-image {
            max-width: 100%;
            height: auto;
            border-radius: var(--radius);
            margin-bottom: 15px;
            display: block; /* Remove extra space below image */
        }
        /* Styles for "Read More" functionality */
        .blog-content-short {
            display: -webkit-box;
            -webkit-line-clamp: 3; /* Show only 3 lines */
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            max-height: 3.6em; /* Approx 3 lines * line-height */
            margin-bottom: 15px; /* Space for the button */
        }
        .blog-content-full {
            display: block; /* Show full content */
            max-height: none; /* Remove height limit */
            margin-bottom: 15px;
        }
        .read-more-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s ease-in-out;
        }
        .read-more-btn:hover {
            background: var(--primary-dark);
        }


        .hidden { display: none !important; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Profile Dropdown Styles */
        .profile-container {
            position: fixed;
            top: 20px;
            right: 20px; /* Positioned to the right */
            z-index: 999;
        }
        #profile-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--primary);
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.2s ease-in-out;
            object-fit: cover;
        }
        #profile-icon:hover, #profile-icon:focus {
            transform: scale(1.1);
        }
        .profile-dropdown {
            position: absolute;
            top: 55px; /* Positioned below the icon */
            right: 0; /* Align to the right edge of the container */
            width: 260px;
            background: var(--card-light);
            border-radius: var(--radius);
            box-shadow: 0 8px 25px var(--shadow-light);
            border: 1px solid #eee;
            overflow: hidden;
            animation: fadeIn 0.3s ease;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        body.dark .profile-dropdown {
            background: var(--card-dark);
            box-shadow: 0 8px 25px var(--shadow-dark);
            border-color: #444;
        }
        .dropdown-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        body.dark .dropdown-header {
            border-bottom-color: #444;
        }
        .dropdown-header img {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }
        .dropdown-header span {
            font-weight: 600;
            font-size: 16px;
            word-break: break-all;
        }
        body.dark .dropdown-header small { color: #bbb !important; }

        .dropdown-menu {
            list-style: none;
            padding: 10px 0;
            margin: 0;
        }
        .dropdown-menu li a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            text-decoration: none;
            color: var(--text-light);
            font-size: 14px;
            transition: background-color 0.2s ease;
        }
        body.dark .dropdown-menu li a {
            color: var(--text-dark);
        }
        .dropdown-menu li a:hover {
            background-color: #f5f5f5;
        }
        body.dark .dropdown-menu li a:hover {
            background-color: #3e3e3e;
        }
        .dropdown-menu li.divider {
            height: 1px;
            margin: 8px 0;
            background: #e0e0e0;
        }
        body.dark .dropdown-menu li.divider {
            background: #444;
        }
        #emailVerifiedStatus .fa-check-circle { color: #28a745; } /* Green */
        #emailVerifiedStatus .fa-times-circle { color: #dc3545; } /* Red */
        
        /* Other existing styles... (modal, about-dev, etc.) */
        .about-dev { display: flex; align-items: center; gap: 25px; } .about-dev img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary); box-shadow: 0 4px 15px var(--shadow-light); } body.dark .about-dev img { box-shadow: 0 4px 15px var(--shadow-dark); } .about-dev a { color: var(--primary); font-weight: 600; text-decoration: none; } .about-dev a:hover { text-decoration: underline; } .modal, .welcome-popup { position: fixed; inset: 0; display: flex; justify-content: center; align-items: center; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(8px); z-index: 1001; } .modal-content, .welcome-content { font-family: 'Inter', sans-serif; background: var(--card-light); color: var(--text-light); padding: 32px; border-radius: var(--radius); text-align: center; max-width: 380px; width: 90%; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); animation: fadeIn 0.5s ease; border: 1px solid rgba(255, 255, 255, 0.1); } body.dark .modal-content, body.dark .welcome-content { background: var(--card-dark); color: var(--text-dark); } .modal-content h2, .welcome-content h2 { margin-bottom: 20px; } .modal-content input { width: 100%; padding: 12px 14px; margin: 8px 0; border: 1px solid #d1d5db; border-radius: var(--radius); font-size: 16px; background: var(--bg-light); color: var(--text-light); } body.dark .modal-content input { border-color: #555; background: #333; } .modal-content button, .welcome-content button { background: var(--primary); color: white; padding: 12px 24px; border: none; border-radius: var(--radius); font-size: 16px; margin-top: 16px; cursor: pointer; transition: background 0.3s ease; width: 100%; } .modal-content button:hover, .welcome-content button:hover { background: var(--primary-dark); } .modal-content a { color: var(--primary); text-decoration: none; font-size: 13px; display: block; margin-top: 12px; }

        /* Scroll to top button - Round and filled */
        #goToTopBtn { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            width: 50px; 
            height: 50px; 
            background-color: var(--primary); 
            color: white; 
            border: none; 
            border-radius: 50%; /* Make it perfectly round */
            font-size: 24px; 
            cursor: pointer; 
            display: none; /* Controlled by JS */
            z-index: 1000; 
            box-shadow: 0 4px 12px var(--shadow-light); 
            transition: all 0.3s ease-in-out; /* Smooth transitions for hover/visibility */
            display: flex; /* Use flexbox to center content */
            align-items: center;
            justify-content: center;
        } 
        #goToTopBtn:hover { 
            background-color: var(--primary-dark); 
            transform: scale(1.1); 
        } 
        body.dark #goToTopBtn { box-shadow: 0 4px 12px var(--shadow-dark); } 
        
        #find-replace-dialog { position: fixed; top: 150px; left: 50%; transform: translateX(-50%); background: var(--card-light); padding: 20px; border-radius: var(--radius); box-shadow: 0 8px 25px var(--shadow-light); z-index: 1002; display: flex; gap: 10px; align-items: center; } 
        body.dark #find-replace-dialog { background: var(--card-dark); box-shadow: 0 8px 25px var(--shadow-dark); } 
        #find-replace-dialog input { padding: 8px; border-radius: 8px; border: 1px solid #ccc; } 
        /* --- DARK MODE TEXT FIX --- */ 
        body.dark #find-replace-dialog input { background: #333; border-color: #555; color: var(--text-dark); } 
        #find-replace-dialog button { padding: 8px 12px; } 
        #find-replace-dialog .close-btn { position: absolute; top: 5px; right: 10px; background: transparent; border: none; font-size: 20px; cursor: pointer; } 
        .confetti { font-size: 48px; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); animation: pop 1s ease-out; pointer-events: none; z-index: 2000; } 
        @keyframes pop { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 60% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 0; } }

        /* FAQ Section Styles (People Also Ask) */
        .faq-item {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        body.dark .faq-item {
            border-bottom-color: #3a3a3a;
        }

        .faq-item:last-child {
            border-bottom: none; /* No border for the last item */
        }

        .faq-question {
            font-size: 18px;
            color: var(--primary);
            margin-bottom: 8px;
            cursor: pointer; /* Indicate it's clickable */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .faq-question::after {
            content: '\25BC'; /* Down arrow */
            font-family: 'Font Awesome 6 Free'; /* Use Font Awesome for consistency if preferred */
            font-weight: 900; /* For solid icon */
            font-size: 16px;
            margin-left: 10px;
            transition: transform 0.2s ease;
        }

        .faq-question.active::after {
            transform: rotate(180deg);
        }

        .faq-answer {
            font-size: 15px;
            color: var(--text-light);
            /* Corrected: max-height 0 and overflow hidden for smooth slide effect */
            max-height: 0; 
            overflow: hidden; 
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out, padding-top 0.3s ease-out; /* Smooth reveal */
            padding-top: 0; /* Starts at 0, will expand */
            line-height: 1.5;
            opacity: 0; /* Start invisible */
        }
        .faq-answer.show {
            /* max-height will be set dynamically by JS to scrollHeight for smooth transition */
            opacity: 1;
            padding-top: 5px; /* Add padding when shown */
        }

        body.dark .faq-answer {
            color: var(--text-dark);
        }

        /* Calendar Styles */
        #calendar-container {
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: 0 4px 15px var(--shadow-light);
            margin-bottom: 25px;
            text-align: center;
        }
        body.dark #calendar-container {
            box-shadow: 0 4px 15px var(--shadow-dark);
        }


        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 18px;
            transition: background 0.2s ease-in-out;
        }

        .calendar-header button:hover {
            background: var(--primary-dark);
        }

        .calendar-header h4 {
            font-size: 24px;
            color: var(--primary);
            margin: 0 10px;
            flex-grow: 1;
            text-align: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            width: 100%;
            max-width: 600px; /* Limit calendar width */
            margin: 0 auto;
        }

        .calendar-day-header {
            font-weight: 600;
            color: #777;
            padding: 8px 0;
            text-align: center;
            font-size: 14px;
        }
        body.dark .calendar-day-header {
            color: #bbb;
        }

        .calendar-date {
            padding: 10px 5px;
            text-align: center;
            border-radius: 8px;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            font-size: 15px;
            font-weight: 500;
            min-height: 40px; /* Ensure consistent height */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        body.dark .calendar-date {
            background-color: #3e3e3e;
        }

        .calendar-date:hover:not(.empty):not(.selected) {
            background-color: #e0e0e0;
            transform: translateY(-2px);
        }
        body.dark .calendar-date:hover:not(.empty):not(.selected) {
            background-color: #4a4a4a;
        }

        .calendar-date.empty {
            background-color: transparent;
            cursor: default;
            pointer-events: none;
            opacity: 0.5;
        }

        .calendar-date.current-day {
            background-color: var(--primary);
            color: white;
            font-weight: 700;
        }

        .calendar-date.selected {
            background-color: var(--primary-dark);
            color: white;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transform: scale(1.05);
        }

        #exitCalendarBtn {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #dc3545; /* Red color for exit */
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        #exitCalendarBtn:hover {
            background-color: #c82333; /* Darker red on hover */
            transform: translateY(-2px);
        }


        /* Responsive adjustments */
        @media (max-width: 768px) { 
            .about-dev { flex-direction: column; text-align: center; } 
            .profile-container { top: 10px; right: 10px; } 
            #find-replace-dialog { flex-direction: column; width: 90%; top: 100px; } 
            .mode-switcher { border-left: none; padding-left: 0; margin-left: 0; border-top: 1px solid #ddd; padding-top: 10px; width: 100%; justify-content: center;} 
            body.dark .mode-switcher { border-top-color: #555;}
            .calendar-day-header, .calendar-date {
                font-size: 13px;
                padding: 6px 3px;
                min-height: 35px;
            }
            /* Responsive adjustments for Get in Touch section */
            .get-in-touch-content {
                flex-direction: column; /* Stack vertically on small screens */
                gap: 10px; /* Adjust gap */
            }
            .open-nav-btn {
                left: 15px;
            }
        }
    </style>
</head>
<body>

<!-- NEW: Sidenav HTML Structure -->
<div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
  <a href="#" onclick="closeNav()">Home</a>
  <a href="#overview" onclick="closeNav()">Services</a>
  <a href="#about" onclick="closeNav()">About</a>
  <a href="#blogs-section" onclick="closeNav()">Blogs</a> <!-- Updated to link to Blogs -->
  <a href="#contact-section" onclick="closeNav()">Contact</a>
</div>

<!-- NEW: Profile Container -->
<div id="profile-container" class="profile-container">
    <img id="profile-icon" src="https://ui-avatars.com/api/?name=U" alt="Profile" tabindex="0">
    <div id="profile-dropdown" class="profile-dropdown hidden">
        <div class="dropdown-header">
            <img id="userPic" src="" alt="Profile">
            <div>
                <span id="userNameDisplay">User Name</span>
                <small id="userEmailDisplay" style="color: #888; display: block; font-weight: 400;"></small>
            </div>
        </div>
        <ul class="dropdown-menu">
            <li><a href="#" id="editProfilePhotoBtn"><i class="fas fa-camera fa-fw"></i> Edit Profile Photo</a></li>
            <li><a href="#" id="verifyEmailBtn"><i class="fas fa-envelope fa-fw"></i> Verify Email <span id="emailVerifiedStatus"></span></a></li>
            <li><a href="#" id="resetPasswordBtn"><i class="fas fa-key fa-fw"></i> Reset Password</a></li>
            <li class="divider"></li>
            <li><a href="#" id="manageAccountBtn"><i class="fas fa-user-cog fa-fw"></i> Manage Account</a></li> <!-- NEW: Account link -->
            <li class="divider"></li>
            <li><a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt fa-fw"></i> Logout</a></li>
        </ul>
    </div>
</div>
<input type="file" id="photoUpload" class="hidden" accept="image/*">

<header>
    <!-- NEW: Hamburger menu button -->
    <span class="open-nav-btn" onclick="openNav()">☰</span>
    <!-- NEW: Wrapper for header content to help with centering -->
    <div class="header-content">
        <!-- MODIFIED: Wrap h1 in an anchor tag -->
        <h1>
            <a href="#" onclick="refreshPage()" style="text-decoration: none; color: inherit;">
                📝 NOTE_<span style="color:#ffc107">P@D</span>
            </a>
        </h1>
        <p style="margin-top: 5px; font-weight: 300; opacity: 0.9;">Notepad, Whiteboard, and To-Do List</p>
    </div>
</header>

<main class="container">
    <div id="menu-bar">
        <button onclick="newDoc()">📝 New</button>
        <button onclick="saveNote()">💾 Save</button>
        <button onclick="undo()" title="Undo (Ctrl+Z)">↩️ Undo</button>
        <button onclick="redo()" title="Redo (Ctrl+Y)">↪️ Redo</button>
        <button onclick="cutText()">✂️ Cut</button>
        <button onclick="showFindReplace()">🔍 Find/Replace</button>
        <button id="installBtn" class="hidden">💻 Install App</button>
        <select id="font-family" onchange="changeFont()" title="Change Font Family">
            <option value="Poppins">Poppins</option>
            <option value="Arial">Arial</option>
            <option value="Courier New">Courier New</option>
            <option value="Georgia">Georgia</option>
        </select>
        <select id="font-size" onchange="changeFontSize()" title="Change Font Size">
            <option value="16px" selected>16px</option>
            <option value="18px">18px</option>
            <option value="20px">20px</option>
        </select>
        <button onclick="toggleDark()" title="Toggle Dark/Light Mode">🌗</button>

        <div class="mode-switcher">
            <button id="mode-notepad" onclick="switchMode('notepad')" class="active-mode">Notepad</button>
            <button id="mode-whiteboard" onclick="switchMode('whiteboard')">Whiteboard</button>
            <button id="mode-todo" onclick="switchMode('todo')">To-Do List</button>
            <button id="mode-calendar" onclick="switchMode('calendar')">🗓️ Calendar</button>
            <!-- NEW: Blog mode button -->
            <button id="mode-blog" onclick="switchMode('blog')">Blog</button>
        </div>
    </div>

    <div id="editor">
        <input type="text" id="note-title" placeholder="Your Note Title..." />
        <textarea id="note-text" placeholder="Start typing... your work is saved automatically." rows="10"></textarea>
        <div id="todo-list-container" class="hidden"></div>
        <button id="add-todo-btn" class="hidden" onclick="addTodoItem()">+ Add Item</button>
        <div id="editor-stats">
            <div id="char-count">Character Count: 0</div>
            <div id="word-count">Word Count: 0</div>
        </div>
    </div>

    <div id="whiteboard-container" class="hidden">
        <input type="text" id="whiteboard-title" placeholder="Your Whiteboard Title..." style="width: 100%; font-size: 20px; font-weight: 600; padding: 12px; border-radius: var(--radius); border: 1px solid #e0e0e0; margin-bottom: 15px;" />
        <canvas id="whiteboard-canvas"></canvas>
        <div id="whiteboard-toolbar">
            <label for="wb-color">Color:</label>
            <input type="color" id="wb-color" value="#000000">
            <label for="wb-size">Size:</label>
            <input type="range" id="wb-size" min="1" max="50" value="5">
            <button id="wb-eraser">Eraser</button>
            <button id="wb-clear">Clear</button>
            <button id="wb-download">Download PNG</button>
        </div>
    </div>

    <div id="calendar-container" class="hidden">
        <h3>🗓️ Calendar</h3>
        <div class="calendar-header">
            <button id="prevMonthBtn"><i class="fas fa-chevron-left"></i></button>
            <h4 id="currentMonthYear"></h4>
            <button id="nextMonthBtn"><i class="fas fa-chevron-right"></i></button>
        </div>
        <div class="calendar-grid">
            <div class="calendar-day-header">Sun</div>
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>
            </div>
        <button id="exitCalendarBtn">Exit Calendar</button>
    </div>

    <!-- NEW: Blogs Section -->
    <div id="blogs-section" class="info-section">
        <h3><i class="fas fa-blog" style="color: #6610f2; margin-right: 8px;"></i>Productivity Insights</h3>
        <div id="blog-list">
            <!-- Blog posts will be loaded here by JavaScript -->
        </div>
    </div>

    <div id="notes">
        <h3><i class="fas fa-star" style="color: gold; margin-right: 8px;"></i>Your Saved Notes</h3>
        <div id="note-list"></div>
    </div>
   
    <div class="info-section" id="overview">
        <h3>Overview</h3>
        <p>Note P@d is your smart, browser-based companion for everyday writing. Whether it's journaling, brainstorming, creating a to-do list, or drafting important content, this tool offers a fast, secure, and efficient note-taking experience without the need to install bulky software. Open it in your browser, and you're ready to go. It's lightweight, lightning-fast, and focused entirely on providing a seamless writing environment.</p>
    </div>
    <div class="info-section" id="how-it-works">
        <h3>How Does It Work?</h3>
        <p>Note P@d is built on modern web technologies to ensure your privacy and provide a smooth experience. All the notes you create are stored directly in your browser’s <code>localStorage</code>. This means your data never leaves your computer, and it’s not sent to any server. It works offline after the first visit, making it a reliable tool even without an internet connection. Key features like PDF export are handled by powerful JavaScript libraries right within your browser.</p>
    </div>
    <div class="info-section" id="about">
        <h3>About the Developer</h3>
        <div class="about-dev">
            <img src="https://i.ibb.co/Y4ygWpC2/Untitled-design.png" alt="Untitled-design" border="0">
            <div>
                <p>Note P@d is crafted with care by <strong><a href="https://www.facebook.com/share/166miohhL6/?mibextid=wwXIfr" target="_blank">Bishal Mishra</a></strong>, a passionate web developer dedicated to creating tools that are simple, powerful, and respect user privacy. This project is built to empower users with a fast, flexible, and secure writing experience. No fluff, just functionality that works for you.</p>
            </div>
        </div>
    </div>
    <div class="info-section" id="privacy">
        <h3>Privacy & Security</h3>
        <p>Your data is 100% yours, always. We believe in absolute privacy. All your notes are stored locally in your browser and are never transmitted to any external server. This means only you can access your content. Remember, clearing your browser's site data will permanently delete your notes, so be sure to use the export feature for important backups.</p>
    </div>

    <div class="info-section" id="faq-section">
        <h3>Frequently Asked Questions (FAQ)</h3>
        <div class="faq-item">
            <h4 class="faq-question">What is Note P@d?</h4>
            <p class="faq-answer">Note P@d is a free, fast, and secure online application featuring a modern notepad, a digital whiteboard for drawing, and a to-do list manager. It works offline and saves your data locally in your browser.</p>
        </div>
        <div class="faq-item">
            <h4 class="faq-question">Is my data safe and private?</h4>
            <p class="faq-answer">Yes, absolutely. All your notes are stored locally in your browser's localStorage and are never transmitted to any external server. Your data remains 100% on your device.</p>
        </div>
        <div class="faq-item">
            <h4 class="faq-question">Can I use Note P@d offline?</h4>
            <p class="faq-answer">Yes, Note P@d is a Progressive Web App (PWA). Once you visit it for the first time, it can be used offline, making it reliable even without an internet connection.</p>
        </div>
        <div class="faq-item">
            <h4 class="faq-question">Do I need to sign up or create an account?</h4>
            <p class="faq-answer">For basic local note-taking, no sign-up is required. You can start using it immediately. If you wish to manage multiple user profiles or use Google Sign-In, then account features are available.</p>
        </div>
        <div class="faq-item">
            <h4 class="faq-question">How do I export my notes?</h4>
            <p class="faq-answer">You can export your notepad entries as PDF files using the "PDF" button available with each saved note. Whiteboard drawings can be downloaded as PNG images.</p>
        </div>
    </div>

 
  <h2 id="contact-section">Contact Us</h2>
  <ul style="list-style: none; padding: 0;">
    <!-- Phone -->
    <li style="display: flex; align-items: center; margin-bottom: 10px;">
      <svg style="width:24px;height:24px;margin-right:10px;" viewBox="0 0 24 24" fill="currentColor">
        <path d="M20,15.5C18.83,15.5 17.67,15.33 16.56,15C16.3,14.92 16,15 15.82,15.21L13.21,17.83C10.38,16.39 7.61,13.62 6.17,10.79L8.79,8.17C9,8 9.08,7.7 9,7.44C8.67,6.33 8.5,5.17 8.5,4A1.5,1.5 0 0,0 7,2.5H4A1.5,1.5 0 0,0 2.5,4C2.5,13.39 10.61,21.5 20,21.5A1.5,1.5 0 0,0 21.5,20V17A1.5,1.5 0 0,0 20,15.5Z" />
      </svg>
      <span>+977 9827801575, +977 9828138995</span>
    </li>

    <!-- WhatsApp -->
    <li style="display: flex; align-items: center; margin-bottom: 10px;">
      <svg style="width:24px;height:24px;margin-right:10px;" viewBox="0 0 32 32" fill="currentColor">
        <path d="M16.001 2.667c-7.364 0-13.334 5.969-13.334 13.333 0 2.354.622 4.655 1.802 6.667l-1.864 5.401 5.569-1.813c1.937 1.061 4.119 1.619 6.463 1.619h.002c7.365 0 13.334-5.97 13.334-13.334 0-3.555-1.383-6.899-3.896-9.413s-5.858-3.46-9.276-3.46zM16 26.667c-1.984 0-3.938-.519-5.657-1.5l-.404-.231-3.292 1.073 1.096-3.176-.256-.417c-1.063-1.732-1.624-3.729-1.624-5.719 0-6.065 4.935-11 11-11 2.938 0 5.7 1.146 7.775 3.221 2.073 2.073 3.225 4.835 3.225 7.779 0 6.066-4.935 11-11 11zm6.219-7.865c-.338-.169-2.004-.988-2.316-1.102s-.537-.169-.763.17- .876 1.102-1.075 1.33c-.198.225-.394.254-.732.085-.339-.17-1.431-.528-2.723-1.684-1.007-.9-1.687-2.008-1.885-2.347-.198-.34-.021-.522.149-.69.152-.151.34-.394.509-.592.169-.199.225-.339.339-.564.113-.226.056-.423-.028-.593-.084-.17-.763-1.84-1.046-2.516-.276-.661-.558-.572-.763-.582l-.65-.012c-.198 0-.52.074-.791.339s-1.04 1.016-1.04 2.48 1.065 2.875 1.213 3.075c.149.198 2.097 3.2 5.083 4.487.711.306 1.264.489 1.696.626.713.227 1.36.195 1.871.119.571-.085 1.744-.712 1.99-1.4.247-.688.247-1.28.172-1.4-.07-.113-.308-.18-.646-.34z"/>
      </svg>
      <a href="https://wa.me/9779827801575" target="_blank" rel="noopener noreferrer">WhatsApp</a>
    </li>

    <!-- Gmail -->
    <li style="display: flex; align-items: center; margin-bottom: 10px;">
      <svg style="width:24px;height:24px;margin-right:10px;" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 13.065L1.5 6.75V18a1.5 1.5 0 001.5 1.5h18a1.5 1.5 0 001.5-1.5V6.75l-10.5 6.315zM21 4.5H3a1.5 1.5 0 00-1.2.6l10.2 6.135L22.2 5.1A1.5 1.5 0 0021 4.5z"/>
      </svg>
      <a href="mailto:bishalmishra9000@gmail.com">bishalmishra9000@gmail.com</a>
    </li>

    <!-- Facebook -->
    <li style="display: flex; align-items: center; margin-bottom: 10px;">
      <svg style="width:24px;height:24px;margin-right:10px;" viewBox="0 0 24 24" fill="currentColor">
        <path d="M22.675 0H1.325C.593 0 0 .593 0 1.326V22.67c0 .733.593 1.326 1.325 1.326h11.495V14.7h-3.13v-3.622h3.13V8.41c0-3.1 1.893-4.788 4.66-4.788 1.325 0 2.464.099 2.796.143v3.24h-1.918c-1.504 0-1.796.716-1.796 1.766v2.316h3.59l-.467 3.622h-3.123V24h6.116c.73 0 1.323-.593 1.323-1.326V1.326C24 .593 23.406 0 22.675 0z"/>
      </svg>
      <a href="https://www.facebook.com/share/19LTBhKXuy/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer">Facebook Page</a>
    </li>

    <!-- Website -->
    <li style="display: flex; align-items: center;">
      <svg style="width:24px;height:24px;margin-right:10px;" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12c0 4.67 3.26 8.56 7.6 9.74.56.1.77-.24.77-.53v-1.87c-3.1.67-3.75-1.49-3.75-1.49-.5-1.29-1.21-1.63-1.21-1.63-.99-.68.07-.67.07-.67 1.1.08 1.68 1.12 1.68 1.12.97 1.66 2.54 1.18 3.16.9.1-.7.38-1.18.69-1.45-2.47-.28-5.06-1.23-5.06-5.5 0-1.22.43-2.21 1.14-3-.12-.28-.49-1.41.11-2.94 0 0 .93-.3 3.05 1.15.88-.24 1.83-.36 2.77-.36.94 0 1.89.12 2.77.36 2.12-1.45 3.05-1.15 3.05-1.15.6 1.53.23 2.66.11 2.94.71.79 1.14 1.78 1.14 3 0 4.28-2.6 5.22-5.07 5.5.39.34.73 1.01.73 2.03v3c0 .29.21.63.78.52A10.004 10.004 0 0022 12c0-5.52-4.48-10-10-10z"/>
      </svg>
      <a href="https://bishalmishra.com" target="_blank" rel="noopener noreferrer">https://bishalmishra.com</a>
    </li>
  </ul>


</main>

<div id="welcomePopup" class="welcome-popup hidden"> <div class="welcome-content"> <h2>Welcome to Note P@d!</h2> <p>Capture your ideas. Organize your thoughts. Let’s get started!</p> <button id="getStartedBtn">Get Started</button> </div> </div>
<div id="authModal" class="modal hidden"> <div class="modal-content"> <h2 id="authTitle">Sign In to Note P@d</h2> <input type="text" id="authUsername" placeholder="Username (Email)" /> <input type="password" id="authPassword" placeholder="Password" /> <button id="authSubmit">Sign In</button> <div id="googleSignInDiv" style="margin: 20px auto 0; display: flex; justify-content: center;"></div> <a href="#" id="forgotPassword">Forgot Password?</a> <p id="switchMode">Don't have an account? <a href="#">Sign Up</a></p> </div> </div>
<div id="find-replace-dialog" class="hidden"> <input type="text" id="find-input" placeholder="Find..."> <input type="text" id="replace-input" placeholder="Replace with..."> <button id="replace-btn">Replace</button> <button id="replace-all-btn">Replace All</button> <button id="close-find-replace" class="close-btn" title="Close">×</button> </div>
<button id="goToTopBtn" title="Go to top">↑</button>
<div id="confetti" class="confetti hidden">🎉</div>
<audio id="loginSound" src="https://www.fesliyanstudios.com/play-mp3/387" preload="auto"></audio>

<footer>
   Copyright © 2025 <a href="https://www.facebook.com/share/166miohhL6/?mibextid=wwXIfr" target="_blank">Bishal Mishra</a> | All Rights Reserved.
</footer>


<script>
// --- GLOBAL VARIABLES ---
let editModeId = null;
let isSignUp = false;
let deferredInstallPrompt = null;
let undoStack = [];
let redoStack = [];
let lastChangeTimeout = null;
let currentMode = 'notepad';
let whiteboardState = { canvas: null, ctx: null, isDrawing: false, isErasing: false, lastX: 0, lastY: 0, brushColor: '#000000', brushSize: 5 };

// Calendar variables
let currentCalendarDate = new Date(); // Stores the currently displayed month/year

// --- DOM ELEMENTS ---
const titleInput = document.getElementById('note-title');
const textInput = document.getElementById('note-text');
const noteList = document.getElementById('note-list');
const charCount = document.getElementById('char-count');
const wordCount = document.getElementById('word-count');
const installBtn = document.getElementById('installBtn');
const editorSection = document.getElementById('editor');
const whiteboardSection = document.getElementById('whiteboard-container');
const todoListContainer = document.getElementById('todo-list-container');
const addTodoBtn = document.getElementById('add-todo-btn');
const whiteboardCanvas = document.getElementById('whiteboard-canvas');
const whiteboardTitleInput = document.getElementById('whiteboard-title');
const findReplaceDialog = document.getElementById('find-replace-dialog');
const goToTopBtn = document.getElementById('goToTopBtn');
const welcomePopup = document.getElementById('welcomePopup');
const authModal = document.getElementById('authModal');
const authTitle = document.getElementById('authTitle');
const authUsername = document.getElementById('authUsername');
const authPassword = document.getElementById('authPassword');
const authSubmit = document.getElementById('authSubmit');
const switchAuthModeLink = document.getElementById('switchMode');
const confetti = document.getElementById('confetti');
const loginSound = document.getElementById('loginSound');

// Profile Dropdown Elements
const profileContainer = document.getElementById('profile-container');
const profileIcon = document.getElementById('profile-icon');
const profileDropdown = document.getElementById('profile-dropdown');
const userPic = document.getElementById('userPic');
const userNameDisplay = document.getElementById('userNameDisplay');
const userEmailDisplay = document.getElementById('userEmailDisplay');
const emailVerifiedStatus = document.getElementById('emailVerifiedStatus');
const logoutBtn = document.getElementById('logoutBtn');
const verifyEmailBtn = document.getElementById('verifyEmailBtn');
const resetPasswordBtn = document.getElementById('resetPasswordBtn');
const editProfilePhotoBtn = document.getElementById('editProfilePhotoBtn');
const photoUploadInput = document.getElementById('photoUpload');
const manageAccountBtn = document.getElementById('manageAccountBtn'); // NEW: Account button

// Blog elements
const blogsSection = document.getElementById('blogs-section');
const blogList = document.getElementById('blog-list'); // NEW: Reference to the blog list container

// Calendar DOM elements
const calendarContainer = document.getElementById('calendar-container');
const currentMonthYearDisplay = document.getElementById('currentMonthYear');
const calendarGrid = document.querySelector('#calendar-container .calendar-grid');
const prevMonthBtn = document.getElementById('prevMonthBtn');
const nextMonthBtn = document.getElementById('nextMonthBtn');
const exitCalendarBtn = document.getElementById('exitCalendarBtn'); // New exit button

// --- NEW FUNCTION TO REFRESH THE PAGE ---
function refreshPage() {
    window.location.reload();
}

// --- NEW: SIDENAV FUNCTIONS ---
function openNav() {
    document.getElementById("mySidenav").style.width = "250px";
}

function closeNav() {
    document.getElementById("mySidenav").style.width = "0";
}

// --- INITIALIZATION ---
document.addEventListener("DOMContentLoaded", () => {
    loadDarkMode();
    checkAuthStatus();
    attachEventListeners();
    initWhiteboard(); 
    renderCalendar(currentCalendarDate); // Initialize calendar display
    switchMode('notepad'); // Default mode
    loadBlogPosts(); // Load blog posts on DOMContentLoaded
});

window.onload = initGoogleSignIn;

// --- EVENT LISTENERS ---
function attachEventListeners() {
    textInput.addEventListener('input', () => { updateAll(); recordState(); });
    titleInput.addEventListener('input', saveDraft);
    // Updated scroll-to-top visibility logic
    window.onscroll = () => { goToTopBtn.style.display = (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) ? "flex" : "none"; };
    goToTopBtn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
    document.getElementById('getStartedBtn').onclick = () => { welcomePopup.classList.add("hidden"); authModal.classList.remove("hidden"); localStorage.setItem("visited", "true"); }; 
    switchAuthModeLink.onclick = (e) => { e.preventDefault(); isSignUp = !isSignUp; authTitle.textContent = isSignUp ? "Create your Account" : "Welcome Back"; authSubmit.textContent = isSignUp ? "Sign Up" : "SignIn"; switchAuthModeLink.innerHTML = isSignUp ? 'Already have an account? <a href="#">Sign In</a>' : 'Don’t have an account? <a href="#">Sign Up</a>'; };
    authSubmit.onclick = handleAuthSubmit;
    document.getElementById('close-find-replace').onclick = closeFindReplace;
    document.getElementById('replace-btn').onclick = () => findAndReplace(false);
    document.getElementById('replace-all-btn').onclick = () => findAndReplace(true);

    // Profile Dropdown Listeners
    profileIcon.addEventListener('click', toggleProfileDropdown);
    document.addEventListener('click', closeDropdownOnClickOutside);
    logoutBtn.addEventListener('click', handleLogout);
    verifyEmailBtn.addEventListener('click', handleVerifyEmail);
    resetPasswordBtn.addEventListener('click', handleResetPassword);
    manageAccountBtn.addEventListener('click', handleManageAccount); // NEW: Listener for Manage Account
    
    // UPDATED: Profile photo functionality
    editProfilePhotoBtn.addEventListener('click', (e) => { 
        e.preventDefault(); 
        photoUploadInput.click();
    });
    photoUploadInput.addEventListener('change', handlePhotoUpload);

    // FAQ section accordion behavior
    document.querySelectorAll('.faq-question').forEach(question => {
        question.addEventListener('click', () => {
            const answer = question.nextElementSibling;
            const isActive = question.classList.contains('active');

            // Close all other open answers
            document.querySelectorAll('.faq-question').forEach(q => {
                if (q !== question && q.classList.contains('active')) {
                    q.classList.remove('active');
                    q.nextElementSibling.classList.remove('show');
                    q.nextElementSibling.style.maxHeight = '0'; // Collapse
                }
            });

            // Toggle the clicked answer
            if (isActive) {
                question.classList.remove('active');
                answer.classList.remove('show');
                answer.style.maxHeight = '0'; // Collapse
            } else {
                question.classList.add('active');
                answer.classList.add('show');
                // Set max-height to scrollHeight to allow for smooth transition based on content
                // A small timeout ensures the element renders before we calculate scrollHeight
                setTimeout(() => {
                    answer.style.maxHeight = answer.scrollHeight + "px"; 
                }, 10); // Small delay
            }
        });
    });

    // Calendar navigation
    prevMonthBtn.addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
        renderCalendar(currentCalendarDate);
    });

    nextMonthBtn.addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
        renderCalendar(currentCalendarDate);
    });

    calendarGrid.addEventListener('click', (e) => {
        if (e.target.classList.contains('calendar-date') && !e.target.classList.contains('empty')) {
            // Remove 'selected' from previously selected dates
            document.querySelectorAll('.calendar-date.selected').forEach(date => {
                date.classList.remove('selected');
            });
            // Add 'selected' to the clicked date
            e.target.classList.add('selected');
            // You could add logic here to show events for the selected date
            // alert(`Selected date: ${currentMonthYearDisplay.textContent} ${e.target.textContent}`);
        }
    });

    // New: Exit Calendar Button Listener
    exitCalendarBtn.addEventListener('click', () => {
        switchMode('notepad'); // Return to Notepad mode
    });
}

// --- PROFILE & AUTH FUNCTIONS ---
function toggleProfileDropdown() {
    profileDropdown.classList.toggle('hidden');
}

function closeDropdownOnClickOutside(event) {
    if (!profileContainer.contains(event.target) && !profileDropdown.classList.contains('hidden')) {
        profileDropdown.classList.add('hidden');
    }
}

function checkAuthStatus() {
    const currentUserId = getCurrentUserId();
    if (currentUserId) {
        showUserInfo();
        loadDraft();
        displayNotes();
        updateAll();
        resetHistory(textInput.value);
    } else if (!localStorage.getItem("visited")) {
        welcomePopup.classList.remove("hidden");
    } else {
        authModal.classList.remove("hidden");
    }
}

function showUserInfo() {
    const username = localStorage.getItem('currentUser');
    const picUrl = localStorage.getItem('userPic');
    const email = localStorage.getItem('userEmail');
    const isVerified = localStorage.getItem('emailVerified') === 'true';

    if (!username) return;

    profileContainer.classList.remove('hidden');
    
    const avatarUrl = picUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=random&color=fff`;
    profileIcon.src = avatarUrl;
    userPic.src = avatarUrl;
    
    userNameDisplay.textContent = username;
    userEmailDisplay.textContent = email || '';

    if (isVerified) {
        emailVerifiedStatus.innerHTML = '<i class="fas fa-check-circle" title="Email is verified"></i>';
        verifyEmailBtn.style.opacity = '0.6';
        verifyEmailBtn.style.cursor = 'default';
        verifyEmailBtn.parentElement.style.display = 'block'; // Ensure it's visible
    } else {
        emailVerifiedStatus.innerHTML = '<i class="fas fa-times-circle" title="Email not verified"></i>';
        verifyEmailBtn.style.opacity = '1';
        verifyEmailBtn.style.cursor = 'pointer';
        verifyEmailBtn.parentElement.style.display = 'block'; // Ensure it's visible
    }

    const provider = localStorage.getItem('authProvider');
    if (provider === 'google') {
        resetPasswordBtn.parentElement.style.display = 'none';
        // Google accounts are pre-verified, so hide the verify button too
        if (localStorage.getItem('emailVerified') === 'true') {
            verifyEmailBtn.parentElement.style.display = 'none';
        }
    } else {
        resetPasswordBtn.parentElement.style.display = 'block';
    }
}

function handleAuthSubmit() {
    const username = authUsername.value.trim();
    const password = authPassword.value.trim();
    if (!username || !password) return alert("Please fill in all fields");

    const users = JSON.parse(localStorage.getItem("users") || "{}");
    if (isSignUp) {
        if (users[username]) return alert("Username (email) already exists.");
        users[username] = password; // In a real app, hash this password
        localStorage.setItem("users", JSON.stringify(users));
        localStorage.setItem('authProvider', 'email');
        localStorage.setItem('userEmail', username);
        localStorage.setItem('emailVerified', 'false');
        localStorage.setItem("currentUser", username);
        loginSuccess(username, "", username);
    } else {
        if (!users[username] || users[username] !== password) return alert("Invalid credentials");
        if (localStorage.getItem('emailVerified') === null) {
            localStorage.setItem('emailVerified', 'false');
            localStorage.setItem('authProvider', 'email');
            localStorage.setItem('userEmail', username);
        }
        localStorage.setItem("currentUser", username);
        loginSuccess(username, "", username);
    }
}

function handleLogout(e) {
    if(e) e.preventDefault();
    localStorage.removeItem("currentUser");
    localStorage.removeItem("userPic");
    localStorage.removeItem("currentUserId");
    localStorage.removeItem("emailVerified");
    localStorage.removeItem("userEmail");
    localStorage.removeItem("authProvider");
    
    if (typeof google !== 'undefined' && google.accounts) google.accounts.id.disableAutoSelect();
    
    profileContainer.classList.add('hidden');
    if (!profileDropdown.classList.contains('hidden')) {
        profileDropdown.classList.add('hidden');
    }
    
    authModal.classList.remove("hidden");
    noteList.innerHTML = '';
    newDoc();
}

// --- NEW/UPDATED FUNCTIONALITY ---

function handlePhotoUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
        const base64Image = e.target.result;
        localStorage.setItem('userPic', base64Image);
        showUserInfo(); // Immediately update the UI
        alert("Profile photo updated!");
    };
    reader.readAsDataURL(file);
}

function handleVerifyEmail(e) {
    e.preventDefault();
    if (localStorage.getItem('emailVerified') === 'true') {
        alert('Your email is already verified.');
        return;
    }
    
    // Simulate sending a code
    const verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
    alert(`A verification code has been "sent" to your email.\n\nYour code is: ${verificationCode}`);

    const userCode = prompt("Please enter the 6-digit verification code:");

    if (userCode === verificationCode) {
        localStorage.setItem('emailVerified', 'true');
        alert("Email verified successfully!");
        showUserInfo(); // Update UI to show green check
    } else {
        alert("Incorrect code. Please try again.");
    }
}

function handleResetPassword(e) {
    e.preventDefault();
    if (localStorage.getItem('authProvider') === 'google') return;

    const newPassword = prompt("Enter your new password (min 4 characters):");
    if (!newPassword || newPassword.length < 4) {
        alert("Password is too short.");
        return;
    }

    const confirmPassword = prompt("Confirm your new password:");
    if (newPassword !== confirmPassword) {
        alert("Passwords do not match.");
        return;
    }

    const username = localStorage.getItem('userEmail');
    const users = JSON.parse(localStorage.getItem("users") || "{}");
    if (users[username]) {
        users[username] = newPassword; // Update the password
        localStorage.setItem("users", JSON.stringify(users));
        alert("Your password has been reset successfully!");
    } else {
        alert("An error occurred. Could not find user.");
    }
}

// NEW: Function to handle the "Manage Account" button click
function handleManageAccount(e) {
    e.preventDefault();
    // In a real application, this would navigate to a dedicated account management page or open a modal.
    // For now, we'll just show an alert.
    alert("Account management features are not fully implemented yet. You can manage your profile photo and email verification from here.");
    // You could potentially open a modal here with more account settings.
}

// --- END NEW/UPDATED FUNCTIONALITY ---

function loginSuccess(username, picUrl, userId) {
    localStorage.setItem("currentUserId", userId);
    if(picUrl) localStorage.setItem("userPic", picUrl);

    showUserInfo();
    authModal.classList.add("hidden");
    confetti.classList.remove("hidden");
    loginSound.play().catch(e => console.log("Audio play failed:", e));
    setTimeout(() => confetti.classList.add("hidden"), 1200);
    
    loadDraft();
    displayNotes();
    updateAll();
    resetHistory(textInput.value);
}

function initGoogleSignIn() {
    try {
        google.accounts.id.initialize({
            client_id: "107788525119-7mkm9t2pqe53q85ltenn4lr3av7itdfh.apps.googleusercontent.com", // This is a public client ID for testing
            callback: handleGoogleSignIn
        });
        google.accounts.id.renderButton(
            document.getElementById("googleSignInDiv"),
            { theme: "outline", size: "large", shape: "pill", width: "300" }
        );
    } catch (error) {
        console.error("Google GSI could not be initialized.", error);
        document.getElementById('googleSignInDiv').innerHTML = "Google Sign-In failed to load.";
    }
}

function jwtDecode(token) {
    try { return JSON.parse(atob(token.split('.')[1])); }
    catch (e) { return null; }
}

function handleGoogleSignIn(response) {
    const data = jwtDecode(response.credential);
    if (!data) return;

    const name = data.name || data.email;
    const picture = data.picture || "";
    const userId = data.sub;
    const email = data.email;
    const emailVerified = data.email_verified; // boolean

    localStorage.setItem("currentUser", name);
    localStorage.setItem("userPic", picture);
    localStorage.setItem('authProvider', 'google');
    localStorage.setItem('userEmail', email);
    localStorage.setItem('emailVerified', emailVerified.toString());
    
    loginSuccess(name, picture, userId);
}

// --- MODE SWITCHING ---
function switchMode(mode) {
    currentMode = mode;
    editorSection.classList.add('hidden');
    whiteboardSection.classList.add('hidden');
    todoListContainer.classList.add('hidden');
    addTodoBtn.classList.add('hidden');
    calendarContainer.classList.add('hidden'); // Hide calendar
    blogsSection.classList.add('hidden'); // NEW: Hide blogs section
    
    // Show or hide title/whiteboardTitle inputs based on mode
    titleInput.classList.toggle('hidden', mode === 'whiteboard' || mode === 'calendar' || mode === 'blog'); // Hide title for calendar and blog
    whiteboardTitleInput.classList.toggle('hidden', mode !== 'whiteboard');

    // Manage active mode button
    document.querySelectorAll('.mode-switcher button').forEach(b => b.classList.remove('active-mode'));
    document.getElementById(`mode-${mode}`).classList.add('active-mode');

    // Show appropriate section based on mode
    if (mode === 'notepad') {
        editorSection.classList.remove('hidden');
        textInput.classList.remove('hidden');
    } else if (mode === 'whiteboard') {
        whiteboardSection.classList.remove('hidden');
        resizeWhiteboard();
    } else if (mode === 'todo') {
        editorSection.classList.remove('hidden'); // To show title input for todo
        todoListContainer.classList.remove('hidden');
        addTodoBtn.classList.remove('hidden');
        textInput.classList.add('hidden'); // Hide text area in todo mode
    } else if (mode === 'calendar') {
        calendarContainer.classList.remove('hidden');
        renderCalendar(currentCalendarDate); // Render calendar when switched to
    } else if (mode === 'blog') { // NEW: Show blogs section
        blogsSection.classList.remove('hidden');
    }
}

// --- CORE FUNCTIONS (Notepad, Whiteboard, To-Do) ---
function newDoc() {
    editModeId = null;
    titleInput.value = '';
    textInput.value = '';
    whiteboardTitleInput.value = '';
    todoListContainer.innerHTML = '';
    clearCanvas();
    updateAll();
    clearDraft();
    resetHistory();
    // Keep the current calendar date on new doc
    renderCalendar(currentCalendarDate); 
    switchMode('notepad'); // Default mode
    titleInput.focus();
}

function saveNote() {
    const key = getUserNotesKey();
    if (!key) { alert("Please sign in to save notes."); return; }

    let title, content, type;
    if (currentMode === 'notepad') {
        if (!textInput.value.trim()) { alert("Cannot save an empty note."); return; }
        title = titleInput.value || 'Untitled Note';
        content = textInput.value;
        type = 'notepad';
    } else if (currentMode === 'whiteboard') {
        title = whiteboardTitleInput.value || 'Untitled Whiteboard';
        content = whiteboardState.canvas.toDataURL();
        type = 'whiteboard';
    } else if (currentMode === 'todo') {
        if (todoListContainer.children.length === 0) { alert("Cannot save an empty to-do list."); return; }
        title = titleInput.value || 'Untitled To-Do List';
        content = serializeTodoList();
        type = 'todo';
    } else if (currentMode === 'calendar') {
        // Calendar content is not "saved" in the same way as notes, whiteboards, or todo lists.
        // If you want to save calendar *events*, this would be the place to implement that.
        // For now, saving just switches to a new doc for other types.
        alert("Calendar content is managed directly and does not require manual saving like notes.");
        return; 
    }

    const notes = JSON.parse(localStorage.getItem(key)) || [];
    const timestamp = new Date().toLocaleString();
    if (editModeId) {
        const idx = notes.findIndex(n => n.id === editModeId);
        if (idx > -1) {
            notes[idx] = { ...notes[idx], title, text: content, type, date: timestamp }; 
        }
    } else {
        notes.unshift({ id: Date.now(), title, text: content, type, date: timestamp, pinned: false, isLocked: false });
    }
    localStorage.setItem(key, JSON.stringify(notes));
    displayNotes();
    newDoc();
}

function displayNotes() {
    const key = getUserNotesKey();
    const notes = key ? JSON.parse(localStorage.getItem(key)) || [] : [];
    notes.sort((a, b) => b.pinned - a.pinned || b.id - a.id);
    
    noteList.innerHTML = notes.map(n => {
        let contentPreview = '';
        const noteType = n.type || 'notepad';
        if (n.isLocked) {
            contentPreview = `<i>This note is locked. Click 'Unlock' to view.</i>`;
        } else if (noteType === 'whiteboard') {
            contentPreview = `<img src="${n.text}" alt="Whiteboard Preview" style="width:100%; height:auto; border-radius: 8px; margin-top: 10px; border: 1px solid #eee;">`;
        } else if (noteType === 'todo') {
            try { contentPreview = `<i>To-Do List with ${JSON.parse(n.text).length} items.</i>`; }
            catch { contentPreview = `<i>Corrupted To-Do List.</i>`}
        } else {
            contentPreview = `${n.text.substring(0, 200)}${n.text.length > 200 ? '...' : ''}`;
        }

        return `
        <div class="note ${n.pinned ? 'pinned' : ''}" id="note-${n.id}">
            <h4>
                ${noteType === 'whiteboard' ? '🎨' : (noteType === 'todo' ? '☑️' : '📝')} 
                ${n.title} 
                ${n.isLocked ? '<i class="fas fa-lock" style="color: #ffc107;"></i>' : ''}
            </h4>
            <p>${contentPreview}</p>
            <small>Last updated: ${n.date}</small>
            <div class="note-actions">
                <button onclick="editNote(${n.id})"><i class="fas fa-edit"></i> Edit</button>
                <button onclick="toggleLock(${n.id})"><i class="fas fa-key"></i> ${n.isLocked ? 'Unlock' : 'Lock'}</button>
                <button onclick="pinNote(${n.id})"><i class="fas fa-thumbtack"></i> ${n.pinned ? 'Unpin' : 'Pin'}</button>
                ${noteType !== 'whiteboard' ? `<button onclick="exportPDF(${n.id})"><i class="fas fa-file-pdf"></i> PDF</button>` : ''}
                <button onclick="deleteNote(${n.id})"><i class="fas fa-trash"></i> Delete</button>
            </div>
        </div>
    `}).join('');
}

async function editNote(id) {
    const key = getUserNotesKey(); if (!key) return;
    const notes = JSON.parse(localStorage.getItem(key)) || [];
    const note = notes.find(n => n.id === id);
    if (!note) return;
    if (note.isLocked) {
        const password = prompt("Enter password to unlock this note:");
        if (!password) return;
        const hashed = await hashPassword(password);
        if (hashed !== note.passwordHash) { alert("Incorrect password."); return; }
    }

    newDoc(); // Clears current editing area
    const noteType = note.type || 'notepad';
    switchMode(noteType); // Switch to appropriate mode for editing
    editModeId = id;

    if (noteType === 'notepad') {
        titleInput.value = note.title;
        textInput.value = note.text;
        resetHistory(note.text);
    } else if (noteType === 'whiteboard') {
        whiteboardTitleInput.value = note.title;
        const img = new Image();
        img.onload = () => {
            clearCanvas();
            whiteboardState.ctx.drawImage(img, 0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height);
            // After drawing, get image data to prevent it from disappearing
            whiteboardState.imageData = whiteboardState.ctx.getImageData(0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height);
        };
        img.src = note.text;
    } else if (noteType === 'todo') {
        titleInput.value = note.title;
        parseAndRenderTodoList(note.text);
    }
    
    updateAll();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// --- HELPER & UTILITY FUNCTIONS ---
function getCurrentUserId() { return localStorage.getItem('currentUserId'); }
function getUserNotesKey() { const userId = getCurrentUserId(); return userId ? `notes_${userId}` : null; }
function getDraftKey() { const userId = getCurrentUserId(); return userId ? `draft_${userId}` : null; }
function updateAll() { saveDraft(); updateCharCount(); updateWordCount(); }
function updateCharCount() { charCount.textContent = `Character Count: ${textInput.value.length}`; }
function updateWordCount() { const words = textInput.value.trim().split(/\s+/).filter(word => word.length > 0); wordCount.textContent = `Word Count: ${words.length}`; }
function saveDraft() { const key = getDraftKey(); if (!key) return; if (currentMode === 'notepad') localStorage.setItem(key, JSON.stringify({ title: titleInput.value, text: textInput.value })); }
function loadDraft() { const key = getDraftKey(); if (!key) return; const d = localStorage.getItem(key); if (d) { const { title, text } = JSON.parse(d); titleInput.value = title; textInput.value = text; } }
function clearDraft() { const key = getDraftKey(); if (key) localStorage.removeItem(key); }
function toggleDark() { document.body.classList.toggle('dark'); localStorage.setItem('darkMode', document.body.classList.contains('dark')); }
function loadDarkMode() { if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark'); }
function changeFont() { textInput.style.fontFamily = document.getElementById('font-family').value; }
function changeFontSize() { textInput.style.fontSize = document.getElementById('font-size').value; }
async function hashPassword(password) { if (!password) return ''; const encoder = new TextEncoder(); const data = encoder.encode(password); const hashBuffer = await crypto.subtle.digest('SHA-256', data); const hashArray = Array.from(new Uint8Array(hashBuffer)); return hashArray.map(b => b.toString(16).padStart(2, '0')).join(''); }

// --- WHITEBOARD ---
function initWhiteboard() { whiteboardState.canvas = whiteboardCanvas; whiteboardState.ctx = whiteboardCanvas.getContext('2d'); resizeWhiteboard(); whiteboardState.canvas.addEventListener('mousedown', startDrawing); whiteboardState.canvas.addEventListener('mouseup', stopDrawing); whiteboardState.canvas.addEventListener('mouseout', stopDrawing); whiteboardState.canvas.addEventListener('mousemove', draw); whiteboardState.canvas.addEventListener('touchstart', startDrawing); whiteboardState.canvas.addEventListener('touchend', stopDrawing); whiteboardState.canvas.addEventListener('touchmove', draw); document.getElementById('wb-color').onchange = (e) => { whiteboardState.brushColor = e.target.value; whiteboardState.isErasing = false; document.getElementById('wb-eraser').classList.remove('active'); }; document.getElementById('wb-size').onchange = (e) => whiteboardState.brushSize = e.target.value; document.getElementById('wb-eraser').onclick = toggleEraser; document.getElementById('wb-clear').onclick = clearCanvas; document.getElementById('wb-download').onclick = downloadCanvas; window.addEventListener('resize', resizeWhiteboard); }
function resizeWhiteboard() { 
    // Save current content before resizing
    // Check if context is available before attempting to get image data
    let imageData = null;
    if (whiteboardState.ctx && whiteboardState.canvas.width > 0 && whiteboardState.canvas.height > 0) {
        imageData = whiteboardState.ctx.getImageData(0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height);
    }

    const containerWidth = whiteboardSection.clientWidth - 50; 
    whiteboardState.canvas.width = containerWidth; 
    whiteboardState.canvas.height = Math.min(containerWidth * 0.6, window.innerHeight * 0.5); 

    // Restore content after resizing
    if (imageData) {
        whiteboardState.ctx.putImageData(imageData, 0, 0);
    }
}
function getMousePos(e) { const rect = whiteboardState.canvas.getBoundingClientRect(); const scaleX = whiteboardState.canvas.width / rect.width; const scaleY = whiteboardState.canvas.height / rect.height; const clientX = e.touches ? e.touches[0].clientX : e.clientX; const clientY = e.touches ? e.touches[0].clientY : e.clientY; return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY }; }
function startDrawing(e) { e.preventDefault(); whiteboardState.isDrawing = true; const { x, y } = getMousePos(e); [whiteboardState.lastX, whiteboardState.lastY] = [x, y]; }
function stopDrawing() { if (!whiteboardState.isDrawing) return; whiteboardState.isDrawing = false; }
function draw(e) { e.preventDefault(); if (!whiteboardState.isDrawing) return; const { ctx, lastX, lastY, brushColor, brushSize, isErasing } = whiteboardState; const { x, y } = getMousePos(e); ctx.globalCompositeOperation = isErasing ? 'destination-out' : 'source-over'; ctx.strokeStyle = brushColor; ctx.lineWidth = brushSize; ctx.lineCap = 'round'; ctx.lineJoin = 'round'; ctx.beginPath(); ctx.moveTo(lastX, lastY); ctx.lineTo(x, y); ctx.stroke(); [whiteboardState.lastX, whiteboardState.lastY] = [x, y]; }
function toggleEraser() { whiteboardState.isErasing = !whiteboardState.isErasing; document.getElementById('wb-eraser').classList.toggle('active', whiteboardState.isErasing); }
function clearCanvas() { whiteboardState.ctx.clearRect(0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height); }
function downloadCanvas() { const link = document.createElement('a'); link.download = `${whiteboardTitleInput.value || 'whiteboard'}.png`; link.href = whiteboardState.canvas.toDataURL('image/png'); link.click(); }

// --- TO-DO LIST ---
function addTodoItem(text = '', checked = false) { const itemDiv = document.createElement('div'); itemDiv.className = 'todo-item'; if (checked) itemDiv.classList.add('completed'); const checkbox = document.createElement('input'); checkbox.type = 'checkbox'; checkbox.checked = checked; checkbox.onchange = () => itemDiv.classList.toggle('completed', checkbox.checked); const textSpan = document.createElement('span'); textSpan.className = 'todo-text'; textSpan.contentEditable = true; textSpan.textContent = text || 'New to-do...'; itemDiv.appendChild(checkbox); itemDiv.appendChild(textSpan); todoListContainer.appendChild(itemDiv); }
function serializeTodoList() { const items = []; todoListContainer.querySelectorAll('.todo-item').forEach(item => { items.push({ text: item.querySelector('.todo-text').textContent, checked: item.querySelector('input[type="checkbox"]').checked }); }); return JSON.stringify(items); }
function parseAndRenderTodoList(jsonString) { todoListContainer.innerHTML = ''; try { JSON.parse(jsonString).forEach(item => addTodoItem(item.text, item.checked)); } catch (e) { console.error("Failed to parse To-Do list", e); } }

// --- CALENDAR FUNCTIONS ---
function renderCalendar(date) {
    const year = date.getFullYear();
    const month = date.getMonth(); // 0-11
    
    currentMonthYearDisplay.textContent = date.toLocaleString('en-US', { month: 'long', year: 'numeric' });
    
    // Clear previous days, but keep day headers (first 7 elements)
    while (calendarGrid.children.length > 7) {
        calendarGrid.removeChild(calendarGrid.lastChild);
    }

    const firstDayOfMonth = new Date(year, month, 1).getDay(); // 0 for Sunday, 1 for Monday...
    const daysInMonth = new Date(year, month + 1, 0).getDate(); // Last day of current month

    const today = new Date();
    const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;

    // Add empty divs for preceding days to align first day correctly
    for (let i = 0; i < firstDayOfMonth; i++) {
        const emptyDiv = document.createElement('div');
        emptyDiv.classList.add('calendar-date', 'empty');
        calendarGrid.appendChild(emptyDiv);
    }

    // Add actual days of the month
    for (let day = 1; day <= daysInMonth; day++) {
        const dateDiv = document.createElement('div');
        dateDiv.classList.add('calendar-date');
        dateDiv.textContent = day;

        if (isCurrentMonth && day === today.getDate()) {
            dateDiv.classList.add('current-day');
        }
        // You could add a 'selected' class here if you want to remember selections
        // For example: if (selectedDates.includes(new Date(year, month, day).toDateString())) dateDiv.classList.add('selected');

        calendarGrid.appendChild(dateDiv);
    }
}


// --- EDITOR ACTIONS ---
function recordState() { clearTimeout(lastChangeTimeout); lastChangeTimeout = setTimeout(() => { if (currentMode !== 'notepad') return; const currentState = textInput.value; if (undoStack.length === 0 || undoStack[undoStack.length - 1] !== currentState) { undoStack.push(currentState); redoStack = []; if (undoStack.length > 50) undoStack.shift(); } }, 500); }
function undo() { if (currentMode !== 'notepad' || undoStack.length < 2) return; redoStack.push(undoStack.pop()); textInput.value = undoStack[undoStack.length - 1] || ''; updateAll(); }
function redo() { if (currentMode !== 'notepad' || redoStack.length === 0) return; const nextState = redoStack.pop(); undoStack.push(nextState); textInput.value = nextState; updateAll(); }
function resetHistory(initialText = '') { undoStack = [initialText]; redoStack = []; }
function cutText() { if (currentMode !== 'notepad' || textInput.selectionStart === textInput.selectionEnd) return; navigator.clipboard.writeText(textInput.value.substring(textInput.selectionStart, textInput.selectionEnd)); document.execCommand('delete', false, null); updateAll(); recordState(); }
function showFindReplace() { if (currentMode !== 'notepad') return; findReplaceDialog.classList.remove('hidden'); findReplaceDialog.querySelector('#find-input').focus(); }
function closeFindReplace() { findReplaceDialog.classList.add('hidden'); }
function findAndReplace(replaceAll = false) { const findValue = document.getElementById('find-input').value; const replaceValue = document.getElementById('replace-input').value; if (!findValue) return; const regex = new RegExp(findValue, replaceAll ? 'g' : ''); textInput.value = textInput.value.replace(regex, replaceValue); updateAll(); recordState(); }

// --- NOTE ACTIONS ---
function deleteNote(id) { const key = getUserNotesKey(); if (!key || !confirm("Are you sure you want to delete this note permanently?")) return; let notes = JSON.parse(localStorage.getItem(key)) || []; localStorage.setItem(key, JSON.stringify(notes.filter(n => n.id !== id))); displayNotes(); if (editModeId === id) newDoc(); }
function pinNote(id) { const key = getUserNotesKey(); if (!key) return; const notes = JSON.parse(localStorage.getItem(key)) || []; const note = notes.find(n => n.id === id); if (note) note.pinned = !note.pinned; localStorage.setItem(key, JSON.stringify(notes)); displayNotes(); }
async function toggleLock(id) { const key = getUserNotesKey(); if (!key) return; let notes = JSON.parse(localStorage.getItem(key)) || []; const noteIndex = notes.findIndex(n => n.id === id); if (noteIndex === -1) return; const note = notes[noteIndex]; if (note.isLocked) { const password = prompt("Enter password to unlock this note:"); if (!password) return; const hashed = await hashPassword(password); if (hashed !== note.passwordHash) { alert("Incorrect password."); return; } } else { const password = prompt("Enter a new password to lock this note (min 4 chars):"); if (!password || password.length < 4) { alert("Password is too short."); return; } const confirmPassword = prompt("Confirm password:"); if (password !== confirmPassword) { alert("Passwords do not match."); return; } note.isLocked = true; note.passwordHash = await hashPassword(password); alert("Note locked successfully!"); } notes[noteIndex] = note; localStorage.setItem(key, JSON.stringify(notes)); displayNotes(); }
async function exportPDF(id) { const key = getUserNotesKey(); if (!key) return; const notes = JSON.parse(localStorage.getItem(key)) || []; const note = notes.find(n => n.id === id); if (!note) return; if (note.isLocked) { const password = prompt("This note is locked. Enter password to export:"); if (!password) return; const hashed = await hashPassword(password); if (hashed !== note.passwordHash) { alert("Incorrect password."); return; } } const { jsPDF } = window.jspdf; const doc = new jsPDF(); doc.setFont("Helvetica", "bold"); doc.setFontSize(20); doc.text(note.title, 15, 20); doc.setFont("Helvetica", "normal"); doc.setFontSize(12); let contentToExport = note.text; if (note.type === 'todo') { try { contentToExport = JSON.parse(note.text).map(item => `${item.checked ? '[x]' : '[ ]'} ${item.text}`).join('\n'); } catch { contentToExport = "Error: Could not parse to-do list."} } doc.text(doc.splitTextToSize(contentToExport, 180), 15, 30); doc.save(`${note.title.replace(/\s+/g, '_')}.pdf`); }

// --- PWA & SHORTCUTS ---
window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredInstallPrompt = e; installBtn.classList.remove('hidden'); });
installBtn.addEventListener('click', async () => { if (deferredInstallPrompt) { deferredInstallPrompt.prompt(); await deferredInstallPrompt.userChoice; deferredInstallPrompt = null; installBtn.classList.add('hidden'); } });
document.addEventListener('keydown', (e) => { if (e.ctrlKey || e.metaKey) { switch (e.key.toLowerCase()) { case 's': e.preventDefault(); saveNote(); break; case 'n': e.preventDefault(); newDoc(); break; case 'z': e.preventDefault(); undo(); break; case 'y': e.preventDefault(); redo(); break; } } });

// --- NEW: BLOG POSTS FUNCTIONALITY ---
const blogPostsData = [
    {
        id: 1,
        title: "Unlock Your Productivity: The Power of a Digital Notepad",
        date: "2024-07-25",
        views: 1580,
        author: "Bishal Mishra",
        image: "https://www.seekink.com/wp-content/uploads/2024/01/%E5%9B%BE%E7%89%874-3.png", // Image related to note-taking
        content: "In today's fast-paced world, staying organized is key to productivity. A digital notepad like Note P@d can be your secret weapon. This blog post explores how using a simple yet powerful tool can help you capture fleeting ideas, organize your thoughts, and manage your daily tasks effectively. We'll cover strategies for leveraging notepads for everything from meeting minutes to personal journaling, ensuring no great idea slips away. Discover how to optimize your Note P@d for maximum efficiency.",
        fullContent: "In today's fast-paced world, staying organized is key to productivity. A digital notepad like Note P@d can be your secret weapon. This blog post explores how using a simple yet powerful tool can help you capture fleeting ideas, organize your thoughts, and manage your daily tasks effectively. We'll cover strategies for leveraging notepads for everything from meeting minutes to personal journaling, ensuring no great idea slips away. Discover how to optimize your Note P@d for maximum efficiency. Learn about using different note types, the benefits of the markdown editor (if implemented), and how to integrate Note P@d into your daily routine for peak performance. We'll delve into creating structured notes, using tags for better organization, and even some advanced tips for power users. Embrace the simplicity and power of digital note-taking with Note P@d!"
    },
    {
        id: 2,
        title: "Beyond Text: Harnessing the Whiteboard Feature",
        date: "2024-07-20",
        views: 1120,
        author: "Bishal Mishra",
        image: "https://nextdayanimations.com/wp-content/uploads/2022/12/why_whiteboard_videos_blog_post-fb.png", // Image related to drawing/whiteboarding
        content: "Sometimes, words aren't enough. Visual thinking is crucial for brainstorming, mind-mapping, and problem-solving. Discover how Note P@d's integrated whiteboard feature can transform your workflow. Learn tips for sketching out ideas, creating visual outlines, and collaborating more effectively.",
        fullContent: "Sometimes, words aren't enough. Visual thinking is crucial for brainstorming, mind-mapping, and problem-solving. Discover how Note P@d's integrated whiteboard feature can transform your workflow. Learn tips for sketching out ideas, creating visual outlines, and collaborating more effectively. We’ll show you how to make the most of the drawing tools to bring your concepts to life, making complex ideas instantly understandable. Explore the use of different colors, brush sizes, and the eraser tool. Consider how to save and export your whiteboard creations for sharing or later reference, enhancing your team's ability to communicate visually."
    },
    {
        id: 3,
        title: "Conquer Your To-Do List: Strategies for Effective Task Management",
        date: "2024-07-15",
        views: 1750,
        author: "Bishal Mishra",
        image: "https://images.ctfassets.net/lzny33ho1g45/4dBmz2qbCdUEQ8Z5Zr2jQH/86ea25e7ba44580d252b092f8a68dbd4/kanban", // Image related to to-do lists
        content: "A messy to-do list can feel overwhelming. This post dives into practical strategies for managing your tasks using Note P@d's dedicated To-Do List feature. Learn about prioritizing tasks, breaking down large projects, and the psychological benefits of checking items off your list.",
        fullContent: "A messy to-do list can feel overwhelming. This post dives into practical strategies for managing your tasks using Note P@d's dedicated To-Do List feature. Learn about prioritizing tasks, breaking down large projects, and the psychological benefits of checking items off your list. We’ll explore how to use Note P@d to create a system that reduces stress and boosts your accomplishment levels throughout the day. Discover techniques like the Eisenhower Matrix and time blocking to make your to-do lists work for you, not against you. Understand how to set deadlines and reminders for maximum impact."
    },
    {
        id: 4,
        title: "The Seamless Offline Experience: Why Note P@d is Always Available",
        date: "2024-07-10",
        views: 950,
        author: "Bishal Mishra",
        image: "https://images.unsplash.com/photo-1519389950473-47ba0277781c?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80", // Image related to offline/connectivity
        content: "In an era where connectivity is paramount, what happens when you're offline? Note P@d is designed to work seamlessly even without an internet connection, thanks to its Progressive Web App (PWA) nature. This article explains the technology behind offline access and how it ensures your notes, whiteboard sketches, and to-do lists are always accessible, wherever you are.",
        fullContent: "In an era where connectivity is paramount, what happens when you're offline? Note P@d is designed to work seamlessly even without an internet connection, thanks to its Progressive Web App (PWA) nature. This article explains the technology behind offline access and how it ensures your notes, whiteboard sketches, and to-do lists are always accessible, wherever you are. Bishal Mishra emphasizes the reliability this provides for users on the go. Learn about service workers and local storage, and how they contribute to a robust, always-available application, even in areas with poor or no internet connectivity. This feature makes Note P@d a truly dependable tool for anyone."
    },
    {
        id: 5,
        title: "Your Privacy Matters: How Note P@d Protects Your Data",
        date: "2024-07-05",
        views: 2100,
        author: "Bishal Mishra",
        image: "https://media.licdn.com/dms/image/v2/D4E12AQHg_nJFQiivgg/article-cover_image-shrink_720_1280/article-cover_image-shrink_720_1280/0/1682504783369?e=2147483647&v=beta&t=V6mZOMfpK7IKPasLUGnZBRacpl6_9KF3G3K5jgPmqxI", // Image related to security/privacy
        content: "Your notes are your thoughts, and they should remain private. Note P@d is built with a strong focus on user privacy. This post details how your data is stored locally in your browser's storage, never transmitted to any server, and remains completely on your device.",
        fullContent: "Your notes are your thoughts, and they should remain private. Note P@d is built with a strong focus on user privacy. This post details how your data is stored locally in your browser's storage, never transmitted to any server, and remains completely on your device. Learn about the security measures in place and why this local-first approach is essential for a trustworthy note-taking application. Bishal Mishra shares his commitment to data security. Understand the implications of browser storage for your sensitive information and why it's crucial for applications like Note P@d to prioritize your privacy above all else."
    },
];

function loadBlogPosts() {
    blogList.innerHTML = ''; // Clear existing blog posts
    blogPostsData.forEach(post => {
        const blogPostDiv = document.createElement('div');
        // Add a unique ID to the blog post div for easier targeting by toggleBlogContent
        blogPostDiv.id = `blog-${post.id}`; 
        blogPostDiv.classList.add('blog-post');

        // Initially display only the short content
        const shortContent = `<div class="blog-content-short">${post.content}</div>`;
        const fullContent = `<div class="blog-content-full hidden">${post.fullContent}</div>`;

        blogPostDiv.innerHTML = `
            <h4>${post.title}</h4>
            <div class="blog-post-meta">
                <span><i class="fas fa-calendar-alt"></i> Posted Date: ${post.date}</span>
                <span><i class="fas fa-user"></i> Posted By: ${post.author}</span>
                <span><i class="fas fa-eye"></i> View Count: ${post.views}</span>
            </div>
            ${post.image ? `<img src="${post.image}" alt="${post.title}" class="blog-post-image">` : ''}
            <div class="blog-post-content">
                ${shortContent}
                ${fullContent}
                <button class="read-more-btn" onclick="toggleBlogContent(${post.id})">Read More →</button>
            </div>
        `;
        blogList.appendChild(blogPostDiv);
    });
}

// NEW: Function to toggle the visibility of full blog content
function toggleBlogContent(postId) {
    // Find the specific blog post element using the ID we assigned
    const blogPostElement = document.getElementById(`blog-${postId}`); 
    if (!blogPostElement) return;

    const contentShort = blogPostElement.querySelector('.blog-content-short');
    const contentFull = blogPostElement.querySelector('.blog-content-full');
    const readMoreBtn = blogPostElement.querySelector('.read-more-btn');

    if (!contentShort || !contentFull || !readMoreBtn) return;

    const isExpanded = !contentFull.classList.contains('hidden');

    if (isExpanded) {
        // Hide full content, show short content, change button text
        contentFull.classList.add('hidden');
        contentShort.classList.remove('hidden');
        readMoreBtn.textContent = 'Read More →';
        readMoreBtn.style.backgroundColor = 'var(--primary)'; // Reset color
    } else {
        // Show full content, hide short content, change button text
        contentFull.classList.remove('hidden');
        contentShort.classList.add('hidden');
        readMoreBtn.textContent = 'Show Less ←';
        readMoreBtn.style.backgroundColor = 'var(--primary-dark)'; // Change color when expanded
    }
}

</script>
</body>
</html>
